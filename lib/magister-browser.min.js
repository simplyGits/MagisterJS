/* Magister.js (browser version) by simplyApps. Built on: 16-10-2014 */
/*
	HTTP CLASS
	======================
	
	You have to implement this with your own serverside implementation.
	Beneath here are the requirements you have to follow.

 	======================
   MINIMAL REQUIREMENTS
 	======================
 	callback: function (error, result) {...}
 	result: { content (string), headers (dictionary) }
 	options: { headers (dictionary), data (object) }
	
 	get(url, options*, callback)
 	delete(url, options*, callback)
 	post(url, data, options*, callback)
 	put(url, data, options*, callback)
	
 	* = optional (Fill with default value if null (object) ex.: options ?= {})
	
 	Class holds variable _cookie which is required to be added to the headers
*/

(function() {		 
	this.MagisterHttp = (function() {
			function MagisterHttp() {}

			MagisterHttp.prototype.get = function(url, options, callback) {

			};

			MagisterHttp.prototype["delete"] = function(url, options, callback) {

			};

			MagisterHttp.prototype.post = function(url, data, options, callback) {

			};

			MagisterHttp.prototype.put = function(url, data, options, callback) {

			};

			MagisterHttp.prototype._cookie = "";

			return MagisterHttp;

	})();
}).call(this);
(function(){var findQueries,messageFolder;this.Appointment=function(){function Appointment(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.begin=_getset("_begin"),this.end=_getset("_end"),this.beginBySchoolHour=_getset("_beginBySchoolHour"),this.endBySchoolHour=_getset("_endBySchoolHour"),this.fullDay=_getset("_fullDay"),this.description=_getset("_description"),this.location=_getset("_location"),this.status=_getset("_status"),this.type=_getset("_type"),this.displayType=_getset("_displayType"),this.content=_getset("_content",null,function(x){return null!=x?x.replace(/<br ?\/?>/g,"\n").replace(/(<[^>]*>)|(&nbsp;)/g,""):x}),this.infoType=_getset("_infoType"),this.notes=_getset("_notes"),this.isDone=_getset("_isDone",function(_this){return function(d){return _this._isDone!==d?(_this._isDone=d,_this._magisterObj.http.put(_this.url(),_this._toMagisterStyle(),{},function(){})):void 0}}(this)),this.classes=_getset("_classes"),this.teachers=_getset("_teachers"),this.classRooms=_getset("_classRooms"),this.groups=_getset("_groups"),this.appointmentId=_getset("_appointmentId"),this.attachments=_getset("_attachments"),this.url=_getset("_url"),this.scrapped=_getset("_scrapped"),this.absenceInfo=_getset("_absenceInfo")}return Appointment.prototype._toMagisterStyle=function(){var c,obj,p,_ref;return obj={},obj.Id=this._id,obj.Start=_helpers.toUtcString(this._begin),obj.Einde=_helpers.toUtcString(this._end),obj.LesuurVan=this._beginBySchoolHour,obj.LesuurTotMet=this._endBySchoolHour,obj.DuurtHeleDag=this._fullDay,obj.Omschrijving=this._description,obj.Lokatie=this._location,obj.Status=this._status,obj.Type=this._type,obj.WeergaveType=this._displayType,obj.Inhoud=this._content,obj.InfoType=this._infoType,obj.Aantekening=this._notes,obj.Afgerond=this._isDone,obj.Lokalen=function(){var _i,_len,_ref,_results;for(_ref=this._classRooms,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push({Naam:c});return _results}.call(this),obj.Docenten=function(){var _i,_len,_ref,_results;for(_ref=this._teachers,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)p=_ref[_i],_results.push(p._toMagisterStyle());return _results}.call(this),obj.Vakken=function(){var _i,_len,_ref,_results;for(_ref=this._classes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push({Naam:c});return _results}.call(this),obj.Groepen=this._groups,obj.OpdrachtId=this._appointmentId,obj.Bijlagen=null!=(_ref=this._attachments)?_ref:[],obj},Appointment.prototype._makeStorable=function(){return _.omit(this,"_magisterObj")},Appointment._convertRaw=function(magisterObj,raw){var c,obj,p;return obj=new Appointment(magisterObj),obj._id=raw.Id,obj._begin=new Date(Date.parse(raw.Start)),obj._end=new Date(Date.parse(raw.Einde)),obj._beginBySchoolHour=raw.LesuurVan,obj._endBySchoolHour=raw.LesuurTotMet,obj._fullDay=raw.DuurtHeleDag,obj._description=raw.Omschrijving,obj._location=raw.Lokatie,obj._status=raw.Status,obj._type=raw.Type,obj._displayType=raw.WeergaveType,obj._content=raw.Inhoud,obj._infoType=raw.InfoType,obj._notes=raw.Aantekening,obj._isDone=raw.Afgerond,obj._classes=null!=raw.Vakken?function(){var _i,_len,_ref,_results;for(_ref=raw.Vakken,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c.Naam);return _results}():void 0,obj._teachers=null!=raw.Docenten?function(){var _i,_len,_ref,_results;for(_ref=raw.Docenten,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)p=_ref[_i],_results.push(Person._convertRaw(magisterObj,p));return _results}():void 0,obj._classRooms=null!=raw.Lokalen?function(){var _i,_len,_ref,_results;for(_ref=raw.Lokalen,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c.Naam);return _results}():void 0,obj._groups=raw.Groepen,obj._appointmentId=raw.OpdrachtId,obj._attachments=raw.Bijlagen,obj._url=""+magisterObj._personUrl+"/afspraken/"+obj._id,obj._scrapped=0===raw.Status,obj},Appointment._convertStored=function(magisterObj,raw){var obj;return obj=_.extend(raw,new Appointment(magisterObj)),obj._magisterObj=magisterObj,obj._begin=new Date(Date.parse(raw._begin)),obj._end=new Date(Date.parse(raw._end)),obj},Appointment}(),this.Assignment=function(){function Assignment(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.name=_getset("_name"),this.description=_getset("_description"),this["class"]=_getset("_class"),this.deadline=_getset("_deadline"),this.handedInOn=_getset("_handedInOn"),this.files=_getset("_files"),this.teachers=_getset("_teachers"),this.grade=_getset("_grade"),this.markedOn=_getset("_markedOn"),this.handInAgain=_getset("_handInAgain"),this.finished=_getset("_finished"),this.canHandIn=_getset("_canHandIn")}return Assignment.prototype.versions=function(callback){var id,pushResult,_i,_len,_ref,_results;for(pushResult=_helpers.asyncResultWaiter(this._versionIds.length,function(r){return callback(null,r)}),_ref=this._versionIds,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)id=_ref[_i],_results.push(this._magisterObj.http.get(""+this._magisterObj._personUrl+"/opdrachten/versie/"+id,{},function(_this){return function(error,result){return null!=error?callback(error,null):pushResult(AssignmentVersion._convertRaw(_this._magisterObj,_this,EJSON.parse(result.content)))}}(this)));return _results},Assignment._convertRaw=function(magisterObj,raw){var f,obj,p,v;return obj=new Assignment(magisterObj),obj._id=raw.Id,obj._name=raw.Titel,obj._description=raw.Omschrijving,obj._class=raw.Vak,obj._deadline=new Date(Date.parse(raw.InleverenVoor)),obj._handedInOn=new Date(Date.parse(raw.IngeleverdOp)),obj._files=function(){var _i,_len,_ref,_results;for(_ref=raw.Bijlagen,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],_results.push(File._convertRaw(magisterObj,void 0,f));return _results}(),obj._teachers=null!=raw.Docenten?function(){var _i,_len,_ref,_results;for(_ref=raw.Docenten,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)p=_ref[_i],_results.push(Person._convertRaw(magisterObj,p));return _results}():void 0,obj._versionIds=function(){var _i,_len,_ref,_results;for(_ref=raw.VersieNavigatieItems,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)v=_ref[_i],_results.push(v.Id);return _results}(),obj._grade=raw.Beoordeling,obj._markedOn=new Date(Date.parse(raw.BeoordeeldOp)),obj._handInAgain=raw.OpnieuwInleveren,obj._finished=raw.Afgesloten,obj._canHandIn=raw.MagInleveren,obj},Assignment}(),this.AssignmentVersion=function(){function AssignmentVersion(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this["class"]=_getset("_class"),this.state=_getset("_state"),this.pupilMessage=_getset("_pupilMessage"),this.teacherNotice=_getset("_teacherNotice"),this.handedInFiles=_getset("_handedInFiles"),this.feedbackFiles=_getset("_feedbackFiles"),this.deadline=_getset("_deadline"),this.handedInOn=_getset("_handedInOn"),this.grade=_getset("_grade"),this.markedOn=_getset("_markedOn"),this.version=_getset("_version"),this.tooLate=_getset("_tooLate")}return AssignmentVersion._convertRaw=function(magisterObj,sender,raw){var f,obj;return obj=new AssignmentVersion(magisterObj),obj._id=raw.Id,obj._class=sender._class,obj._state=raw.Status,obj._pupilMessage=raw.LeerlingOpmerking,obj._teacherNotice=raw.DocentOpmerking,obj._handedInFiles=function(){var _i,_len,_ref,_results;for(_ref=raw.LeerlingBijlagen,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],_results.push(File._convertRaw(magisterObj,void 0,f));return _results}(),obj._feedbackFiles=function(){var _i,_len,_ref,_results;for(_ref=raw.FeedbackBijlagen,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],_results.push(File._convertRaw(magisterObj,void 0,f));return _results}(),obj._deadline=new Date(Date.parse(raw.InleverenVoor)),obj._handedInOn=new Date(Date.parse(raw.IngeleverdOp)),obj._grade=raw.Beoordeling,obj._markedOn=new Date(Date.parse(raw.BeoordeeldOp)),obj._version=raw.VersieNummer,obj._tooLate=raw.IsTeLaat,obj},AssignmentVersion}(),this.Class=function(){function Class(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.beginDate=_getset("_beginDate"),this.endDate=_getset("_endDate"),this.licenseUrl=_getset("_licenseUrl"),this.abbreviation=_getset("_abbreviation"),this.description=_getset("_description"),this.number=_getset("_number")}return Class._convertRaw=function(magisterObj,raw){var obj;return obj=new Class(magisterObj),obj._id=raw.Id,obj._beginDate=new Date(Date.parse(raw.Begindatum)),obj._endDate=new Date(Date.parse(raw.Einddatum)),obj._licenseUrl=raw.LicentieUrl,obj._abbreviation=raw.Afkorting,obj._description=raw.Omschrijving,obj._number=raw.Volgnr,obj},Class}(),this.Course=function(){function Course(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.begin=_getset("_begin"),this.end=_getset("_end"),this.schoolPeriod=_getset("_schoolPeriod"),this.type=_getset("_type"),this.group=_getset("_group"),this.profile=_getset("_profile"),this.alternativeProfile=_getset("_alternativeProfile")}return Course.prototype.classes=function(callback){return this._magisterObj.http.get(this._classesUrl,{},function(_this){return function(error,result){var c;return null!=error?callback(error,null):callback(null,function(){var _i,_len,_ref,_results;for(_ref=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(Class._convertRaw(this._magisterObj,c));return _results}.call(_this))}}(this))},Course.prototype.grades=function(){var callback,download,_ref;if(download=null!=(_ref=_.find(arguments,function(a){return _.isBoolean(a)}))?_ref:!0,callback=_.find(arguments,function(a){return _.isFunction(a)}),null==callback)throw new Error("Callback can't be null");return this._magisterObj.http.get(this._gradesUrl,{},function(_this){return function(error,result){var g,pushResult,_i,_len,_results;if(null!=error)return callback(error,null);for(result=EJSON.parse(result.content).Items,pushResult=_helpers.asyncResultWaiter(result.length,function(r){return callback(null,r)}),_results=[],_i=0,_len=result.length;_len>_i;_i++)g=result[_i],_results.push(function(g){return g.teacher=Person._convertRaw(_this._magisterObj,{Docentcode:g.Docent}),g.teacher._type=3,download?_this._magisterObj.getPersons(g.Docent,3,function(e,r){var teacher;return null==e&&null!=r[0]&&(teacher=r[0]),pushResult(Grade._convertRaw(g))}):pushResult(Grade._convertRaw(g))}(g));return _results}}(this))},Course._convertRaw=function(magisterObj,raw){var obj;return obj=new Course(magisterObj),obj._classesUrl=magisterObj.magisterSchool.url+_.find(raw.Links,{Rel:"Vakken"}).Href,obj._gradesUrl=magisterObj._personUrl+("/aanmeldingen/"+raw.Id+"/cijfers/cijferoverzichtvooraanmelding?actievePerioden=true&alleenBerekendeKolommen=false&alleenPTAKolommen=false"),obj._id=raw.Id,obj._begin=new Date(Date.parse(raw.Start)),obj._end=new Date(Date.parse(raw.Einde)),obj._schoolPeriod=raw.Lesperiode,obj._type={id:raw.Studie.Id,description:raw.Studie.Omschrijving},obj._group={id:raw.Groep.Id,description:raw.Groep.Omschrijving,locationId:raw.Groep.LocatieId},obj._profile=raw.Profiel,obj._alternativeProfile=raw.Profiel2,obj},Course}(),this.DigitalSchoolUtility=function(){function DigitalSchoolUtility(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.type=_getset("_type"),this.name=_getset("_name"),this.publisher=_getset("_publisher"),this.state=_getset("_state"),this.begin=_getset("_begin"),this.end=_getset("_end"),this.EAN=_getset("_EAN"),this.url=_getset("_url"),this["class"]=_getset("_class")}return DigitalSchoolUtility._convertRaw=function(magisterObj,raw){var obj;return obj=new DigitalSchoolUtility(magisterObj),obj._id=raw.Id,obj._type=raw.MateriaalType,obj._name=raw.Titel,obj._publisher=raw.Uitgeverij,obj._state=raw.Status,obj._begin=new Date(Date.parse(raw.Start)),obj._end=new Date(Date.parse(raw.Eind)),obj._EAN=Number(raw.EAN),obj._url=raw.Url,obj._class=raw.Vak,obj},DigitalSchoolUtility}(),this.FileFolder=function(){function FileFolder(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.name=_getset("_name"),this.rights=_getset("_rights"),this.parentId=_getset("_parentId")}return FileFolder.prototype.files=function(callback){return this._magisterObj.http.get(""+this._magisterObj._personUrl+"/bronnen?parentId="+this.id(),{},function(_this){return function(error,result){var f,files,pushResult,_i,_len,_results;if(null!=error)return callback(error,null);for(files=function(){var _i,_len,_ref,_results;for(_ref=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],_results.push(File._convertRaw(this._magisterObj,this,f));return _results}.call(_this),pushResult=_helpers.asyncResultWaiter(files.length,function(){return callback(null,files)}),_results=[],_i=0,_len=files.length;_len>_i;_i++)f=files[_i],_results.push(function(f){return _this._magisterObj.getPersons(f.GeplaatstDoor,function(e,r){return null==e&&0!==r.length&&(f._addedBy=r[0]),pushResult()})}(f));return _results}}(this))},FileFolder._convertRaw=function(magisterObj,raw){var obj;return obj=new FileFolder(magisterObj),obj._id=raw.Id,obj._name=raw.Naam,obj._rights=raw.Privilege,obj._parentId=raw.ParentId,obj},FileFolder}(),this.File=function(){function File(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.type=_getset("_type"),this.name=_getset("_name",function(_this){return function(x){return _this._name=x,_this._update()}}(this)),this.uri=_getset("_uri"),this.size=_getset("_size"),this.rights=_getset("_rights"),this.mime=_getset("_mime"),this.changedDate=_getset("_changedDate"),this.creationDate=_getset("_creationDate"),this.addedBy=_getset("_addedBy"),this.fileBlobId=_getset("_fileBlobId"),this.fileFolder=_getset("_fileFolder",this.move),this.uniqueId=_getset("_uniqueId")}return File.prototype.download=function(){var callback,downloadFile,_ref;return callback=_.find(arguments,function(a){return _.isFunction(a)}),downloadFile=null!=(_ref=_.find(arguments,function(a){return _.isBoolean(a)}))?_ref:!0,this._magisterObj.http.get(this._downloadUrl,{},function(_this){return function(error,result){var data;return null!=error?callback(error,null):(data=result.content,downloadFile&&_helpers.saveFile(data,_this.mime(),_this.name()),"function"==typeof callback?callback(null,data):void 0)}}(this))},File.prototype.move=function(fileFolder){return this._magisterObj.fileFolders(function(_this){return function(e,r){if(null!=e)throw e;return _.isObject(fileFolder)||(fileFolder=_.find(r,function(f){return _helpers.contains(f.name(),fileFolder,!0)||f.id()===fileFolder})),_this._fileFolder=fileFolder,_this._update()}}(this))},File.prototype.remove=function(){return this._magisterObj.http["delete"](""+this._magisterObj._personUrl+"/bronnen/"+this.id(),{},function(error){if(null!=error)throw error})},File.prototype._update=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/bronnen/"+this.id(),this._toMagisterStyle(),{},function(){})},File.prototype._toMagisterStyle=function(){var obj;return obj={},obj.Id=this._id,obj.BronSoort=this._type,obj.Naam=this._name,obj.Uri=this._uri,obj.Grootte=this._size,obj.Privilege=this._rights,obj.ContentType=this._mime,obj.FileBlobId=this._fileBlobId,obj.ParentId=this._fileFolder.id(),obj.UniqueId=this._uniqueId,obj},File._convertRaw=function(magisterObj,sender,raw){var addedBy,obj,_ref;return null!=raw._addedBy?addedBy=raw._addedBy:(addedBy=new Person(magisterObj,null,"",""),addedBy._fullName=raw.GeplaatstDoor),obj=new File(magisterObj),obj._id=raw.Id,obj._type=raw.BronSoort,obj._name=raw.Naam,obj._uri=raw.Uri,obj._size=raw.Grootte,obj._rights=raw.Privilege,obj._mime=raw.ContentType,obj._changedDate=new Date(Date.parse(raw.GewijzigdOp)),obj._creationDate=new Date(Date.parse(null!=(_ref=raw.GemaaktOp)?_ref:raw.Datum)),obj._addedBy=addedBy,obj._fileBlobId=raw.FileBlobId,obj._fileFolder=sender,obj._uniqueId=raw.UniqueId,obj._downloadUrl=magisterObj.magisterSchool.url+_.find(raw.Links,{Rel:"Contents"}).Href,obj},File}(),this.Grade=function(){function Grade(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.grade=_getset("_grade"),this.passed=_getset("_passed"),this.dateFilledIn=_getset("_dateFilledIn"),this.gradePeriod=_getset("_gradePeriod"),this["class"]=_getset("_class"),this.atLaterDate=_getset("_atLaterDate"),this.exemption=_getset("_exemption"),this.counts=_getset("_counts"),this.type=_getset("_type"),this.teacher=_getset("_teacher"),this.classExemption=_getset("_classExemption")}return Grade._convertRaw=function(magisterObj,raw){var obj;return obj=new Grade(magisterObj),obj._id=raw.CijferId,obj._grade=raw.CijferStr,obj._passed=raw.IsVoldoende,obj._dateFilledIn=new Date(Date.parse(raw.DatumIngevoerd)),obj._gradePeriod={id:function(){return raw.CijferPeriode.Id},abbreviation:function(){return raw.CijferPeriode.Afkorting}},obj._class={id:function(){return raw.Vak.Id},abbreviation:function(){return raw.Vak.Afkorting},description:function(){return raw.Vak.Omschrijving}},obj._atLaterDate=raw.Inhalen,obj._exemption=raw.Vrijstelling,obj._counts=raw.TeltMee,obj._type=GradeType._convertRaw(raw.CijferKolom),obj._assignmentId=raw.CijferKolomIdEloOpdracht,obj._teacher=raw.teacher,obj._classExemption=raw.VakDispensatie||raw.VakVrijstelling,obj},Grade}(),this.GradeType=function(){function GradeType(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.name=_getset("_name"),this.number=_getset("_number"),this.header=_getset("_header"),this.description=_getset("_description"),this.type=_getset("_type"),this.isAtLaterDate=_getset("_isAtLaterDate"),this.isTeacher=_getset("_isTeacher"),this.hasNestedTypes=_getset("_hasNestedTypes"),this.isPTA=_getset("_isPTA")}return GradeType._convertRaw=function(magisterObj,raw){var obj;return obj=new GradeType(magisterObj),obj._id=raw.Id,obj._name=raw.KolomNaam,obj._number=raw.KolomNummer,obj._header=raw.KolomKop,obj._description=raw.KolomOmschrijving,obj._type=raw.KolomSoort,obj._isAtLaterDate=raw.IsHerkansingKolom,obj._isTeacher=raw.IsDocentKolom,obj._hasNestedTypes=raw.HeeftOndeliggendeKolommen,obj._isPTA=raw.IsPTAKolom,obj},GradeType}(),this.Magister=function(){function Magister(magisterSchool,username,password,_keepLoggedIn){if(this.magisterSchool=magisterSchool,this.username=username,this.password=password,this._keepLoggedIn=null!=_keepLoggedIn?_keepLoggedIn:!0,3!==arguments.length&&4!==arguments.length)throw new Error("Expected 3 or 4 arguments, got "+arguments.length);this._readyCallbacks=[],this.http=new MagisterHttp,this.reLogin()}return Magister.prototype.appointments=function(){var callback,dateConvert,download,from,to,url,_ref,_ref1;return callback=_.find(arguments,function(a){return _.isFunction(a)}),download=null!=(_ref=_.find(arguments,function(a){return _.isBoolean(a)}))?_ref:!0,_ref1=_.where(arguments,function(a){return _.isDate(a)}),from=_ref1[0],to=_ref1[1],_.isDate(to)||(to=from),this._forceReady(),dateConvert=_helpers.urlDateConvert,url=""+this._personUrl+"/afspraken?tot="+dateConvert(to)+"&van="+dateConvert(from),this.http.get(url,{},function(_this){return function(error,result){var a,absences,appointments,hit,pushResult,_i,_len,_results;if(null!=error)return callback(error,null);if(result=EJSON.parse(result.content),appointments=function(){var _i,_len,_ref2,_results;for(_ref2=result.Items,_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)a=_ref2[_i],_results.push(Appointment._convertRaw(this,a));return _results}.call(_this),absences=[],hit=_helpers.asyncResultWaiter(3,function(){var _fn,_i,_len;for(_fn=function(a){return a._absenceInfo=_.find(absences,function(absence){return absence.appointmentId===a.id()})},_i=0,_len=appointments.length;_len>_i;_i++)a=appointments[_i],_fn(a);return _.remove(appointments,function(a){return _helpers.date(a.begin())<_helpers.date(from)||_helpers.date(a.end())>_helpers.date(to)}),callback(null,_.sortBy(appointments,function(x){return x.begin()}))}),_this.http.get(""+_this._personUrl+"/roosterwijzigingen?tot="+dateConvert(to)+"&van="+dateConvert(from),{},function(error,result){var c;return appointments=_helpers.pushMore(appointments,function(){var _i,_len,_ref2,_results;for(_ref2=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)c=_ref2[_i],_results.push(Appointment._convertRaw(this,c));return _results}.call(_this)),hit()}),_this.http.get(""+_this._personUrl+"/absenties?tot="+dateConvert(to)+"&van="+dateConvert(from),{},function(error,result){var _fn,_i,_len;for(result=EJSON.parse(result.content).Items,_fn=function(a){return absences.push({id:a.Id,begin:new Date(Date.parse(a.Start)),end:new Date(Date.parse(a.Eind)),schoolHour:a.Lesuur,permitted:a.Geoorloofd,appointmentId:a.AfspraakId,description:_helpers.trim(a.Omschrijving),type:a.VerantwoordingType,code:a.Code})},_i=0,_len=result.length;_len>_i;_i++)a=result[_i],_fn(a);return hit()}),download){for(pushResult=_helpers.asyncResultWaiter(appointments.length,function(){return hit()}),_results=[],_i=0,_len=appointments.length;_len>_i;_i++)a=appointments[_i],_results.push(function(a){var teachers,_ref2;return teachers=null!=(_ref2=a.teachers())?_ref2:[],_this.fillPersons(teachers,function(e,r){return a._teachers=r,pushResult()},3)}(a));return _results}return hit()}}(this))},Magister.prototype.messageFolders=function(query,callback){var result;return this._forceReady(),null==callback&&(callback=function(){}),result=_.isString(query)&&""!==query?_.where(this._messageFolders,function(mF){return _helpers.contains(mF.name(),query,!0)}):this._messageFolders,callback(null,result),result},Magister.prototype.inbox=function(callback){return null==callback&&(callback=function(){}),this.messageFolders("postvak in",function(error,result){return null!=error?callback(error,null):callback(null,result[0])})[0]},Magister.prototype.sentItems=function(callback){return null==callback&&(callback=function(){}),this.messageFolders("verzonden items",function(error,result){return null!=error?callback(error,null):callback(null,result[0])})[0]},Magister.prototype.bin=function(callback){return null==callback&&(callback=function(){}),this.messageFolders("verwijderde items",function(error,result){return null!=error?callback(error,null):callback(null,result[0])})[0]},Magister.prototype.alerts=function(callback){return null==callback&&(callback=function(){}),this.messageFolders("mededelingen",function(error,result){return null!=error?callback(error,null):callback(null,result[0])})[0]},Magister.prototype.courses=function(callback){var url;return this._forceReady(),url=""+this._personUrl+"/aanmeldingen",this.http.get(url,{},function(_this){return function(error,result){var c;return null!=error?callback(error,null):(result=EJSON.parse(result.content),callback(null,_.sortBy(function(){var _i,_len,_ref,_results;for(_ref=result.Items,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(Course._convertRaw(this,c));return _results}.call(_this),function(c){return c.begin()})))}}(this))},Magister._cachedPersons={},Magister.prototype.getPersons=function(){var callback,query,type,url,val;return this._forceReady(),query=_helpers.trim(arguments[0]),callback=2===arguments.length?arguments[1]:arguments[2],3===arguments.length&&(type=arguments[1]),null!=query&&null!=callback&&query.length>=3?null==type?void this.getPersons(query,3,function(_this){return function(e,r){return null!=e?callback(e,null):0!==r.length?callback(null,r):_this.getPersons(query,4,function(e,r){return null!=e?callback(e,null):callback(null,r)})}}(this)):(type=function(){switch(Person._convertType(type)){case 1:return"Groep";case 3:return"Docent";case 4:return"Leerling";case 8:return"Project";default:return"Overig"}}(),url=""+this._personUrl+"/contactpersonen?contactPersoonType="+type+"&q="+query,null!=(val=Magister._cachedPersons[""+this._id+type+query])?callback(null,val):this.http.get(url,{},function(_this){return function(error,result){var p;return null!=error?callback(error,null):(result=function(){var _i,_len,_ref,_results;for(_ref=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)p=_ref[_i],_results.push(Person._convertRaw(this,p));return _results}.call(_this),Magister._cachedPersons[""+_this._id+type+query]=result,callback(null,result))}}(this))):void callback(null,[])},Magister.prototype.fillPersons=function(persons,callback,overwriteType){var p,pushResult,_i,_len,_ref,_ref1;if(_.isArray(persons)){if(0===persons.length)return void callback(null,[]);for(pushResult=_helpers.asyncResultWaiter(persons.length,function(r){return callback(null,r)}),_i=0,_len=persons.length;_len>_i;_i++){p=persons[_i];try{this.getPersons(_.last(p.fullName().split(" ")),null!=(_ref=p._type)?_ref:overwriteType,function(e,r){var _ref1;if(null!=e||null==r)throw e;return pushResult(null!=(_ref1=r[0])?_ref1:p)})}catch(_error){pushResult(p)}}}else{if(!_.isObject(persons))throw new Error("Expected persons to be an Array or an Object, got a(n) "+typeof persons);try{this.getPersons(_.last(persons.fullName().split(" ")),null!=(_ref1=persons._type)?_ref1:overwriteType,function(e,r){var _ref2;if(null!=e||null==r)throw e;return callback(null,null!=(_ref2=r[0])?_ref2:persons)})}catch(_error){callback(persons)}}return void 0},Magister.prototype.composeAndSendMessage=function(){var body,m,recipients,subject,_ref;return _ref=_.filter(arguments,function(a){return _.isString(a)}),subject=_ref[0],body=_ref[1],recipients=_.find(arguments,function(a){return!_.isString(a)}),m=new Message(this),m.subject(subject),m.body(null!=body?body:""),m.addRecipient(recipients),m.send()},Magister.prototype.fileFolders=function(callback){return this.http.get(""+this._personUrl+"/bronnen?soort=0",{},function(_this){return function(error,result){var f;return null!=error?callback(error,null):callback(null,function(){var _i,_len,_ref,_results;for(_ref=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],_results.push(FileFolder._convertRaw(this,f));return _results}.call(_this))}}(this))},Magister.prototype.studyGuides=function(callback){return this.http.get(""+this._pupilUrl+"/studiewijzers?peildatum="+_helpers.urlDateConvert(new Date),{},function(_this){return function(error,result){var s;return null!=error?callback(error,null):callback(null,function(){var _i,_len,_ref,_results;for(_ref=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)s=_ref[_i],_results.push(StudyGuide._convertRaw(this,s));return _results}.call(_this))}}(this))},Magister.prototype.assignments=function(){var amount,callback,classes,download,skip,_ref;return _ref=_.filter(arguments,function(a){return _.isNumber(a)}),amount=_ref[0],skip=_ref[1],download=_.find(arguments,function(a){return _.isBoolean(a)}),callback=_.find(arguments,function(a){return _.isFunction(a)}),null!=callback?(null==download&&(download=!0),null==amount&&(amount=25),null==skip&&(skip=0),classes=null,this.courses(function(_this){return function(e,r){return null!=r&&0!==r.length&&_.last(r).classes(function(e,r){return null!=r&&0!==r.length?classes=r:void 0}),_this.http.get(""+_this._personUrl+"/opdrachten?skip=0&top=25&startdatum="+_helpers.urlDateConvert(new Date)+"&status=alle",{},function(error,result){var id,pushResult,_i,_len,_results;if(null!=error)return callback(error,null);for(result=function(){var _i,_len,_ref1,_results;for(_ref1=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)e=_ref1[_i],_results.push(e.Id);return _results}(),pushResult=_helpers.asyncResultWaiter(result.length,function(r){return callback(null,r)}),_results=[],_i=0,_len=result.length;_len>_i;_i++)id=result[_i],_results.push(_this.http.get(""+_this._personUrl+"/opdrachten/"+id,{},function(error,result){var assignment,teachers,_ref1;return assignment=Assignment._convertRaw(_this,EJSON.parse(result.content)),null!=classes&&(assignment._class=_.find(classes,function(c){return c.abbreviation()===assignment._class})),download?(teachers=null!=(_ref1=assignment.teachers())?_ref1:[],_this.fillPersons(teachers,function(e,r){return assignment._teachers=r,pushResult(assignment)},3)):pushResult(assignment)}));return _results})}}(this))):void 0},Magister.prototype.digitalSchoolUtilities=function(){var callback,classes,url,_class;return callback=_.find(arguments,function(a){return _.isFunction(a)}),null!=callback?(_.isObject(_class)&&(_class=_class.id()),url=null!=_class?""+this._personUrl+"/lesmateriaal?vakken="+_class:""+this._personUrl+"/lesmateriaal",classes=null,this.courses(function(_this){return function(e,r){return null!=r&&0!==r.length&&_.last(r).classes(function(e,r){return null!=r&&0!==r.length?classes=r:void 0}),_this.http.get(url,{},function(error,result){var u,utilities,_fn,_i,_len;if(null!=error)return callback(error,null);if(utilities=function(){var _i,_len,_ref,_results;for(_ref=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)u=_ref[_i],_results.push(DigitalSchoolUtility._convertRaw(this,u));return _results}.call(_this),null!=classes)for(_fn=function(u){return u._class=_.find(classes,function(c){return c.abbreviation()===u._class.Afkorting&&c.description()===u._class.Omschrijving})},_i=0,_len=utilities.length;_len>_i;_i++)u=utilities[_i],_fn(u);return callback(null,utilities)})}}(this))):void 0},Magister.prototype.profileInfo=function(callback){return this._forceReady(),"function"==typeof callback&&callback(null,this._profileInfo),this._profileInfo},Magister.prototype.ready=function(callback){return _.isFunction(callback)&&(this._ready?callback(this):this._readyCallbacks.push(callback)),this._ready===!0},Magister.prototype._forceReady=function(){if(!this._ready)throw new Error("Not done with logging in! (use Magister.ready(callback) to be sure that logging in is done)")},Magister.prototype._setReady=function(){var callback,_i,_len,_ref;for(this._ready=!0,_ref=this._readyCallbacks,_i=0,_len=_ref.length;_len>_i;_i++)(callback=_ref[_i])(this);return this._readyCallbacks=[]},Magister.prototype._readyCallbacks=[],Magister.prototype.reLogin=function(){var url;return this._ready=!1,url=""+this.magisterSchool.url+"/api/sessie",this.http.post(url,{Gebruikersnaam:this.username,Wachtwoord:this.password,GebruikersnaamOnthouden:!0,IngelogdBlijven:this._keepLoggedIn},{headers:{"Content-Type":"application/json;charset=UTF-8"}},function(_this){return function(error,result){if(null!=error)throw new Error(error.message);return _this._sessionId=/[a-z\d-]+/.exec(result.headers["set-cookie"][0])[0],_this.http._cookie="SESSION_ID="+_this._sessionId+"; M6UserName="+_this.username,_this.http.get(""+_this.magisterSchool.url+"/api/account",{},function(error,result){return result=EJSON.parse(result.content),_this._group=result.Groep[0],_this._id=result.Persoon.Id,_this._personUrl=""+_this.magisterSchool.url+"/api/personen/"+_this._id,_this._pupilUrl=""+_this.magisterSchool.url+"/api/leerlingen/"+_this._id,_this._profileInfo=ProfileInfo._convertRaw(_this,result),_this.http.get(""+_this._personUrl+"/berichten/mappen",{},function(error,result){var m;return _this._messageFolders=function(){var _i,_len,_ref,_results;for(_ref=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)m=_ref[_i],_results.push(MessageFolder._convertRaw(this,m));return _results}.call(_this),_this._setReady()})})}}(this))},Magister}(),messageFolder=function(magisterObj,x){switch(x){case 1:return magisterObj.inbox();case 2:return magisterObj.sentItems();case 3:return magisterObj.bin();case 4:return magisterObj.alerts();default:return MessageFolder._convertRaw({Id:x})}},this.Message=function(){function Message(_magisterObj){if(this._magisterObj=_magisterObj,null==this._magisterObj)throw new Error("Magister instance is null!");this._canSend=!0,this._sender=this._magisterObj.profileInfo(),this._recipients=[],this._sendDate=new Date,this._isRead=!1,this._type=1,this._subject="",this._body="",this.id=_getset("_id"),this.body=_getset("_body",function(_this){return function(x){return _this._body=x}}(this),function(x){return null!=x?x.replace(/<br ?\/?>/g,"\n").replace(/(<[^>]*>)|(&nbsp;)/g,""):x
}),this.attachments=_getset("_attachments"),this.messageFolder=_getset("_folderId",function(_this){return function(x){return _this.move(x)}}(this),function(_this){return function(x){return messageFolder(_this._magisterObj,x)}}(this)),this.subject=_getset("_subject",function(_this){return function(x){return _this._subject=x}}(this)),this.sender=_getset("_sender"),this.recipients=_getset("_recipients"),this.sendDate=_getset("_sendDate"),this.begin=_getset("_begin"),this.end=_getset("_end"),this.isRead=_getset("_isRead",function(_this){return function(x){return _this._isRead!==x?(_this._isRead=x,_this._magisterObj.http.put(""+_magisterObj._personUrl+"/berichten/"+_this.id()+"?berichtSoort="+type(),_this._toMagisterStyle(),{},function(){})):void 0}}(this)),this.state=_getset("_state"),this.isFlagged=_getset("_isFlagged"),this.type=_getset("_type")}return Message.prototype._tasks=0,Message.prototype._sendAfterFinished=!1,Message.prototype._working=function(){return 0!==this._tasks},Message.prototype._tickDown=function(){return 0===--this._tasks&&this._sendAfterFinished?this.send():void 0},Message.prototype._reset=function(){return this._tasks=0,this._sendAfterFinished=!1},Message.prototype.addRecipient=function(recipient,type){var p,_i,_len;if(_.isString(recipient))this._tasks++,this._magisterObj.getPersons(recipient,type,function(_this){return function(e,r){if(0!==r.length)return _this.recipients().push(r[0]),_this._tickDown();throw null!=type?(_this._reset(),new Error("Couldn't find a person with the type: \""+type+'" and with the query: "'+recipient+'"')):(_this._reset(),new Error("Couldn't find a person with the query: \""+recipient+'"'))}}(this));else if(_.isArray(recipient))for(_i=0,_len=recipient.length;_len>_i;_i++)p=recipient[_i],this.addRecipient(p,type);else{if(!_.isObject(recipient))throw this._reset(),new Error("Expected recipient to be a String or an Object, got a(n) "+typeof recipient);this.recipients().push(recipient)}return void 0},Message.prototype.send=function(){if(this._working())return this._sendAfterFinished=!0,!1;if(!this._canSend)throw new Error("This message is marked as unsendable");if(null==this.recipients()||!this.sender())throw new Error("Sender and/or recipients cannot be null");if(null!=this.body())throw new Error("Body cannot be null");if(null==this.subject()||0===this.subject().length)throw new Error("Subject cannot be null or empty");return this._magisterObj.http.post(""+this._magisterObj._personUrl+"/berichten",this._toMagisterStyle(),{},function(e){if(null!=e)throw e}),!0},Message.prototype.move=function(){},Message.prototype._toMagisterStyle=function(){var obj,p;return obj={},obj.Id=this._id,obj.Inhoud=this._body,obj.MapId=this._folderId,obj.Onderwerp=this._subject,obj.Ontvangers=function(){var _i,_len,_ref,_results;for(_ref=this._recipients,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)p=_ref[_i],_results.push(p._toMagisterStyle());return _results}.call(this),obj.VerstuurdOp=this._sendDate,obj.Begin=this._begin,obj.Einde=this._end,obj.IsGelezen=this._isRead,obj.Status=this._state,obj.HeeftPrioriteit=this._isFlagged,obj.Soort=this._type,obj},Message._convertRaw=function(magisterObj,raw){var a,o,obj;return obj=new Message(magisterObj),obj._id=raw.Id,obj._body=raw.Inhoud,obj._attachments=function(){var _i,_len,_ref,_ref1,_results;for(_ref1=null!=(_ref=raw.Bijlagen)?_ref:[],_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)a=_ref1[_i],_results.push(Attachment._convertRaw(magisterObj,a));return _results}(),obj._folderId=raw.MapId,obj._subject=raw.Onderwerp,obj._sender=Person._convertRaw(magisterObj,raw.Afzender),obj._recipients=function(){var _i,_len,_ref,_results;for(_ref=raw.Ontvangers,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)o=_ref[_i],_results.push(Person._convertRaw(magisterObj,o));return _results}(),obj._sendDate=new Date(Date.parse(raw.VerstuurdOp)),obj._begin=new Date(Date.parse(raw.Begin)),obj._end=new Date(Date.parse(raw.Einde)),obj._isRead=raw.IsGelezen,obj._state=raw.Status,obj._isFlagged=raw.HeeftPrioriteit,obj._type=raw.Soort,obj._canSend=!1,obj},Message}(),findQueries=function(queries){var final,numbers,result;return final="",_.any(["unread","ongelezen"],function(x){return _helpers.contains(queries,x,!0)})?final+="&gelezen=false":_.any(["read","gelezen"],function(x){return _helpers.contains(queries,x,!0)})&&(final+="&gelezen=true"),null!=(result=/(skip \d+)|(sla \d+ over)/gi.exec(queries))&&(numbers=/\d+/.exec(result[0])[0],final+="&skip="+numbers),final},this.MessageFolder=function(){function MessageFolder(_magisterObj){this._magisterObj=_magisterObj,this.name=_getset("_name"),this.unreadMessagesCount=_getset("_unreadMessagesCount"),this.id=_getset("_id"),this.parentId=_getset("_parentId")}return MessageFolder.prototype.messages=function(){var callback,download,limit,queries,url,_ref,_ref1,_ref2;if(limit=null!=(_ref=_.find(arguments,function(a){return _.isNumber(a)}))?_ref:10,queries=null!=(_ref1=_.find(arguments,function(a){return _.isString(a)}))?_ref1:"",download=null!=(_ref2=_.find(arguments,function(a){return _.isBoolean(a)}))?_ref2:!0,callback=_.find(arguments,function(a){return _.isFunction(a)}),null==callback)throw new Error("Callback is null");return 0===limit?void callback(null,[]):(url=""+this._magisterObj._personUrl+"/berichten?mapId="+this.id()+"&top="+limit+findQueries(queries),this._magisterObj.http.get(url,{},function(_this){return function(error,result){var m,messages,pushMessage,_i,_len,_results;if(null!=error)return callback(error,null);for(messages=function(){var _i,_len,_ref3,_results;for(_ref3=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref3.length;_len>_i;_i++)m=_ref3[_i],_results.push(Message._convertRaw(this._magisterObj,m));return _results}.call(_this),pushMessage=_helpers.asyncResultWaiter(messages.length,function(r){return callback(null,r)}),_results=[],_i=0,_len=messages.length;_len>_i;_i++)m=messages[_i],_results.push(function(m){return url=""+_this._magisterObj._personUrl+"/berichten/"+m.id()+"?berichtSoort="+m.type(),_this._magisterObj.http.get(url,{},function(error,result){var pushPeople;return m._body=EJSON.parse(result.content).Inhoud,download?(pushPeople=_helpers.asyncResultWaiter(m.recipients().length+1,function(){return pushMessage(m)}),_this._magisterObj.fillPersons(m.recipients(),function(e,r){return m._recipients=r,pushPeople(r)}),_this._magisterObj.fillPersons(m.sender(),function(e,r){return m._sender=r,pushPeople(r)})):pushMessage(m)})}(m));return _results}}(this)))},MessageFolder.prototype.messageFolders=function(query,callback){var _ref;return callback=null!=(_ref=null!=callback?callback:query)?_ref:function(){},null!=callback?this._magisterObj.http.get(""+this._magisterObj._personUrl+"/berichten/mappen?parentId="+this.id(),{},function(_this){return function(error,result){var mF,messageFolders;return null!=error?callback(error,null):(messageFolders=function(){var _i,_len,_ref1,_results;for(_ref1=EJSON.parse(result.content).Items,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)mF=_ref1[_i],_results.push(MessageFolder._convertRaw(this._magisterObj,mF));return _results}.call(_this),result=_.isString(query)&&""!==query?_.where(messageFolders,function(mF){return Helpers.contains(mF.name(),query,!0)}):messageFolders,callback(null,result))}}(this)):void 0},MessageFolder.prototype.removeAllMessages=function(){return this._magisterObj.http["delete"](""+this._magisterObj._personUrl+"/berichten/map/"+this.id(),{},function(error){if(null!=error)throw error})},MessageFolder.prototype.createMessageFolder=function(name,callback){var folder;return null==callback&&(callback=function(){}),folder={naam:name,parentId:this.id(),persoonId:this._magisterObj._id},this._magisterObj.http.post(""+this._magisterObj._personUrl+"/berichten/mappen",folder,{},function(_this){return function(error,result){return null!=error?callback(error,null):callback(null,MessageFolder._convertRaw(_this._magisterObj,EJSON.parse(result.content)))}}(this))},MessageFolder.prototype.remove=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/berichten/mappen",this._toMagisterStyle(),{},function(e){if(null!=e)throw e})},MessageFolder.prototype._toMagisterStyle=function(){var obj;return obj={},obj.Naam=this._name,obj.OngelezenBerichten=this._unreadMessagesCount,obj.Id=this._id,obj.ParentId=this._parentId,obj},MessageFolder._convertRaw=function(magisterObj,raw){var obj;return obj=new MessageFolder(magisterObj),obj._name=raw.Naam,obj._unreadMessagesCount=raw.OngelezenBerichten,obj._id=raw.Id,obj._parentId=raw.ParentId,obj},MessageFolder}(),this.Person=function(){function Person(_magisterObj,_type,_firstName,_lastName){if(this._magisterObj=_magisterObj,this._type=_type,this._firstName=_firstName,this._lastName=_lastName,null!=this._firstName&&null!=this._lastName&&_.any(_.toArray(arguments).slice(2),function(a){return null!=a&&!_.isString(a)}))throw new Error("One or more arguments is not a string.");this.id=_getset("_id"),this.type=_getset("_type",function(_this){return function(val){return _this._type=Person._convertType(val,!0)}}(this),Person._convertType),this.firstName=_getset("_firstName"),this.lastName=_getset("_lastName"),this.namePrefix=_getset("_namePrefix"),this.fullName=_getset("_fullName"),this.description=_getset("_description"),this.group=_getset("_group"),this.teacherCode=_getset("_teacherCode"),this.emailAddress=_getset("_emailAddress")}return Person.prototype._toMagisterStyle=function(){var obj;return obj={},obj.Id=this._id,obj.Type=this._type,obj.Voornaam=this._firstName,obj.Achternaam=this._lastName,obj.Tussenvoegsel=this._namePrefix,obj.Naam=this._fullName,obj.Omschrijving=this._description,obj.Groep=this._group,obj.Docentcode=this._teacherCode,obj.Emailadres=this._emailAddress,obj},Person._convertRaw=function(magisterObj,raw){var obj,_ref;return obj=new Person(magisterObj,raw.Type,raw.Voornaam,raw.Achternaam),obj._id=raw.Id,obj._namePrefix=raw.Tussenvoegsel,obj._fullName=raw.Naam,obj._description=null!=(_ref=raw.Omschrijving)?_ref:raw.Naam,obj._group=raw.Groep,obj._teacherCode=raw.Docentcode,obj._emailAddress=raw.Emailadres,obj},Person._convertType=function(original,setter){if(null==setter&&(setter=!0),setter){if(_.isNumber(original)){if(!_.contains([1,3,4,8],original))throw new Error('Invalid value: "'+original+'".');return original}switch(original.toLowerCase()){case"group":return 1;case"teacher":return 3;case"pupil":return 4;case"project":return 8;default:throw new Error('Invalid value: "'+original+'".')}}else switch(original){case 1:return"group";case 3:return"teacher";case 4:return"pupil";case 8:return"project";default:return void 0}},Person}(),this.ProfileInfo=function(){function ProfileInfo(_magisterObj,_firstName,_lastName,_birthDate){this._magisterObj=_magisterObj,this._firstName=_firstName,this._lastName=_lastName,this._birthDate=_birthDate,this.id=_getset("_id"),this.officialFirstNames=_getset("_officialFirstNames"),this.initials=_getset("_initials"),this.namePrefix=_getset("_namePrefix"),this.officialSurname=_getset("_officialSurname"),this.birthSurname=_getset("_birthSurname"),this.birthNamePrefix=_getset("_birthNamePrefix"),this.useBirthname=_getset("_useBirthname"),this.firstName=_getset("_firstName"),this.lastName=_getset("_lastName")}return ProfileInfo.prototype.profilePicture=function(width,height,crop){return null==width&&(width=640),null==height&&(height=640),null==crop&&(crop=!1),""+this._profilePicture+"?width="+width+"&height="+height+"&crop="+crop},ProfileInfo._convertRaw=function(magisterObj,raw){var foto,obj;return foto=magisterObj.magisterSchool.url+_.find(raw.Links,{Rel:"Foto"}).Href,raw=raw.Persoon,obj=new ProfileInfo(magisterObj,raw.Roepnaam,raw.Achternaam,new Date(Date.parse(raw.Geboortedatum))),obj._id=raw.Id,obj._officialFirstNames=raw.OfficieleVoornamen,obj._initials=raw.Voorletters,obj._namePrefix=raw.Tussenvoegsel,obj._officialSurname=raw.OfficieleAchternaam,obj._birthSurname=raw.GeboorteAchternaam,obj._birthNamePrefix=raw.GeboortenaamTussenvoegsel,obj._useBirthname=raw.GebruikGeboortenaam,obj._profilePicture=foto,obj},ProfileInfo}(),this.MagisterSchool=function(){function MagisterSchool(name,url){this.name=name,this.url=url}return MagisterSchool.getSchools=function(query,callback){return null==query||_helpers.trim(query).length<3?[]:(new MagisterHttp).get("https://schoolkiezer.magister.net/home/query?filter="+query,{},function(_this){return function(error,result){var s;return null!=error?callback(error,null):callback(null,function(){var _i,_len,_ref,_results;for(_ref=EJSON.parse(result.content),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)s=_ref[_i],_results.push(this._convertRaw(s));return _results}.call(_this))}}(this))},MagisterSchool._convertRaw=function(raw){return new MagisterSchool(raw.Licentie,"https://"+raw.Url.slice(5))},MagisterSchool}(),this.StudyGuide=function(){function StudyGuide(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.from=_getset("_from"),this.to=_getset("_to"),this.classCodes=_getset("_classCodes"),this.name=_getset("_name"),this.archived=_getset("_archived")}return StudyGuide.prototype.parts=function(callback){return null!=callback?this._magisterObj.http.get(""+this._magisterObj._pupilUrl+"/studiewijzers/"+this.id(),{},function(_this){return function(error,result){var id,p,pushResult,_i,_len,_ref,_results;if(null!=error)return callback(error,null);for(result=EJSON.parse(result.content).Onderdelen.Items,pushResult=_helpers.asyncResultWaiter(result.length,function(r){return callback(null,r)}),_ref=function(){var _j,_len,_results1;for(_results1=[],_j=0,_len=result.length;_len>_j;_j++)p=result[_j],_results1.push(p.Id);return _results1}(),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)id=_ref[_i],_results.push(_this._magisterObj.http.get(""+_this._magisterObj._pupilUrl+"/studiewijzers/"+_this.id()+"/onderdelen/"+id,{},function(error,result){return pushResult(StudyGuidePart._convertRaw(_this._magisterObj,EJSON.parse(result.content)))}));return _results}}(this)):void 0},StudyGuide._convertRaw=function(magisterObj,raw){var obj;return obj=new StudyGuide(magisterObj),obj._id=raw.Id,obj._from=new Date(Date.parse(raw.Van)),obj._to=new Date(Date.parse(raw.TotEnMet)),obj._classCodes=raw.VakCodes,obj._name=raw.Titel,obj._archived=raw.InLeerlingArchief,obj},StudyGuide}(),this.StudyGuidePart=function(){function StudyGuidePart(_magisterObj){this._magisterObj=_magisterObj,this.id=_getset("_id"),this.from=_getset("_from"),this.to=_getset("_to"),this.name=_getset("_name"),this.description=_getset("_description",null,function(x){return null!=x?x.replace(/<br ?\/?>/g,"\n").replace(/(<[^>]*>)|(&nbsp;)/g,""):x}),this.visible=_getset("_visible"),this.number=_getset("_number"),this.files=_getset("_files")}return StudyGuidePart._convertRaw=function(magisterObj,raw){var f,obj;return obj=new StudyGuidePart(magisterObj),obj._id=raw.Id,obj._from=new Date(Date.parse(raw.Van)),obj._to=new Date(Date.parse(raw.TotEnMet)),obj._name=raw.Titel,obj._description=raw.Omschrijving,obj._visible=raw.IsZichtbaar,obj._number=raw.Volgnummer,obj._files=function(){var _i,_len,_ref,_results;for(_ref=raw.Bronnen,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],_results.push(File._convertRaw(magisterObj,void 0,f));return _results}(),obj},StudyGuidePart}(),this._helpers=function(){function _helpers(){}return _helpers.addZero=function(original){return 10>original?"0"+original:original.toString()},_helpers.toUtcString=function(original){return new moment(original).format("YYYY-MM-DDTHH:mm:ss.0000000[Z]")},_helpers.pushMore=function(arr,items){return[].push.apply(arr,items),arr},_helpers.contains=function(original,query,ignoreCasing){return null==ignoreCasing&&(ignoreCasing=!1),ignoreCasing?original.toUpperCase().indexOf(query.toUpperCase())>=0:original.indexOf(query)>=0},_helpers.asyncResultWaiter=function(amount,callback){var left,results;return 0===amount&&callback([]),results=[],left=amount,function(result){return _.isArray(result)?(_helpers.pushMore(results,result),left-=result.length):(results.push(result),left--),0===left?callback(results):void 0}},_helpers.trim=function(original){return null==original||0===original.length?"":_.isFunction(String.prototype.trim)?original.trim():original.replace(/^\s+|\s+$/g,"")},_helpers.saveFile=function(rawData,mime,name){try{return saveAs(new Blob([rawData],{type:mime}),name)}catch(_error){}},_helpers.urlDateConvert=function(date){return""+date.getUTCFullYear()+"-"+_helpers.addZero(date.getMonth()+1)+"-"+_helpers.addZero(date.getDate())},_helpers.date=function(date){return new Date(date.getUTCFullYear(),date.getMonth(),date.getDate())},_helpers}(),this._getset=function(varName,setter,getter){return function(newVar){if(null!=newVar){if(!_.isFunction(setter))throw new Error("Changes on this property aren't allowed");setter(newVar,!0)}return _.isFunction(getter)?getter(this[varName],!1):this[varName]}},null==Array.isArray&&(_.isArray=jQuery.isArray=Array.isArray=function(x){return Object.prototype.toString.call("[object Array]"===x)}),function(){function n(n,t,e){e=(e||0)-1;for(var r=n?n.length:0;++e<r;)if(n[e]===t)return e;return-1}function t(t,e){var r=typeof e;if(t=t.l,"boolean"==r||null==e)return t[e]?0:-1;"number"!=r&&"string"!=r&&(r="object");var u="number"==r?e:m+e;return t=(t=t[r])&&t[u],"object"==r?t&&-1<n(t,e)?0:-1:t?0:-1}function e(n){var t=this.l,e=typeof n;if("boolean"==e||null==n)t[n]=!0;else{"number"!=e&&"string"!=e&&(e="object");var r="number"==e?n:m+n,t=t[e]||(t[e]={});"object"==e?(t[r]||(t[r]=[])).push(n):t[r]=!0}}function r(n){return n.charCodeAt(0)}function u(n,t){for(var e=n.m,r=t.m,u=-1,o=e.length;++u<o;){var i=e[u],a=r[u];if(i!==a){if(i>a||"undefined"==typeof i)return 1;if(a>i||"undefined"==typeof a)return-1}}return n.n-t.n}function o(n){var t=-1,r=n.length,u=n[0],o=n[r/2|0],i=n[r-1];if(u&&"object"==typeof u&&o&&"object"==typeof o&&i&&"object"==typeof i)return!1;for(u=f(),u["false"]=u["null"]=u["true"]=u.undefined=!1,o=f(),o.k=n,o.l=u,o.push=e;++t<r;)o.push(n[t]);return o}function i(n){return"\\"+U[n]}function a(){return h.pop()||[]}function f(){return g.pop()||{k:null,l:null,m:null,"false":!1,n:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,o:null}}function l(n){n.length=0,h.length<_&&h.push(n)}function c(n){var t=n.l;t&&c(t),n.k=n.l=n.m=n.object=n.number=n.string=n.o=null,g.length<_&&g.push(n)}function p(n,t,e){t||(t=0),"undefined"==typeof e&&(e=n?n.length:0);var r=-1;e=e-t||0;for(var u=Array(0>e?0:e);++r<e;)u[r]=n[t+r];return u}function s(e){function h(n,t,e){if(!n||!V[typeof n])return n;t=t&&"undefined"==typeof e?t:tt(t,e,3);for(var r=-1,u=V[typeof n]&&Fe(n),o=u?u.length:0;++r<o&&(e=u[r],!1!==t(n[e],e,n)););return n}function g(n,t,e){var r;if(!n||!V[typeof n])return n;t=t&&"undefined"==typeof e?t:tt(t,e,3);for(r in n)if(!1===t(n[r],r,n))break;return n}function _(n,t,e){var r,u=n,o=u;if(!u)return o;for(var i=arguments,a=0,f="number"==typeof e?2:i.length;++a<f;)if((u=i[a])&&V[typeof u])for(var l=-1,c=V[typeof u]&&Fe(u),p=c?c.length:0;++l<p;)r=c[l],"undefined"==typeof o[r]&&(o[r]=u[r]);return o}function U(n,t,e){var r,u=n,o=u;if(!u)return o;var i=arguments,a=0,f="number"==typeof e?2:i.length;if(f>3&&"function"==typeof i[f-2])var l=tt(i[--f-1],i[f--],2);else f>2&&"function"==typeof i[f-1]&&(l=i[--f]);for(;++a<f;)if((u=i[a])&&V[typeof u])for(var c=-1,p=V[typeof u]&&Fe(u),s=p?p.length:0;++c<s;)r=p[c],o[r]=l?l(o[r],u[r]):u[r];return o}function H(n){var t,e=[];if(!n||!V[typeof n])return e;for(t in n)me.call(n,t)&&e.push(t);return e}function J(n){return n&&"object"==typeof n&&!Te(n)&&me.call(n,"__wrapped__")?n:new Q(n)}function Q(n,t){this.__chain__=!!t,this.__wrapped__=n}function X(n){function t(){if(r){var n=p(r);be.apply(n,arguments)}if(this instanceof t){var o=nt(e.prototype),n=e.apply(o,n||arguments);return wt(n)?n:o}return e.apply(u,n||arguments)}var e=n[0],r=n[2],u=n[4];return $e(t,n),t}function Z(n,t,e,r,u){if(e){var o=e(n);if("undefined"!=typeof o)return o}if(!wt(n))return n;var i=ce.call(n);if(!K[i])return n;var f=Ae[i];switch(i){case T:case F:return new f(+n);case W:case P:return new f(n);case z:return o=f(n.source,C.exec(n)),o.lastIndex=n.lastIndex,o}if(i=Te(n),t){var c=!r;r||(r=a()),u||(u=a());for(var s=r.length;s--;)if(r[s]==n)return u[s];o=i?f(n.length):{}}else o=i?p(n):U({},n);return i&&(me.call(n,"index")&&(o.index=n.index),me.call(n,"input")&&(o.input=n.input)),t?(r.push(n),u.push(o),(i?St:h)(n,function(n,i){o[i]=Z(n,t,e,r,u)}),c&&(l(r),l(u)),o):o}function nt(n){return wt(n)?ke(n):{}}function tt(n,t,e){if("function"!=typeof n)return Ut;if("undefined"==typeof t||!("prototype"in n))return n;var r=n.__bindData__;if("undefined"==typeof r&&(De.funcNames&&(r=!n.name),r=r||!De.funcDecomp,!r)){var u=ge.call(n);De.funcNames||(r=!O.test(u)),r||(r=E.test(u),$e(n,r))}if(!1===r||!0!==r&&1&r[1])return n;switch(e){case 1:return function(e){return n.call(t,e)};case 2:return function(e,r){return n.call(t,e,r)};case 3:return function(e,r,u){return n.call(t,e,r,u)};case 4:return function(e,r,u,o){return n.call(t,e,r,u,o)}}return Mt(n,t)}function et(n){function t(){var n=f?i:this;if(u){var h=p(u);be.apply(h,arguments)}return(o||c)&&(h||(h=p(arguments)),o&&be.apply(h,o),c&&h.length<a)?(r|=16,et([e,s?r:-4&r,h,null,i,a])):(h||(h=arguments),l&&(e=n[v]),this instanceof t?(n=nt(e.prototype),h=e.apply(n,h),wt(h)?h:n):e.apply(n,h))}var e=n[0],r=n[1],u=n[2],o=n[3],i=n[4],a=n[5],f=1&r,l=2&r,c=4&r,s=8&r,v=e;return $e(t,n),t}function rt(e,r){var u=-1,i=st(),a=e?e.length:0,f=a>=b&&i===n,l=[];if(f){var p=o(r);p?(i=t,r=p):f=!1}for(;++u<a;)p=e[u],0>i(r,p)&&l.push(p);return f&&c(r),l}function ut(n,t,e,r){r=(r||0)-1;for(var u=n?n.length:0,o=[];++r<u;){var i=n[r];if(i&&"object"==typeof i&&"number"==typeof i.length&&(Te(i)||yt(i))){t||(i=ut(i,t,e));var a=-1,f=i.length,l=o.length;for(o.length+=f;++a<f;)o[l++]=i[a]}else e||o.push(i)}return o}function ot(n,t,e,r,u,o){if(e){var i=e(n,t);if("undefined"!=typeof i)return!!i}if(n===t)return 0!==n||1/n==1/t;if(n===n&&!(n&&V[typeof n]||t&&V[typeof t]))return!1;if(null==n||null==t)return n===t;var f=ce.call(n),c=ce.call(t);if(f==D&&(f=q),c==D&&(c=q),f!=c)return!1;switch(f){case T:case F:return+n==+t;case W:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case z:case P:return n==oe(t)}if(c=f==$,!c){var p=me.call(n,"__wrapped__"),s=me.call(t,"__wrapped__");if(p||s)return ot(p?n.__wrapped__:n,s?t.__wrapped__:t,e,r,u,o);if(f!=q)return!1;if(f=n.constructor,p=t.constructor,f!=p&&!(dt(f)&&f instanceof f&&dt(p)&&p instanceof p)&&"constructor"in n&&"constructor"in t)return!1}for(f=!u,u||(u=a()),o||(o=a()),p=u.length;p--;)if(u[p]==n)return o[p]==t;var v=0,i=!0;if(u.push(n),o.push(t),c){if(p=n.length,v=t.length,(i=v==p)||r)for(;v--;)if(c=p,s=t[v],r)for(;c--&&!(i=ot(n[c],s,e,r,u,o)););else if(!(i=ot(n[v],s,e,r,u,o)))break}else g(t,function(t,a,f){return me.call(f,a)?(v++,i=me.call(n,a)&&ot(n[a],t,e,r,u,o)):void 0}),i&&!r&&g(n,function(n,t,e){return me.call(e,t)?i=-1<--v:void 0});return u.pop(),o.pop(),f&&(l(u),l(o)),i}function it(n,t,e,r,u){(Te(t)?St:h)(t,function(t,o){var i,a,f=t,l=n[o];if(t&&((a=Te(t))||Pe(t))){for(f=r.length;f--;)if(i=r[f]==t){l=u[f];break}if(!i){var c;e&&(f=e(l,t),c="undefined"!=typeof f)&&(l=f),c||(l=a?Te(l)?l:[]:Pe(l)?l:{}),r.push(t),u.push(l),c||it(l,t,e,r,u)}}else e&&(f=e(l,t),"undefined"==typeof f&&(f=t)),"undefined"!=typeof f&&(l=f);n[o]=l})}function at(n,t){return n+he(Re()*(t-n+1))}function ft(e,r,u){var i=-1,f=st(),p=e?e.length:0,s=[],v=!r&&p>=b&&f===n,h=u||v?a():s;for(v&&(h=o(h),f=t);++i<p;){var g=e[i],y=u?u(g,i,e):g;(r?!i||h[h.length-1]!==y:0>f(h,y))&&((u||v)&&h.push(y),s.push(g))}return v?(l(h.k),c(h)):u&&l(h),s}function lt(n){return function(t,e,r){var u={};e=J.createCallback(e,r,3),r=-1;var o=t?t.length:0;if("number"==typeof o)for(;++r<o;){var i=t[r];n(u,i,e(i,r,t),t)}else h(t,function(t,r,o){n(u,t,e(t,r,o),o)});return u}}function ct(n,t,e,r,u,o){var i=1&t,a=4&t,f=16&t,l=32&t;if(!(2&t||dt(n)))throw new ie;f&&!e.length&&(t&=-17,f=e=!1),l&&!r.length&&(t&=-33,l=r=!1);var c=n&&n.__bindData__;return c&&!0!==c?(c=p(c),c[2]&&(c[2]=p(c[2])),c[3]&&(c[3]=p(c[3])),!i||1&c[1]||(c[4]=u),!i&&1&c[1]&&(t|=8),!a||4&c[1]||(c[5]=o),f&&be.apply(c[2]||(c[2]=[]),e),l&&we.apply(c[3]||(c[3]=[]),r),c[1]|=t,ct.apply(null,c)):(1==t||17===t?X:et)([n,t,e,r,u,o])}function pt(n){return Be[n]}function st(){var t=(t=J.indexOf)===Wt?n:t;return t}function vt(n){return"function"==typeof n&&pe.test(n)}function ht(n){var t,e;return n&&ce.call(n)==q&&(t=n.constructor,!dt(t)||t instanceof t)?(g(n,function(n,t){e=t}),"undefined"==typeof e||me.call(n,e)):!1}function gt(n){return We[n]}function yt(n){return n&&"object"==typeof n&&"number"==typeof n.length&&ce.call(n)==D||!1}function mt(n,t,e){var r=Fe(n),u=r.length;for(t=tt(t,e,3);u--&&(e=r[u],!1!==t(n[e],e,n)););return n}function bt(n){var t=[];return g(n,function(n,e){dt(n)&&t.push(e)}),t.sort()}function _t(n){for(var t=-1,e=Fe(n),r=e.length,u={};++t<r;){var o=e[t];u[n[o]]=o}return u}function dt(n){return"function"==typeof n}function wt(n){return!(!n||!V[typeof n])}function jt(n){return"number"==typeof n||n&&"object"==typeof n&&ce.call(n)==W||!1}function kt(n){return"string"==typeof n||n&&"object"==typeof n&&ce.call(n)==P||!1}function xt(n){for(var t=-1,e=Fe(n),r=e.length,u=Xt(r);++t<r;)u[t]=n[e[t]];return u}function Ct(n,t,e){var r=-1,u=st(),o=n?n.length:0,i=!1;return e=(0>e?Ie(0,o+e):e)||0,Te(n)?i=-1<u(n,t,e):"number"==typeof o?i=-1<(kt(n)?n.indexOf(t,e):u(n,t,e)):h(n,function(n){return++r<e?void 0:!(i=n===t)}),i}function Ot(n,t,e){var r=!0;t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if("number"==typeof u)for(;++e<u&&(r=!!t(n[e],e,n)););else h(n,function(n,e,u){return r=!!t(n,e,u)});return r}function Nt(n,t,e){var r=[];t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if("number"==typeof u)for(;++e<u;){var o=n[e];t(o,e,n)&&r.push(o)}else h(n,function(n,e,u){t(n,e,u)&&r.push(n)});return r}function It(n,t,e){t=J.createCallback(t,e,3),e=-1;var r=n?n.length:0;if("number"!=typeof r){var u;return h(n,function(n,e,r){return t(n,e,r)?(u=n,!1):void 0}),u}for(;++e<r;){var o=n[e];if(t(o,e,n))return o}}function St(n,t,e){var r=-1,u=n?n.length:0;if(t=t&&"undefined"==typeof e?t:tt(t,e,3),"number"==typeof u)for(;++r<u&&!1!==t(n[r],r,n););else h(n,t);return n}function Et(n,t,e){var r=n?n.length:0;if(t=t&&"undefined"==typeof e?t:tt(t,e,3),"number"==typeof r)for(;r--&&!1!==t(n[r],r,n););else{var u=Fe(n),r=u.length;h(n,function(n,e,o){return e=u?u[--r]:--r,t(o[e],e,o)})}return n}function Rt(n,t,e){var r=-1,u=n?n.length:0;if(t=J.createCallback(t,e,3),"number"==typeof u)for(var o=Xt(u);++r<u;)o[r]=t(n[r],r,n);else o=[],h(n,function(n,e,u){o[++r]=t(n,e,u)});return o}function At(n,t,e){var u=-1/0,o=u;if("function"!=typeof t&&e&&e[t]===n&&(t=null),null==t&&Te(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];a>o&&(o=a)}}else t=null==t&&kt(n)?r:J.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),e>u&&(u=e,o=n)});return o}function Dt(n,t,e,r){if(!n)return e;var u=3>arguments.length;t=J.createCallback(t,r,4);var o=-1,i=n.length;if("number"==typeof i)for(u&&(e=n[++o]);++o<i;)e=t(e,n[o],o,n);else h(n,function(n,r,o){e=u?(u=!1,n):t(e,n,r,o)});return e}function $t(n,t,e,r){var u=3>arguments.length;return t=J.createCallback(t,r,4),Et(n,function(n,r,o){e=u?(u=!1,n):t(e,n,r,o)}),e}function Tt(n){var t=-1,e=n?n.length:0,r=Xt("number"==typeof e?e:0);return St(n,function(n){var e=at(0,++t);r[t]=r[e],r[e]=n}),r}function Ft(n,t,e){var r;t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if("number"==typeof u)for(;++e<u&&!(r=t(n[e],e,n)););else h(n,function(n,e,u){return!(r=t(n,e,u))});return!!r}function Bt(n,t,e){var r=0,u=n?n.length:0;if("number"!=typeof t&&null!=t){var o=-1;for(t=J.createCallback(t,e,3);++o<u&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[0]:v;return p(n,0,Se(Ie(0,r),u))}function Wt(t,e,r){if("number"==typeof r){var u=t?t.length:0;r=0>r?Ie(0,u+r):r||0}else if(r)return r=zt(t,e),t[r]===e?r:-1;return n(t,e,r)}function qt(n,t,e){if("number"!=typeof t&&null!=t){var r=0,u=-1,o=n?n.length:0;for(t=J.createCallback(t,e,3);++u<o&&t(n[u],u,n);)r++}else r=null==t||e?1:Ie(0,t);return p(n,r)}function zt(n,t,e,r){var u=0,o=n?n.length:u;for(e=e?J.createCallback(e,r,1):Ut,t=e(t);o>u;)r=u+o>>>1,e(n[r])<t?u=r+1:o=r;return u}function Pt(n,t,e,r){return"boolean"!=typeof t&&null!=t&&(r=e,e="function"!=typeof t&&r&&r[t]===n?null:t,t=!1),null!=e&&(e=J.createCallback(e,r,3)),ft(n,t,e)}function Kt(){for(var n=1<arguments.length?arguments:arguments[0],t=-1,e=n?At(Ve(n,"length")):0,r=Xt(0>e?0:e);++t<e;)r[t]=Ve(n,t);return r}function Lt(n,t){var e=-1,r=n?n.length:0,u={};for(t||!r||Te(n[0])||(t=[]);++e<r;){var o=n[e];t?u[o]=t[e]:o&&(u[o[0]]=o[1])}return u}function Mt(n,t){return 2<arguments.length?ct(n,17,p(arguments,2),null,t):ct(n,1,null,null,t)}function Vt(n,t,e){function r(){c&&ve(c),i=c=p=v,(g||h!==t)&&(s=Ue(),a=n.apply(l,o),c||i||(o=l=null))}function u(){var e=t-(Ue()-f);e>0?c=_e(u,e):(i&&ve(i),e=p,i=c=p=v,e&&(s=Ue(),a=n.apply(l,o),c||i||(o=l=null)))}var o,i,a,f,l,c,p,s=0,h=!1,g=!0;if(!dt(n))throw new ie;if(t=Ie(0,t)||0,!0===e)var y=!0,g=!1;else wt(e)&&(y=e.leading,h="maxWait"in e&&(Ie(t,e.maxWait)||0),g="trailing"in e?e.trailing:g);return function(){if(o=arguments,f=Ue(),l=this,p=g&&(c||!y),!1===h)var e=y&&!c;else{i||y||(s=f);var v=h-(f-s),m=0>=v;m?(i&&(i=ve(i)),s=f,a=n.apply(l,o)):i||(i=_e(r,v))}return m&&c?c=ve(c):c||t===h||(c=_e(u,t)),e&&(m=!0,a=n.apply(l,o)),!m||c||i||(o=l=null),a}}function Ut(n){return n}function Gt(n,t,e){var r=!0,u=t&&bt(t);t&&(e||u.length)||(null==e&&(e=t),o=Q,t=n,n=J,u=bt(t)),!1===e?r=!1:wt(e)&&"chain"in e&&(r=e.chain);var o=n,i=dt(o);St(u,function(e){var u=n[e]=t[e];i&&(o.prototype[e]=function(){var t=this.__chain__,e=this.__wrapped__,i=[e];if(be.apply(i,arguments),i=u.apply(n,i),r||t){if(e===i&&wt(i))return this;i=new o(i),i.__chain__=t}return i})})}function Ht(){}function Jt(n){return function(t){return t[n]}}function Qt(){return this.__wrapped__}e=e?Y.defaults(G.Object(),e,Y.pick(G,A)):G;var Xt=e.Array,Yt=e.Boolean,Zt=e.Date,ne=e.Function,te=e.Math,ee=e.Number,re=e.Object,ue=e.RegExp,oe=e.String,ie=e.TypeError,ae=[],fe=re.prototype,le=e._,ce=fe.toString,pe=ue("^"+oe(ce).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),se=te.ceil,ve=e.clearTimeout,he=te.floor,ge=ne.prototype.toString,ye=vt(ye=re.getPrototypeOf)&&ye,me=fe.hasOwnProperty,be=ae.push,_e=e.setTimeout,de=ae.splice,we=ae.unshift,je=function(){try{var n={},t=vt(t=re.defineProperty)&&t,e=t(n,n,n)&&t}catch(r){}return e}(),ke=vt(ke=re.create)&&ke,xe=vt(xe=Xt.isArray)&&xe,Ce=e.isFinite,Oe=e.isNaN,Ne=vt(Ne=re.keys)&&Ne,Ie=te.max,Se=te.min,Ee=e.parseInt,Re=te.random,Ae={};Ae[$]=Xt,Ae[T]=Yt,Ae[F]=Zt,Ae[B]=ne,Ae[q]=re,Ae[W]=ee,Ae[z]=ue,Ae[P]=oe,Q.prototype=J.prototype;var De=J.support={};De.funcDecomp=!vt(e.a)&&E.test(s),De.funcNames="string"==typeof ne.name,J.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:N,variable:"",imports:{_:J}},ke||(nt=function(){function n(){}return function(t){if(wt(t)){n.prototype=t;var r=new n;n.prototype=null}return r||e.Object()}}());var $e=je?function(n,t){M.value=t,je(n,"__bindData__",M)}:Ht,Te=xe||function(n){return n&&"object"==typeof n&&"number"==typeof n.length&&ce.call(n)==$||!1},Fe=Ne?function(n){return wt(n)?Ne(n):[]}:H,Be={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},We=_t(Be),qe=ue("("+Fe(We).join("|")+")","g"),ze=ue("["+Fe(Be).join("")+"]","g"),Pe=ye?function(n){if(!n||ce.call(n)!=q)return!1;var t=n.valueOf,e=vt(t)&&(e=ye(t))&&ye(e);return e?n==e||ye(n)==e:ht(n)}:ht,Ke=lt(function(n,t,e){me.call(n,e)?n[e]++:n[e]=1}),Le=lt(function(n,t,e){(me.call(n,e)?n[e]:n[e]=[]).push(t)}),Me=lt(function(n,t,e){n[e]=t}),Ve=Rt,Ue=vt(Ue=Zt.now)&&Ue||function(){return(new Zt).getTime()},Ge=8==Ee(d+"08")?Ee:function(n,t){return Ee(kt(n)?n.replace(I,""):n,t||0)};return J.after=function(n,t){if(!dt(t))throw new ie;return function(){return 1>--n?t.apply(this,arguments):void 0}},J.assign=U,J.at=function(n){for(var t=arguments,e=-1,r=ut(t,!0,!1,1),t=t[2]&&t[2][t[1]]===n?1:r.length,u=Xt(t);++e<t;)u[e]=n[r[e]];
return u},J.bind=Mt,J.bindAll=function(n){for(var t=1<arguments.length?ut(arguments,!0,!1,1):bt(n),e=-1,r=t.length;++e<r;){var u=t[e];n[u]=ct(n[u],1,null,null,n)}return n},J.bindKey=function(n,t){return 2<arguments.length?ct(t,19,p(arguments,2),null,n):ct(t,3,null,null,n)},J.chain=function(n){return n=new Q(n),n.__chain__=!0,n},J.compact=function(n){for(var t=-1,e=n?n.length:0,r=[];++t<e;){var u=n[t];u&&r.push(u)}return r},J.compose=function(){for(var n=arguments,t=n.length;t--;)if(!dt(n[t]))throw new ie;return function(){for(var t=arguments,e=n.length;e--;)t=[n[e].apply(this,t)];return t[0]}},J.constant=function(n){return function(){return n}},J.countBy=Ke,J.create=function(n,t){var e=nt(n);return t?U(e,t):e},J.createCallback=function(n,t,e){var r=typeof n;if(null==n||"function"==r)return tt(n,t,e);if("object"!=r)return Jt(n);var u=Fe(n),o=u[0],i=n[o];return 1!=u.length||i!==i||wt(i)?function(t){for(var e=u.length,r=!1;e--&&(r=ot(t[u[e]],n[u[e]],null,!0)););return r}:function(n){return n=n[o],i===n&&(0!==i||1/i==1/n)}},J.curry=function(n,t){return t="number"==typeof t?t:+t||n.length,ct(n,4,null,null,null,t)},J.debounce=Vt,J.defaults=_,J.defer=function(n){if(!dt(n))throw new ie;var t=p(arguments,1);return _e(function(){n.apply(v,t)},1)},J.delay=function(n,t){if(!dt(n))throw new ie;var e=p(arguments,2);return _e(function(){n.apply(v,e)},t)},J.difference=function(n){return rt(n,ut(arguments,!0,!0,1))},J.filter=Nt,J.flatten=function(n,t,e,r){return"boolean"!=typeof t&&null!=t&&(r=e,e="function"!=typeof t&&r&&r[t]===n?null:t,t=!1),null!=e&&(n=Rt(n,e,r)),ut(n,t)},J.forEach=St,J.forEachRight=Et,J.forIn=g,J.forInRight=function(n,t,e){var r=[];g(n,function(n,t){r.push(t,n)});var u=r.length;for(t=tt(t,e,3);u--&&!1!==t(r[u--],r[u],n););return n},J.forOwn=h,J.forOwnRight=mt,J.functions=bt,J.groupBy=Le,J.indexBy=Me,J.initial=function(n,t,e){var r=0,u=n?n.length:0;if("number"!=typeof t&&null!=t){var o=u;for(t=J.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else r=null==t||e?1:t||r;return p(n,0,Se(Ie(0,u-r),u))},J.intersection=function(){for(var e=[],r=-1,u=arguments.length,i=a(),f=st(),p=f===n,s=a();++r<u;){var v=arguments[r];(Te(v)||yt(v))&&(e.push(v),i.push(p&&v.length>=b&&o(r?e[r]:s)))}var p=e[0],h=-1,g=p?p.length:0,y=[];n:for(;++h<g;){var m=i[0],v=p[h];if(0>(m?t(m,v):f(s,v))){for(r=u,(m||s).push(v);--r;)if(m=i[r],0>(m?t(m,v):f(e[r],v)))continue n;y.push(v)}}for(;u--;)(m=i[u])&&c(m);return l(i),l(s),y},J.invert=_t,J.invoke=function(n,t){var e=p(arguments,2),r=-1,u="function"==typeof t,o=n?n.length:0,i=Xt("number"==typeof o?o:0);return St(n,function(n){i[++r]=(u?t:n[t]).apply(n,e)}),i},J.keys=Fe,J.map=Rt,J.mapValues=function(n,t,e){var r={};return t=J.createCallback(t,e,3),h(n,function(n,e,u){r[e]=t(n,e,u)}),r},J.max=At,J.memoize=function(n,t){function e(){var r=e.cache,u=t?t.apply(this,arguments):m+arguments[0];return me.call(r,u)?r[u]:r[u]=n.apply(this,arguments)}if(!dt(n))throw new ie;return e.cache={},e},J.merge=function(n){var t=arguments,e=2;if(!wt(n))return n;if("number"!=typeof t[2]&&(e=t.length),e>3&&"function"==typeof t[e-2])var r=tt(t[--e-1],t[e--],2);else e>2&&"function"==typeof t[e-1]&&(r=t[--e]);for(var t=p(arguments,1,e),u=-1,o=a(),i=a();++u<e;)it(n,t[u],r,o,i);return l(o),l(i),n},J.min=function(n,t,e){var u=1/0,o=u;if("function"!=typeof t&&e&&e[t]===n&&(t=null),null==t&&Te(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];o>a&&(o=a)}}else t=null==t&&kt(n)?r:J.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),u>e&&(u=e,o=n)});return o},J.omit=function(n,t,e){var r={};if("function"!=typeof t){var u=[];g(n,function(n,t){u.push(t)});for(var u=rt(u,ut(arguments,!0,!1,1)),o=-1,i=u.length;++o<i;){var a=u[o];r[a]=n[a]}}else t=J.createCallback(t,e,3),g(n,function(n,e,u){t(n,e,u)||(r[e]=n)});return r},J.once=function(n){var t,e;if(!dt(n))throw new ie;return function(){return t?e:(t=!0,e=n.apply(this,arguments),n=null,e)}},J.pairs=function(n){for(var t=-1,e=Fe(n),r=e.length,u=Xt(r);++t<r;){var o=e[t];u[t]=[o,n[o]]}return u},J.partial=function(n){return ct(n,16,p(arguments,1))},J.partialRight=function(n){return ct(n,32,null,p(arguments,1))},J.pick=function(n,t,e){var r={};if("function"!=typeof t)for(var u=-1,o=ut(arguments,!0,!1,1),i=wt(n)?o.length:0;++u<i;){var a=o[u];a in n&&(r[a]=n[a])}else t=J.createCallback(t,e,3),g(n,function(n,e,u){t(n,e,u)&&(r[e]=n)});return r},J.pluck=Ve,J.property=Jt,J.pull=function(n){for(var t=arguments,e=0,r=t.length,u=n?n.length:0;++e<r;)for(var o=-1,i=t[e];++o<u;)n[o]===i&&(de.call(n,o--,1),u--);return n},J.range=function(n,t,e){n=+n||0,e="number"==typeof e?e:+e||1,null==t&&(t=n,n=0);var r=-1;t=Ie(0,se((t-n)/(e||1)));for(var u=Xt(t);++r<t;)u[r]=n,n+=e;return u},J.reject=function(n,t,e){return t=J.createCallback(t,e,3),Nt(n,function(n,e,r){return!t(n,e,r)})},J.remove=function(n,t,e){var r=-1,u=n?n.length:0,o=[];for(t=J.createCallback(t,e,3);++r<u;)e=n[r],t(e,r,n)&&(o.push(e),de.call(n,r--,1),u--);return o},J.rest=qt,J.shuffle=Tt,J.sortBy=function(n,t,e){var r=-1,o=Te(t),i=n?n.length:0,p=Xt("number"==typeof i?i:0);for(o||(t=J.createCallback(t,e,3)),St(n,function(n,e,u){var i=p[++r]=f();o?i.m=Rt(t,function(t){return n[t]}):(i.m=a())[0]=t(n,e,u),i.n=r,i.o=n}),i=p.length,p.sort(u);i--;)n=p[i],p[i]=n.o,o||l(n.m),c(n);return p},J.tap=function(n,t){return t(n),n},J.throttle=function(n,t,e){var r=!0,u=!0;if(!dt(n))throw new ie;return!1===e?r=!1:wt(e)&&(r="leading"in e?e.leading:r,u="trailing"in e?e.trailing:u),L.leading=r,L.maxWait=t,L.trailing=u,Vt(n,t,L)},J.times=function(n,t,e){n=-1<(n=+n)?n:0;var r=-1,u=Xt(n);for(t=tt(t,e,1);++r<n;)u[r]=t(r);return u},J.toArray=function(n){return n&&"number"==typeof n.length?p(n):xt(n)},J.transform=function(n,t,e,r){var u=Te(n);if(null==e)if(u)e=[];else{var o=n&&n.constructor;e=nt(o&&o.prototype)}return t&&(t=J.createCallback(t,r,4),(u?St:h)(n,function(n,r,u){return t(e,n,r,u)})),e},J.union=function(){return ft(ut(arguments,!0,!0))},J.uniq=Pt,J.values=xt,J.where=Nt,J.without=function(n){return rt(n,p(arguments,1))},J.wrap=function(n,t){return ct(t,16,[n])},J.xor=function(){for(var n=-1,t=arguments.length;++n<t;){var e=arguments[n];if(Te(e)||yt(e))var r=r?ft(rt(r,e).concat(rt(e,r))):e}return r||[]},J.zip=Kt,J.zipObject=Lt,J.collect=Rt,J.drop=qt,J.each=St,J.eachRight=Et,J.extend=U,J.methods=bt,J.object=Lt,J.select=Nt,J.tail=qt,J.unique=Pt,J.unzip=Kt,Gt(J),J.clone=function(n,t,e,r){return"boolean"!=typeof t&&null!=t&&(r=e,e=t,t=!1),Z(n,t,"function"==typeof e&&tt(e,r,1))},J.cloneDeep=function(n,t,e){return Z(n,!0,"function"==typeof t&&tt(t,e,1))},J.contains=Ct,J.escape=function(n){return null==n?"":oe(n).replace(ze,pt)},J.every=Ot,J.find=It,J.findIndex=function(n,t,e){var r=-1,u=n?n.length:0;for(t=J.createCallback(t,e,3);++r<u;)if(t(n[r],r,n))return r;return-1},J.findKey=function(n,t,e){var r;return t=J.createCallback(t,e,3),h(n,function(n,e,u){return t(n,e,u)?(r=e,!1):void 0}),r},J.findLast=function(n,t,e){var r;return t=J.createCallback(t,e,3),Et(n,function(n,e,u){return t(n,e,u)?(r=n,!1):void 0}),r},J.findLastIndex=function(n,t,e){var r=n?n.length:0;for(t=J.createCallback(t,e,3);r--;)if(t(n[r],r,n))return r;return-1},J.findLastKey=function(n,t,e){var r;return t=J.createCallback(t,e,3),mt(n,function(n,e,u){return t(n,e,u)?(r=e,!1):void 0}),r},J.has=function(n,t){return n?me.call(n,t):!1},J.identity=Ut,J.indexOf=Wt,J.isArguments=yt,J.isArray=Te,J.isBoolean=function(n){return!0===n||!1===n||n&&"object"==typeof n&&ce.call(n)==T||!1},J.isDate=function(n){return n&&"object"==typeof n&&ce.call(n)==F||!1},J.isElement=function(n){return n&&1===n.nodeType||!1},J.isEmpty=function(n){var t=!0;if(!n)return t;var e=ce.call(n),r=n.length;return e==$||e==P||e==D||e==q&&"number"==typeof r&&dt(n.splice)?!r:(h(n,function(){return t=!1}),t)},J.isEqual=function(n,t,e,r){return ot(n,t,"function"==typeof e&&tt(e,r,2))},J.isFinite=function(n){return Ce(n)&&!Oe(parseFloat(n))},J.isFunction=dt,J.isNaN=function(n){return jt(n)&&n!=+n},J.isNull=function(n){return null===n},J.isNumber=jt,J.isObject=wt,J.isPlainObject=Pe,J.isRegExp=function(n){return n&&"object"==typeof n&&ce.call(n)==z||!1},J.isString=kt,J.isUndefined=function(n){return"undefined"==typeof n},J.lastIndexOf=function(n,t,e){var r=n?n.length:0;for("number"==typeof e&&(r=(0>e?Ie(0,r+e):Se(e,r-1))+1);r--;)if(n[r]===t)return r;return-1},J.mixin=Gt,J.noConflict=function(){return e._=le,this},J.noop=Ht,J.now=Ue,J.parseInt=Ge,J.random=function(n,t,e){var r=null==n,u=null==t;return null==e&&("boolean"==typeof n&&u?(e=n,n=1):u||"boolean"!=typeof t||(e=t,u=!0)),r&&u&&(t=1),n=+n||0,u?(t=n,n=0):t=+t||0,e||n%1||t%1?(e=Re(),Se(n+e*(t-n+parseFloat("1e-"+((e+"").length-1))),t)):at(n,t)},J.reduce=Dt,J.reduceRight=$t,J.result=function(n,t){if(n){var e=n[t];return dt(e)?n[t]():e}},J.runInContext=s,J.size=function(n){var t=n?n.length:0;return"number"==typeof t?t:Fe(n).length},J.some=Ft,J.sortedIndex=zt,J.template=function(n,t,e){var r=J.templateSettings;n=oe(n||""),e=_({},e,r);var u,o=_({},e.imports,r.imports),r=Fe(o),o=xt(o),a=0,f=e.interpolate||S,l="__p+='",f=ue((e.escape||S).source+"|"+f.source+"|"+(f===N?x:S).source+"|"+(e.evaluate||S).source+"|$","g");n.replace(f,function(t,e,r,o,f,c){return r||(r=o),l+=n.slice(a,c).replace(R,i),e&&(l+="'+__e("+e+")+'"),f&&(u=!0,l+="';"+f+";\n__p+='"),r&&(l+="'+((__t=("+r+"))==null?'':__t)+'"),a=c+t.length,t}),l+="';",f=e=e.variable,f||(e="obj",l="with("+e+"){"+l+"}"),l=(u?l.replace(w,""):l).replace(j,"$1").replace(k,"$1;"),l="function("+e+"){"+(f?"":e+"||("+e+"={});")+"var __t,__p='',__e=_.escape"+(u?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}";try{var c=ne(r,"return "+l).apply(v,o)}catch(p){throw p.source=l,p}return t?c(t):(c.source=l,c)},J.unescape=function(n){return null==n?"":oe(n).replace(qe,gt)},J.uniqueId=function(n){var t=++y;return oe(null==n?"":n)+t},J.all=Ot,J.any=Ft,J.detect=It,J.findWhere=It,J.foldl=Dt,J.foldr=$t,J.include=Ct,J.inject=Dt,Gt(function(){var n={};return h(J,function(t,e){J.prototype[e]||(n[e]=t)}),n}(),!1),J.first=Bt,J.last=function(n,t,e){var r=0,u=n?n.length:0;if("number"!=typeof t&&null!=t){var o=u;for(t=J.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[u-1]:v;return p(n,Ie(0,u-r))},J.sample=function(n,t,e){return n&&"number"!=typeof n.length&&(n=xt(n)),null==t||e?n?n[at(0,n.length-1)]:v:(n=Tt(n),n.length=Se(Ie(0,t),n.length),n)},J.take=Bt,J.head=Bt,h(J,function(n,t){var e="sample"!==t;J.prototype[t]||(J.prototype[t]=function(t,r){var u=this.__chain__,o=n(this.__wrapped__,t,r);return u||null!=t&&(!r||e&&"function"==typeof t)?new Q(o,u):o})}),J.VERSION="2.4.1",J.prototype.chain=function(){return this.__chain__=!0,this},J.prototype.toString=function(){return oe(this.__wrapped__)},J.prototype.value=Qt,J.prototype.valueOf=Qt,St(["join","pop","shift"],function(n){var t=ae[n];J.prototype[n]=function(){var n=this.__chain__,e=t.apply(this.__wrapped__,arguments);return n?new Q(e,n):e}}),St(["push","reverse","sort","unshift"],function(n){var t=ae[n];J.prototype[n]=function(){return t.apply(this.__wrapped__,arguments),this}}),St(["concat","slice","splice"],function(n){var t=ae[n];J.prototype[n]=function(){return new Q(t.apply(this.__wrapped__,arguments),this.__chain__)}}),J}var v,h=[],g=[],y=0,m=+new Date+"",b=75,_=40,d=" 	\f\n\r\u2028\u2029",w=/\b__p\+='';/g,j=/\b(__p\+=)''\+/g,k=/(__e\(.*?\)|\b__t\))\+'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,O=/^\s*function[ \n\r\t]+\w/,N=/<%=([\s\S]+?)%>/g,I=RegExp("^["+d+"]*0+(?=.$)"),S=/($^)/,E=/\bthis\b/,R=/['\n\r\t\u2028\u2029\\]/g,A="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),D="[object Arguments]",$="[object Array]",T="[object Boolean]",F="[object Date]",B="[object Function]",W="[object Number]",q="[object Object]",z="[object RegExp]",P="[object String]",K={};K[B]=!1,K[D]=K[$]=K[T]=K[F]=K[W]=K[q]=K[z]=K[P]=!0;var L={leading:!1,maxWait:0,trailing:!1},M={configurable:!1,enumerable:!1,value:null,writable:!1},V={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},U={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},G=V[typeof window]&&window||this,H=V[typeof exports]&&exports&&!exports.nodeType&&exports,J=V[typeof module]&&module&&!module.nodeType&&module,Q=J&&J.exports===H&&H,X=V[typeof global]&&global;!X||X.global!==X&&X.window!==X||(G=X);var Y=s();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(G._=Y,define(function(){return Y})):H&&J?Q?(J.exports=Y)._=Y:H._=Y:G._=Y}.call(this);for(var BASE_64_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BASE_64_VALS={},i=0;i<BASE_64_CHARS.length;i++)BASE_64_VALS[BASE_64_CHARS.charAt(i)]=i;Base64={},Base64.encode=function(a){if("string"==typeof a){var b=a;a=Base64.newBinary(b.length);for(var c=0;c<b.length;c++){var d=b.charCodeAt(c);if(d>255)throw new Error("Not ascii. Base64.encode can only take ascii strings.");a[c]=d}}for(var e=[],f=null,g=null,h=null,i=null,c=0;c<a.length;c++)switch(c%3){case 0:f=63&a[c]>>2,g=(3&a[c])<<4;break;case 1:g|=15&a[c]>>4,h=(15&a[c])<<2;break;case 2:h|=3&a[c]>>6,i=63&a[c],e.push(getChar(f)),e.push(getChar(g)),e.push(getChar(h)),e.push(getChar(i)),f=null,g=null,h=null,i=null}return null!=f&&(e.push(getChar(f)),e.push(getChar(g)),e.push(null==h?"=":getChar(h)),null==i&&e.push("=")),e.join("")};var getChar=function(a){return BASE_64_CHARS.charAt(a)},getVal=function(a){return"="===a?-1:BASE_64_VALS[a]};Base64.newBinary=function(a){if("undefined"==typeof Uint8Array||"undefined"==typeof ArrayBuffer){for(var b=[],c=0;a>c;c++)b.push(0);return b.$Uint8ArrayPolyfill=!0,b}return new Uint8Array(new ArrayBuffer(a))},Base64.decode=function(a){var b=Math.floor(3*a.length/4);"="==a.charAt(a.length-1)&&(b--,"="==a.charAt(a.length-2)&&b--);for(var c=Base64.newBinary(b),d=null,e=null,f=null,g=0,h=0;h<a.length;h++){var i=a.charAt(h),j=getVal(i);switch(h%4){case 0:if(0>j)throw new Error("invalid base64 string");d=j<<2;break;case 1:if(0>j)throw new Error("invalid base64 string");d|=j>>4,c[g++]=d,e=(15&j)<<4;break;case 2:j>=0&&(e|=j>>2,c[g++]=e,f=(3&j)<<6);break;case 3:j>=0&&(c[g++]=f|j)}}return c},EJSON={},EJSONTest={};var customTypes={};EJSON.addType=function(a,b){if(_.has(customTypes,a))throw new Error("Type "+a+" already present");customTypes[a]=b};var isInfOrNan=function(a){return _.isNaN(a)||1/0===a||a===-1/0},builtinConverters=[{matchJSONValue:function(a){return _.has(a,"$date")&&1===_.size(a)},matchObject:function(a){return a instanceof Date},toJSONValue:function(a){return{$date:a.getTime()}},fromJSONValue:function(a){return new Date(a.$date)}},{matchJSONValue:function(a){return _.has(a,"$InfNaN")&&1===_.size(a)},matchObject:isInfOrNan,toJSONValue:function(a){var b;return b=_.isNaN(a)?0:1/0===a?1:-1,{$InfNaN:b}},fromJSONValue:function(a){return a.$InfNaN/0}},{matchJSONValue:function(a){return _.has(a,"$binary")&&1===_.size(a)},matchObject:function(a){return"undefined"!=typeof Uint8Array&&a instanceof Uint8Array||a&&_.has(a,"$Uint8ArrayPolyfill")},toJSONValue:function(a){return{$binary:Base64.encode(a)}},fromJSONValue:function(a){return Base64.decode(a.$binary)}},{matchJSONValue:function(a){return _.has(a,"$escape")&&1===_.size(a)},matchObject:function(a){return _.isEmpty(a)||_.size(a)>2?!1:_.any(builtinConverters,function(b){return b.matchJSONValue(a)})},toJSONValue:function(a){var b={};return _.each(a,function(a,c){b[c]=EJSON.toJSONValue(a)}),{$escape:b}},fromJSONValue:function(a){var b={};return _.each(a.$escape,function(a,c){b[c]=EJSON.fromJSONValue(a)}),b}},{matchJSONValue:function(a){return _.has(a,"$type")&&_.has(a,"$value")&&2===_.size(a)},matchObject:function(a){return EJSON._isCustomType(a)},toJSONValue:function(a){var b=Meteor._noYieldsAllowed(function(){return a.toJSONValue()});return{$type:a.typeName(),$value:b}},fromJSONValue:function(a){var b=a.$type;if(!_.has(customTypes,b))throw new Error("Custom EJSON type "+b+" is not defined");var c=customTypes[b];return Meteor._noYieldsAllowed(function(){return c(a.$value)})}}];EJSON._isCustomType=function(a){return a&&"function"==typeof a.toJSONValue&&"function"==typeof a.typeName&&_.has(customTypes,a.typeName())};var adjustTypesToJSONValue=EJSON._adjustTypesToJSONValue=function(a){if(null===a)return null;var b=toJSONValueHelper(a);return void 0!==b?b:"object"!=typeof a?a:(_.each(a,function(b,c){if("object"==typeof b||void 0===b||isInfOrNan(b)){var d=toJSONValueHelper(b);return d?void(a[c]=d):void adjustTypesToJSONValue(b)}}),a)},toJSONValueHelper=function(a){for(var b=0;b<builtinConverters.length;b++){var c=builtinConverters[b];if(c.matchObject(a))return c.toJSONValue(a)}return void 0};EJSON.toJSONValue=function(a){var b=toJSONValueHelper(a);return void 0!==b?b:("object"==typeof a&&(a=EJSON.clone(a),adjustTypesToJSONValue(a)),a)};var adjustTypesFromJSONValue=EJSON._adjustTypesFromJSONValue=function(a){if(null===a)return null;var b=fromJSONValueHelper(a);return b!==a?b:"object"!=typeof a?a:(_.each(a,function(b,c){if("object"==typeof b){var d=fromJSONValueHelper(b);if(b!==d)return void(a[c]=d);adjustTypesFromJSONValue(b)}}),a)},fromJSONValueHelper=function(a){if("object"==typeof a&&null!==a&&_.size(a)<=2&&_.all(a,function(a,b){return"string"==typeof b&&"$"===b.substr(0,1)}))for(var b=0;b<builtinConverters.length;b++){var c=builtinConverters[b];if(c.matchJSONValue(a))return c.fromJSONValue(a)}return a};EJSON.fromJSONValue=function(a){var b=fromJSONValueHelper(a);return b===a&&"object"==typeof a?(a=EJSON.clone(a),adjustTypesFromJSONValue(a),a):b},EJSON.stringify=function(a,b){var c=EJSON.toJSONValue(a);return b&&(b.canonical||b.indent)?EJSON._canonicalStringify(c,b):JSON.stringify(c)},EJSON.parse=function(a){if("string"!=typeof a)throw new Error("EJSON.parse argument should be a string");return EJSON.fromJSONValue(JSON.parse(a))},EJSON.isBinary=function(a){return!!("undefined"!=typeof Uint8Array&&a instanceof Uint8Array||a&&a.$Uint8ArrayPolyfill)},EJSON.equals=function(a,b,c){var d,e=!(!c||!c.keyOrderSensitive);if(a===b)return!0;if(_.isNaN(a)&&_.isNaN(b))return!0;if(!a||!b)return!1;if("object"!=typeof a||"object"!=typeof b)return!1;if(a instanceof Date&&b instanceof Date)return a.valueOf()===b.valueOf();if(EJSON.isBinary(a)&&EJSON.isBinary(b)){if(a.length!==b.length)return!1;for(d=0;d<a.length;d++)if(a[d]!==b[d])return!1;return!0}if("function"==typeof a.equals)return a.equals(b,c);if("function"==typeof b.equals)return b.equals(a,c);if(a instanceof Array){if(!(b instanceof Array))return!1;if(a.length!==b.length)return!1;for(d=0;d<a.length;d++)if(!EJSON.equals(a[d],b[d],c))return!1;return!0}switch(EJSON._isCustomType(a)+EJSON._isCustomType(b)){case 1:return!1;case 2:return EJSON.equals(EJSON.toJSONValue(a),EJSON.toJSONValue(b))}var f;if(e){var g=[];return _.each(b,function(a,b){g.push(b)}),d=0,f=_.all(a,function(a,e){return d>=g.length?!1:e!==g[d]?!1:EJSON.equals(a,b[g[d]],c)?(d++,!0):!1}),f&&d===g.length}return d=0,f=_.all(a,function(a,e){return _.has(b,e)&&EJSON.equals(a,b[e],c)?(d++,!0):!1}),f&&_.size(b)===d},EJSON.clone=function(a){var b;if("object"!=typeof a)return a;if(null===a)return null;if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return a;if(EJSON.isBinary(a)){b=EJSON.newBinary(a.length);for(var c=0;c<a.length;c++)b[c]=a[c];return b}if(_.isArray(a)||_.isArguments(a)){for(b=[],c=0;c<a.length;c++)b[c]=EJSON.clone(a[c]);return b}return"function"==typeof a.clone?a.clone():EJSON._isCustomType(a)?EJSON.fromJSONValue(EJSON.clone(EJSON.toJSONValue(a)),!0):(b={},_.each(a,function(a,c){b[c]=EJSON.clone(a)}),b)},EJSON.newBinary=Base64.newBinary,!function(a){"use strict";if(a.URL=a.URL||a.webkitURL,a.Blob&&a.URL)try{return void new Blob}catch(b){}var c=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array,s=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL=function(a){var c,b=document.createElementNS("http://www.w3.org/1999/xhtml","a");return b.href=a,"origin"in b||("data:"===b.protocol.toLowerCase()?b.origin=null:(c=a.match(s),b.origin=c&&c[1])),b}),n.createObjectURL=function(a){var c,b=a.type;return null===b&&(b="application/octet-stream"),a instanceof d?(c="data:"+b,"base64"===a.encoding?c+";base64,"+a.data:"URI"===a.encoding?c+","+decodeURIComponent(a.data):o?c+";base64,"+o(a.data):c+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},f.close=function(){this.size=0,delete this.data},c}(a);a.Blob=function(a,b){var d=b?b.type||"":"",e=new c;if(a)for(var f=0,g=a.length;g>f;f++)e.append(a[f]);return e.getBlob(d)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),saveAs=void 0;try{saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var k=a.document,n=k.createElementNS("http://www.w3.org/1999/xhtml","a"),w="download"in n,x=function(c){var e=k.createEvent("MouseEvents");e.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(e)},q=a.webkitRequestFileSystem,u=a.requestFileSystem||q||a.mozRequestFileSystem,y=function(c){(a.setImmediate||a.setTimeout)(function(){throw c},0)},r=0,s=function(c){var e=function(){"string"==typeof c?(a.URL||a.webkitURL||a).revokeObjectURL(c):c.remove()};a.chrome?e():setTimeout(e,10)},t=function(c,a,d){a=[].concat(a);for(var b=a.length;b--;){var l=c["on"+a[b]];if("function"==typeof l)try{l.call(c,d||c)}catch(f){y(f)}}},m=function(c,e){var f,p,v,d=this,b=c.type,l=!1,k=function(){t(d,["writestart","progress","write","writeend"])},g=function(){(l||!f)&&(f=(a.URL||a.webkitURL||a).createObjectURL(c)),p?p.location.href=f:void 0==a.open(f,"_blank")&&"undefined"!=typeof safari&&(a.location.href=f),d.readyState=d.DONE,k(),s(f)},h=function(a){return function(){return d.readyState!==d.DONE?a.apply(this,arguments):void 0}},m={create:!0,exclusive:!1};d.readyState=d.INIT,e||(e="download"),w?(f=(a.URL||a.webkitURL||a).createObjectURL(c),n.href=f,n.download=e,x(n),d.readyState=d.DONE,k(),s(f)):(a.chrome&&b&&"application/octet-stream"!==b&&(v=c.slice||c.webkitSlice,c=v.call(c,0,c.size,"application/octet-stream"),l=!0),q&&"download"!==e&&(e+=".download"),("application/octet-stream"===b||q)&&(p=a),u?(r+=c.size,u(a.TEMPORARY,r,h(function(a){a.root.getDirectory("saved",m,h(function(a){var b=function(){a.getFile(e,m,h(function(a){a.createWriter(h(function(b){b.onwriteend=function(b){p.location.href=a.toURL(),d.readyState=d.DONE,t(d,"writeend",b),s(a)},b.onerror=function(){var a=b.error;a.code!==a.ABORT_ERR&&g()},["writestart","progress","write","abort"].forEach(function(a){b["on"+a]=d["on"+a]}),b.write(c),d.abort=function(){b.abort(),d.readyState=d.DONE},d.readyState=d.WRITING}),g)}),g)};a.getFile(e,{create:!1},h(function(a){a.remove(),b()}),h(function(a){a.code===a.NOT_FOUND_ERR?b():g()}))}),g)}),g)):g())},b=m.prototype;return b.abort=function(){this.readyState=this.DONE,t(this,"abort")},b.readyState=b.INIT=0,b.WRITING=1,b.DONE=2,b.error=b.onwritestart=b.onprogress=b.onwrite=b.onabort=b.onerror=b.onwriteend=null,function(a,b){return new m(a,b)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content),"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs})}catch(e){}}).call(this);