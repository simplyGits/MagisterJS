/* Magister.js (browser version) by simplyApps. Built on: 26-03-2017 15:59 UTC */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,n,o,p,q,r,s,t=function(a,b){return function(){return a.apply(b,arguments)}},u=[].slice;if(s=null!=(d="undefined"!=typeof module&&null!==module?module.exports:void 0)?d:null!=this.Magister?this.Magister:this.Magister={},s.Appointment=function(){function b(a){this._magisterObj=a,this.id=s._getset("_id"),this.begin=s._getset("_begin"),this.end=s._getset("_end"),this.beginBySchoolHour=s._getset("_beginBySchoolHour"),this.endBySchoolHour=s._getset("_endBySchoolHour"),this.fullDay=s._getset("_fullDay"),this.description=s._getset("_description"),this.location=s._getset("_location"),this.status=s._getset("_status"),this.type=s._getset("_type"),this.typeString=s._getset("_type",null,function(a){switch(a){case 0:return"none";case 1:return"personal";case 2:return"general";case 3:return"schoolwide";case 4:return"internship";case 5:return"intake";case 6:return"scheduleFree";case 7:return"kwt";case 8:return"standby";case 9:return"block";case 10:return"miscellaneous";case 11:return"localBlock";case 12:return"classBlock";case 13:return"lesson";case 14:return"studiehuis";case 15:return"scheduleFreeStudy";case 16:return"planning";case 101:return"actions";case 102:return"presences";case 103:return"examSchedule";default:return"unknown"}}),this.displayType=s._getset("_displayType"),this.displayTypeString=s._getset("_displayType",null,function(a){switch(a){case 1:return"available";case 2:return"provisionallyScheduled";case 3:return"scheduled";case 4:return"absent";default:return"unknown"}}),this.content=s._getset("_content",null,s._helpers.cleanHtmlContent),this.infoType=s._getset("_infoType"),this.infoTypeString=s._getset("_infoType",null,function(a){switch(a){case 0:return"none";case 1:return"homework";case 2:return"test";case 3:return"exam";case 4:return"quiz";case 5:return"oral";case 6:return"information";case 7:return"annotation";default:return"unknown"}}),this.notes=s._getset("_notes"),this.isDone=s._getset("_isDone",function(a){return function(b){if(a._isDone!==b)return a._isDone=b,a._magisterObj.http.put(a.url(),a._toMagisterStyle(),{},function(){})}}(this)),this.classes=s._getset("_classes"),this.teachers=s._getset("_teachers"),this.classRooms=s._getset("_classRooms"),this.groups=s._getset("_groups"),this.appointmentId=s._getset("_appointmentId"),this.url=s._getset("_url"),this.scrapped=s._getset("_scrapped"),this.changed=s._getset("_changed"),this.absenceInfo=s._getset("_absenceInfo")}return b.prototype.attachments=function(a){return this._hasAttachments?void this._magisterObj.http.get(this._url,{},function(b){return function(c,d){var e,f;return null!=c?a(c,null):(e=JSON.parse(d.content).Bijlagen,f=b._teachers[0],a(null,e.map(function(a){return a._addedBy=f,s.File._convertRaw(b._magisterObj,void 0,a)})))}}(this)):void a(null,[])},b.prototype.remove=function(a){var b;if(1===(b=this._type)||16===b)return this._magisterObj.http.delete(this._url,{},function(b,c){return a(b)})},b.prototype._toMagisterStyle=function(){var a,b,c;return b={},b.Id=this._id,b.Start=s._helpers.toUtcString(this._begin),b.Einde=s._helpers.toUtcString(this._end),b.LesuurVan=this._beginBySchoolHour,b.LesuurTotMet=this._endBySchoolHour,b.DuurtHeleDag=this._fullDay,b.Omschrijving=this._description,b.Lokatie=this._location,b.Status=this._status,b.Type=this._type,b.WeergaveType=this._displayType,b.Inhoud=this._content,b.InfoType=this._infoType,b.Aantekening=this._notes,b.Afgerond=this._isDone,b.Lokalen=function(){var b,c,d,e;for(d=this._classRooms,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push({Naam:a});return e}.call(this),b.Docenten=function(){var a,b,d,e;for(d=this._teachers,e=[],a=0,b=d.length;a<b;a++)c=d[a],e.push(c._toMagisterStyle());return e}.call(this),b.Vakken=function(){var b,c,d,e;for(d=this._classes,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push({Naam:a});return e}.call(this),b.Groepen=this._groups,b.OpdrachtId=this._appointmentId,b.Bijlagen=[],b},b._convertRaw=function(a,b){var c,d,e,f,g,h,i;return d=new s.Appointment(a),d._id=b.Id,d._begin=s._helpers.parseDate(b.Start),d._end=s._helpers.parseDate(b.Einde),d._beginBySchoolHour=b.LesuurVan,d._endBySchoolHour=b.LesuurTotMet,d._fullDay=b.DuurtHeleDag,d._description=null!=(f=b.Omschrijving)?f:"",d._location=null!=(g=b.Lokatie)?g:"",d._status=b.Status,d._type=b.Type,d._displayType=b.WeergaveType,d._content=b.Inhoud,d._infoType=b.InfoType,d._notes=b.Aantekening,d._isDone=b.Afgerond,d._classes=null!=b.Vakken?function(){var a,d,e,f;for(e=b.Vakken,f=[],a=0,d=e.length;a<d;a++)c=e[a],f.push(c.Naam);return f}():[],d._teachers=null!=b.Docenten?function(){var c,d,f,g;for(f=b.Docenten,g=[],c=0,d=f.length;c<d;c++)e=f[c],g.push(s.Person._convertRaw(a,e));return g}():[],d._classRooms=null!=b.Lokalen?function(){var a,d,e,f;for(e=b.Lokalen,f=[],a=0,d=e.length;a<d;a++)c=e[a],f.push(c.Naam);return f}():[],d._groups=b.Groepen,d._appointmentId=b.OpdrachtId,d._hasAttachments=b.HeeftBijlagen,d._url=a._personUrl+"/afspraken/"+d._id,d._scrapped=4===(h=b.Status)||5===h,d._changed=3===(i=b.Status)||9===i||10===i,d},b._convertStored=function(b,c){var d;return d=a.extend(c,new s.Appointment(b)),d._magisterObj=b,d._begin=s._helpers.parseDate(c._begin),d._end=s._helpers.parseDate(c._end),d},b}(),s.AbsenceInfo=function(){function a(a){this._magisterObj=a,this.id=s._getset("_id"),this.begin=s._getset("_begin"),this.end=s._getset("_end"),this.schoolHour=s._getset("_schoolHour"),this.permitted=s._getset("_permitted"),this.description=s._getset("_description"),this.type=s._getset("_type"),this.typeString=s._getset("_type",null,function(a){switch(a){case 1:return"absent";case 2:return"late";case 3:return"sick";case 4:return"discharged";case 6:return"exemption";case 7:return"books";case 8:return"homework";default:return"unknown"}}),this.code=s._getset("_code"),this.appointment=s._getset("_appointment")}return a._convertRaw=function(a,b){var c,d,e,f;return c=new s.AbsenceInfo(a),c._id=b.Id,c._begin=s._helpers.parseDate(b.Start),c._end=s._helpers.parseDate(b.Eind),c._schoolHour=b.Lesuur,c._permitted=b.Geoorloofd,c._description=null!=(d=null!=(e=b.Omschrijving)?e.trim():void 0)?d:"",c._type=b.Verantwoordingtype,c._code=null!=(f=b.Code)?f:"",c._appointment=s.Appointment._convertRaw(a,b.Afspraak),c},a}(),s=null!=(e="undefined"!=typeof module&&null!==module?module.exports:void 0)?e:null!=this.Magister?this.Magister:this.Magister={},s.Assignment=function(){function a(a){this._magisterObj=a,this.id=s._getset("_id"),this.name=s._getset("_name"),this.description=s._getset("_description"),this.class=s._getset("_class"),this.deadline=s._getset("_deadline"),this.handedInOn=s._getset("_handedInOn"),this.files=s._getset("_files"),this.teachers=s._getset("_teachers"),this.grade=s._getset("_grade"),this.markedOn=s._getset("_markedOn"),this.handInAgain=s._getset("_handInAgain"),this.finished=s._getset("_finished"),this.canHandIn=s._getset("_canHandIn")}return a.prototype.versions=function(a){var b,c,d,e,f,g;for(e=s._helpers.asyncResultWaiter(this._versionIds.length,function(b){return a(null,b)}),f=this._versionIds,g=[],c=0,d=f.length;c<d;c++)b=f[c],g.push(this._magisterObj.http.get(this._magisterObj._personUrl+"/opdrachten/versie/"+b,{},function(b){return function(c,d){return null!=c?a(c,null):e(s.AssignmentVersion._convertRaw(b._magisterObj,b,JSON.parse(d.content)))}}(this)));return g},a._convertRaw=function(a,b){var c,d,e,f;return d=new s.Assignment(a),d._id=b.Id,d._name=b.Titel,d._description=b.Omschrijving,d._class=b.Vak,d._deadline=s._helpers.parseDate(b.InleverenVoor),d._handedInOn=s._helpers.parseDate(b.IngeleverdOp),d._files=function(){var d,e,f,g;for(f=b.Bijlagen,g=[],d=0,e=f.length;d<e;d++)c=f[d],g.push(s.File._convertRaw(a,void 0,c));return g}(),d._teachers=null!=b.Docenten?function(){var c,d,f,g;for(f=b.Docenten,g=[],c=0,d=f.length;c<d;c++)e=f[c],g.push(s.Person._convertRaw(a,e));return g}():void 0,d._versionIds=function(){var a,c,d,e;for(d=b.VersieNavigatieItems,e=[],a=0,c=d.length;a<c;a++)f=d[a],e.push(f.Id);return e}(),d._grade=b.Beoordeling,d._markedOn=s._helpers.parseDate(b.BeoordeeldOp),d._handInAgain=b.OpnieuwInleveren,d._finished=b.Afgesloten,d._canHandIn=b.MagInleveren,d},a}(),s.AssignmentVersion=function(){function a(a){this._magisterObj=a,this.id=s._getset("_id"),this.class=s._getset("_class"),this.state=s._getset("_state"),this.pupilMessage=s._getset("_pupilMessage"),this.teacherNotice=s._getset("_teacherNotice"),this.handedInFiles=s._getset("_handedInFiles"),this.feedbackFiles=s._getset("_feedbackFiles"),this.deadline=s._getset("_deadline"),this.handedInOn=s._getset("_handedInOn"),this.grade=s._getset("_grade"),this.markedOn=s._getset("_markedOn"),this.version=s._getset("_version"),this.tooLate=s._getset("_tooLate")}return a._convertRaw=function(a,b,c){var d,e;return e=new s.AssignmentVersion(a),e._id=c.Id,e._class=b._class,e._state=c.Status,e._pupilMessage=c.LeerlingOpmerking,e._teacherNotice=c.DocentOpmerking,e._handedInFiles=function(){var b,e,f,g;for(f=c.LeerlingBijlagen,g=[],b=0,e=f.length;b<e;b++)d=f[b],g.push(s.File._convertRaw(a,void 0,d));return g}(),e._feedbackFiles=function(){var b,e,f,g;for(f=c.FeedbackBijlagen,g=[],b=0,e=f.length;b<e;b++)d=f[b],g.push(s.File._convertRaw(a,void 0,d));return g}(),e._deadline=s._helpers.parseDate(c.InleverenVoor),e._handedInOn=s._helpers.parseDate(c.IngeleverdOp),e._grade=c.Beoordeling,e._markedOn=s._helpers.parseDate(c.BeoordeeldOp),e._version=c.VersieNummer,e._tooLate=c.IsTeLaat,e},a}(),s=null!=(j="undefined"!=typeof module&&null!==module?module.exports:void 0)?j:null!=this.Magister?this.Magister:this.Magister={},s.Class=function(){function a(a){this._magisterObj=a,this.id=s._getset("_id"),this.beginDate=s._getset("_beginDate"),this.endDate=s._getset("_endDate"),this.abbreviation=s._getset("_abbreviation"),this.description=s._getset("_description"),this.number=s._getset("_number"),this.teacher=s._getset("_teacher"),this.classExemption=s._getset("_classExemption")}return a._convertRaw=function(a,b){var c,d,e,f,g;return c=new s.Class(a),c._id=null!=(d=b.id)?d:b.Id,c._beginDate=s._helpers.parseDate(b.begindatum),c._endDate=s._helpers.parseDate(b.einddatum),c._abbreviation=null!=(e=b.afkorting)?e:b.Afkorting,c._description=null!=(f=b.omschrijving)?f:b.Omschrijving,c._number=null!=(g=b.volgnr)?g:b.Volgnr,c._teacher=s.Person._convertRaw(a,{Docentcode:b.docent}),c._classExemption=b.VakDispensatie||b.VakVrijstelling,c},a}(),s.Course=function(){function b(a){this._magisterObj=a,this.getOtherTutors=t(this.getOtherTutors,this),this.id=s._getset("_id"),this.begin=s._getset("_begin"),this.end=s._getset("_end"),this.schoolPeriod=s._getset("_schoolPeriod"),this.type=s._getset("_type"),this.group=s._getset("_group"),this.profile=s._getset("_profile"),this.alternativeProfile=s._getset("_alternativeProfile"),this.current=s._getset("_current")}return b.prototype.classes=function(a){return this._magisterObj.http.get(this._classesUrl,{},function(b){return function(c,d){var e;return null!=c?a(c,null):a(null,function(){var a,b,c,f;for(c=JSON.parse(d.content),f=[],a=0,b=c.length;a<b;a++)e=c[a],f.push(s.Class._convertRaw(this._magisterObj,e));return f}.call(b))}}(this))},b.prototype.gradePeriods=function(a){return this._magisterObj.http.get(this._periodsUrl,{},function(b){return function(c,d){var e;return null!=c?a(c,null):a(null,function(){var a,b,c,f;for(c=JSON.parse(d.content).Items,f=[],a=0,b=c.length;a<b;a++)e=c[a],f.push(s.GradePeriod._convertRaw(this._magisterObj,e));return f}.call(b))}}(this))},b.prototype.grades=function(){var b,c,d,e,f,g;if(f=null!=(g=a.find(arguments,function(b){return a.isPlainObject(b)}))?g:{},d=f.fillPersons,c=f.fillGrade,b=a.find(arguments,function(b){return a.isFunction(b)}),null==b)throw new Error("Callback can't be null");return b=a.once(b),null==d&&(d=!1),null==c&&(c=!0),e=!1,this._magisterObj.http.get(e?this._gradesUrlPrefix:this._gradesUrl,{},function(f){return function(g,h){var i,j,k,l,m;if(null!=g)return b(g,null);for(h=JSON.parse(h.content).Items,h=a.filter(h,function(a){return 0!==a.CijferId}),k=s._helpers.asyncResultWaiter(h.length,function(c){return a.chain(c).uniq(function(a){return a.class().id}).pluck("_class").forEach(function(b){var d,e,f,g,h;for(g=a.filter(c,function(a){return a.class().id===b.id}),h=[],e=0,f=g.length;e<f;e++)d=g[e],h.push(d._class=b);return h}),b(null,a.sortBy(c,function(a){return a.dateFilledIn()}))}),m=[],i=0,j=h.length;i<j;i++)l=h[i],m.push(function(a){var g,h,i;return g=s.Grade._convertRaw(f._magisterObj,a),g._columnUrl=f._columnUrlPrefix+(null!=(i=a.CijferKolom)?i.Id:void 0),h=s._helpers.asyncResultWaiter(2,function(){return k(g)}),d&&!e?f._magisterObj.getPersons(g.Docent,3,function(a,b){return null==a&&null!=b[0]&&(g._teacher=b[0]),h()}):h(),c&&!e?g.fillGrade(function(a,c){return null!=a?b(a,null):h()}):h()}(l));return m}}(this))},b.prototype.getPersonalTutor=function(a){if(null==a)throw new Error("Callback can't be null");return this._magisterObj.http.get(this._magisterObj._personUrl+"/aanmeldingen/"+this._id+"/mentor",{},function(b){return function(c,d){return null!=c?a(c,null):a(null,s.Person._convertRaw(b._magisterObj,JSON.parse(d.content)))}}(this))},b.prototype.getOtherTutors=function(a){if(null==a)throw new Error("Callback can't be null");return this._magisterObj.http.get(this._magisterObj._personUrl+"/aanmeldingen/"+this._id+"/mentoren",{},function(b){return function(c,d){var e,f;return null!=c?a(c,null):(e=JSON.parse(d.content).items,a(null,function(){var a,b,c;for(c=[],a=0,b=e.length;a<b;a++)f=e[a],c.push(s.Person._convertRaw(this._magisterObj,f));return c}.call(b)))}}(this))},b._convertRaw=function(b,c){var d,e,f,g;return e=new s.Course(b),e._classesUrl=b._personUrl+("/aanmeldingen/"+c.Id+"/vakken"),e._gradesUrlPrefix=b._personUrl+("/aanmeldingen/"+c.Id+"/cijfers"),e._gradesUrl=e._gradesUrlPrefix+"/cijferoverzichtvooraanmelding?actievePerioden=false&alleenBerekendeKolommen=false&alleenPTAKolommen=false",e._periodsUrl=e._gradesUrlPrefix+"/cijferperiodenvooraanmelding",e._columnUrlPrefix=e._gradesUrlPrefix+"/extracijferkolominfo/",e._id=c.Id,e._begin=s._helpers.parseDate(c.Start),e._end=s._helpers.parseDate(c.Einde),e._schoolPeriod=c.Lesperiode,e._type={id:c.Studie.Id,description:c.Studie.Omschrijving},e._group={id:c.Groep.Id,description:(d=c.Groep.Omschrijving,null!=d?null!=(f=a.find(d.split(" "),function(a){return/\d/.test(a)}))?f:d:void 0),locationId:c.Groep.LocatieId},e._profile=c.Profiel,e._alternativeProfile=c.Profiel2,e._current=e._begin.getTime()<=(g=a.now())&&g<=e._end.getTime(),e},b}(),s=null!=(k="undefined"!=typeof module&&null!==module?module.exports:void 0)?k:null!=this.Magister?this.Magister:this.Magister={},s.DigitalSchoolUtility=function(){function b(a){this._magisterObj=a,this.id=s._getset("_id"),this.type=s._getset("_type"),this.name=s._getset("_name"),this.publisher=s._getset("_publisher"),this.state=s._getset("_state"),this.begin=s._getset("_begin"),this.end=s._getset("_end"),this.EAN=s._getset("_EAN"),this.url=s._getset("_url"),this.class=s._getset("_class")}return b._convertRaw=function(b,c){var d,e;return d=new s.DigitalSchoolUtility(b),d._id=c.Id,d._type=c.MateriaalType,d._name=c.Titel,d._publisher=c.Uitgeverij,d._state=c.Status,d._begin=s._helpers.parseDate(c.Start),d._end=s._helpers.parseDate(c.Eind),d._EAN=Number(c.EAN),d._url=null!=(e=a.find(c.Links,function(a){return"content"===a.Rel}))?e.Href:void 0,d._class=s.Class._convertRaw(b,c.Vak),d},b}(),s=null!=(l="undefined"!=typeof module&&null!==module?module.exports:void 0)?l:null!=this.Magister?this.Magister:this.Magister={},s.FileFolder=function(){function a(a){this._magisterObj=a,this.id=s._getset("_id"),this.name=s._getset("_name"),this.rights=s._getset("_rights"),this.parentId=s._getset("_parentId")}return a.prototype.files=function(a){return this._magisterObj.http.get(this._magisterObj._personUrl+"/bronnen?parentId="+this.id(),{},function(b){return function(c,d){var e,f,g,h,i,j;if(null!=c)return a(c,null);for(f=function(){var a,b,c,f;for(c=JSON.parse(d.content).Items,f=[],a=0,b=c.length;a<b;a++)e=c[a],f.push(s.File._convertRaw(this._magisterObj,this,e));return f}.call(b),i=s._helpers.asyncResultWaiter(f.length,function(b){return a(null,f)}),j=[],g=0,h=f.length;g<h;g++)e=f[g],j.push(function(a){return b._magisterObj.getPersons(a.GeplaatstDoor,function(b,c){return null==b&&0!==c.length&&(a._addedBy=c[0]),i()})}(e));return j}}(this))},a._convertRaw=function(a,b){var c;return c=new s.FileFolder(a),c._id=b.Id,c._name=b.Naam,c._rights=b.Privilege,c._parentId=b.ParentId,c},a}(),s.File=function(){function b(a){this._magisterObj=a,this.id=s._getset("_id"),this.type=s._getset("_type"),this.name=s._getset("_name",function(a){return function(b){return a._name=b,a._update()}}(this)),this.uri=s._getset("_uri"),this.size=s._getset("_size"),this.rights=s._getset("_rights"),this.mime=s._getset("_mime"),this.changedDate=s._getset("_changedDate"),this.creationDate=s._getset("_creationDate"),this.addedBy=s._getset("_addedBy"),this.fileBlobId=s._getset("_fileBlobId"),this.fileFolder=s._getset("_fileFolder",this.move),this.uniqueId=s._getset("_uniqueId"),this.referenceId=s._getset("_referenceId")}return b.prototype.download=function(){var b,c,d,e,f,g;if(c=null==(e=a.find(arguments,function(b){return a.isString(b)||a.isBoolean(b)}))||e,b=a.find(arguments,function(b){return a.isFunction(b)}),"undefined"!=typeof Meteor&&null!==Meteor?Meteor.isServer:void 0)g=Npm.require("request"),d=Npm.require("fs");else{if(null==("undefined"!=typeof module&&null!==module?module.exports:void 0))return void("function"==typeof b&&b(new Error("`File.download` is only accessible from the server at the moment.\nYou can set a proxy yourself with something like iron:router serverside routes."),null));g=require("request"),d=require("fs")}c=a.isBoolean(c)&&c?this.name():a.isString(c)?/(\.{1,2}\/?)*$/.test(c)?c+="/"+this.name():c:void 0,f=g({url:this._downloadUrl,method:"GET",headers:this._magisterObj.http._cookieInserter(),encoding:null}).on("error",function(a){return"function"==typeof b?b(a,null):void 0}).on("response",function(a){return"function"==typeof b?b(null,""):void 0}),null!=c&&f.pipe(require("fs").createWriteStream(c))},b.prototype.move=function(b){return this._magisterObj.fileFolders(function(c){return function(d,e){if(null!=d)throw d;return a.isObject(b)||(b=a.find(e,function(a){return s._helpers.contains(a.name(),b,!0)||a.id()===b})),c._fileFolder=b,c._update()}}(this))},b.prototype.remove=function(){return this._magisterObj.http.delete(this._magisterObj._personUrl+"/bronnen/"+this.id(),{},function(a,b){if(null!=a)throw a})},b.prototype._update=function(){return this._magisterObj.http.put(this._magisterObj._personUrl+"/bronnen/"+this.id(),this._toMagisterStyle(),{},function(){})},b.prototype._toMagisterStyle=function(){var a;return a={},a.Id=parseInt(this._id,10),a.BronSoort=this._type,a.Naam=this._name,a.Uri=this._uri,a.Grootte=this._size,a.Privilege=this._rights,a.ContentType=this._mime,a.FileBlobId=null!=this._fileBlobId?parseInt(this._fileBlobId,10):void 0,a.ParentId=this._fileFolder.id(),a.UniqueId=this._uniqueId,a.Referentie=null!=this._referenceId?parseInt(this._referenceId,10):void 0,a},b._convertRaw=function(b,c,d){var e,f,g,h,i,j;return null!=d._addedBy?e=d._addedBy:(e=new s.Person(b,null,"",""),e._fullName=d.GeplaatstDoor),g=new s.File(b),g._id=d.Id.toString(),g._type=d.BronSoort,g._name=d.Naam,g._uri=d.Uri,g._size=d.Grootte,g._rights=d.Privilege,g._mime=d.ContentType||"application/octet-stream",g._changedDate=s._helpers.parseDate(d.GewijzigdOp),g._creationDate=s._helpers.parseDate(null!=(h=d.GemaaktOp)?h:d.Datum),g._addedBy=e,g._fileBlobId=null!=(i=d.FileBlobId)?i.toString():void 0,g._fileFolder=c,g._uniqueId=d.UniqueId,g._referenceId=null!=(j=d.Referentie)?j.toString():void 0,f=a.find(d.Links,{Rel:"Contents"}),null==f&&(f=a.find(d.Links,{Rel:"Self"})),/^https?/.test(f.Href)?g._downloadUrl=f.Href:g._downloadUrl=b.magisterSchool.url+f.Href,g},b}(),s=null!=(n="undefined"!=typeof module&&null!==module?module.exports:void 0)?n:null!=this.Magister?this.Magister:this.Magister={},s.Grade=function(){function b(a){this._magisterObj=a,this.id=s._getset("_id"),this.grade=s._getset("_grade"),this.passed=s._getset("_passed"),this.dateFilledIn=s._getset("_dateFilledIn"),this.testDate=s._getset("_testDate"),this.period=s._getset("_period"),this.class=s._getset("_class"),this.atLaterDate=s._getset("_atLaterDate"),this.exemption=s._getset("_exemption"),this.counts=s._getset("_counts"),this.type=s._getset("_type"),this.teacher=s._getset("_teacher"),this.classExemption=s._getset("_classExemption"),this.description=s._getset("_description"),this.weight=s._getset("_weight")}return b.prototype.fillGrade=function(b){return this._filled?b(null,this):this._magisterObj.http.get(this._columnUrl,{},function(c){return function(d,e){var f,g;return null!=d?b(d,null):(e=JSON.parse(e.content),c._testDate=s._helpers.parseDate(e.WerkinformatieDatumIngevoerd),c._description=null!=(f=e.WerkInformatieOmschrijving)?f:"",c._weight=Number(e.Weging),a.isNaN(c._weight)&&(c._weight=0),c._type._level=e.KolomNiveau,c._type._description=null!=(g=e.KolomOmschrijving)?g:"",c._filled=!0,b(null,c))}}(this))},b._convertRaw=function(a,b){var c,d,e,f,g,h;return c=new s.Grade(a),c._id=b.CijferId,c._grade=b.CijferStr,c._passed=b.IsVoldoende,c._dateFilledIn=s._helpers.parseDate(b.DatumIngevoerd),c._period=(d=new s.GradePeriod(a),d._id=b.CijferPeriode.Id,d._name=null!=(e=b.CijferPeriode.Naam)?e:"",d),c._class={id:b.Vak.Id,abbreviation:null!=(f=b.Vak.Afkorting)?f:"",description:null!=(g=b.Vak.Omschrijving)?g:""},c._atLaterDate=b.Inhalen,c._exemption=b.Vrijstelling,c._counts=b.TeltMee,null!=(h=b.CijferKolom)&&(c._type=s.GradeType._convertRaw(a,h)),c._assignmentId=b.CijferKolomIdEloOpdracht,c._teacher=s.Person._convertRaw(a,{Docentcode:b.Docent}),c._teacher._type=3,c._classExemption=b.VakDispensatie||b.VakVrijstelling,c._description="",c._weight=0,c},b}(),s.GradeType=function(){function a(a){this._magisterObj=a,this.id=s._getset("_id"),this.name=s._getset("_name"),this.number=s._getset("_number"),this.header=s._getset("_header"),this.description=s._getset("_description"),this.type=s._getset("_type"),this.typeString=s._getset("_type",null,function(a){switch(a){case 1:return"grade";case 2:return"average";case 3:return"maximum";case 4:return"formula";case 5:return"minimum";case 6:return"sum";case 7:return"count";case 8:return"cevo";case 9:return"text";case 10:return"cevocpe";case 11:return"cevocie";case 12:return"weight";case 13:return"end";case 14:return"deficit";default:return"unknown"}}),this.isAtLaterDate=s._getset("_isAtLaterDate"),this.isTeacher=s._getset("_isTeacher"),this.hasNestedTypes=s._getset("_hasNestedTypes"),this.isPTA=s._getset("_isPTA"),this.level=s._getset("_level"),this.isEnd=function(){var a;return 2===(a=this.type())||13===a}}return a._convertRaw=function(a,b){var c;return c=new s.GradeType(a),c._id=b.Id,c._name=b.KolomNaam,c._number=b.KolomNummer,c._header=b.KolomKop,c._type=b.KolomSoort,c._isAtLaterDate=b.IsHerkansingKolom,c._isTeacher=b.IsDocentKolom,c._hasNestedTypes=b.HeeftOndeliggendeKolommen,c._isPTA=b.IsPTAKolom,c._level=null,c._description="",c},a}(),s.GradePeriod=function(){function a(a){this._magisterObj=a,this.id=s._getset("_id"),this.begin=s._getset("_begin"),this.end=s._getset("_end"),this.name=s._getset("_name"),this.description=s._getset("_description")}return a._convertRaw=function(a,b){var c,d,e;return c=new s.GradePeriod(a),c._id=b.Id,c._begin=s._helpers.parseDate(b.Start),c._end=s._helpers.parseDate(b.Einde),c._name=null!=(d=b.Naam)?d:"",c._description=null!=(e=b.Omschrijving)?e:"",c},a}(),s=null!=(o="undefined"!=typeof module&&null!==module?module.exports:void 0)?o:null!=this.Magister?this.Magister:this.Magister={},"undefined"!=typeof Meteor&&null!==Meteor)this._=a=lodash;else if(null==("undefined"!=typeof module&&null!==module?module.exports:void 0)||"undefined"==typeof require||null===require||"undefined"!=typeof window&&null!==window){if(null==this._)throw new Error("Lo-dash or underscore is required.");a=this._}else null==a&&(this._=a=require("lodash"));s.VERSION="1.24.0",s.Magister=function(){function b(){var b,c,d,e,f;if(c={keepLoggedIn:!0,login:!0},1===arguments.length&&a.isObject(arguments[0]))c=a.extend(c,arguments[0]);else{if(3!==arguments.length&&4!==arguments.length)throw new Error("Expected 3 or 4 arguments, got "+arguments.length);e=arguments[0],f=arguments[1],d=arguments[2],b=arguments[3],c=a.extend(c,{school:e,username:f,password:d,keepLoggedIn:b})}if(null==c.school||null==c.sessionId&&(a.isEmpty(c.username)||a.isEmpty(c.password)))throw new Error("school, username and password are required.");if(this._readyCallbacks=[],this.http=new s.MagisterHttp,this.magisterSchool=c.school,this.username=c.username,this.password=c.password,this._keepLoggedIn=c.keepLoggedIn,a.isString(this.magisterSchool))s.MagisterSchool.getSchools(this.magisterSchool,function(a){return function(b,d){return null!=b?a._setErrored(b):0===d.length?a._setErrored(new Error("No school with the query "+a.magisterSchool+" found.")):(a.magisterSchool=d[0],c.login?a._reLogin(c.sessionId):void 0)}}(this));else{if(this.magisterSchool=a.extend(new s.MagisterSchool,this.magisterSchool),null==this.magisterSchool.url||0!==this.magisterSchool.url.search(/https?:\/\//))throw new Error("Invalid url given: '"+this.magisterSchool.url+"'");c.login&&this._reLogin(c.sessionId)}}return b.prototype.appointments=function(){var b,c,d,e,f,g,h,i,j,k;return b=a.find(arguments,function(b){return a.isFunction(b)}),h=a.filter(arguments,function(b){return a.isBoolean(b)}),e=h[0],g=h[1],null==e&&(e=!1),null==g&&(g=!0),d=a.filter(arguments,a.isDate),i=a.sortBy(d),f=i[0],j=i[1],null==j&&(j=f),f=s._helpers.date(f),j=s._helpers.date(j),this._forceReady(),c=s._helpers.urlDateConvert,k=this._personUrl+"/afspraken?tot="+c(j)+"&van="+c(f),this.http.get(k,{},function(d){return function(h,i){var k,l,m,n,o,p,q,r;if(null!=h)return b(h,null);if(i=JSON.parse(i.content),m=function(){var a,b,c,d;for(c=i.Items,d=[],a=0,b=c.length;a<b;a++)k=c[a],d.push(s.Appointment._convertRaw(this,k));return d}.call(d),l=null,n=s._helpers.asyncResultWaiter(2,function(c){return a.each(m,function(b){return b._absenceInfo=a.find(l,function(a){return a.appointment().id()===b.id()})}),m=a.chain(m).sortBy("_begin").value(),b(null,m)}),d.http.get(d._personUrl+"/absenties?tot="+c(j)+"&van="+c(f),{},function(a,c){return null!=a?g?n():b(a,null):(c=JSON.parse(c.content).Items,l=c.map(function(a){return s.AbsenceInfo._convertRaw(d,a)}),n())}),e){for(q=s._helpers.asyncResultWaiter(m.length,function(){return n()}),r=[],o=0,p=m.length;o<p;o++)k=m[o],r.push(function(a){var b;return b=a.teachers(),d.fillPersons(b,function(b,c){return a._teachers=c,q()},3)}(k));return r}return n()}}(this))},b.prototype.createAppointment=function(b,c){var d,e,f,g,h,i,j,k,l,m,n;for(this._forceReady(),m=["name","start","end"],e=0,g=m.length;e<g;e++)if(f=m[e],null==b[f])return void c(new Error("Not all required fields for `options` are given, required are: [ "+m.join(", ")+" ]"),null);return n=b.fullDay?s._helpers.date(b.start):b.start,h={Start:s._helpers.toUtcString(n),Einde:s._helpers.toUtcString(b.fullDay?new Date(n.getTime()+864e5):b.end),Omschrijving:b.name,Lokatie:null!=(j=b.location)?j:"",Inhoud:(d=null!=(k=b.content)?k.trim():void 0,null!=d&&d.length>0?a.escape(b.content):null),Type:null!=(l=b.type)?l:1,DuurtHeleDag:null!=(i=b.fullDay)&&i,InfoType:0,WeergaveType:1,Status:2,HeeftBijlagen:!1,Bijlagen:null,LesuurVan:null,LesuurTotMet:null,Aantekening:null,Afgerond:!1,Vakken:null,Docenten:null,Links:null,Id:0,Lokalen:null,Groepen:null,OpdrachtId:0},this.http.post(this._personUrl+"/afspraken",h,{},function(a){return function(a,b){return c(a,null)}}(this))},b.prototype.messageFolders=function(b,c){var d;return this._forceReady(),null!=c?void this._fetchMessageFolders(function(a){return function(d,e){return null!=d?c(d,null):c(null,a.messageFolders(b))}}(this)):(b=null!=b?b.trim():void 0,d=a.isString(b)?a.filter(this._messageFolders,function(a){return s._helpers.contains(a.name(),b,!0)}):this._messageFolders,null!=d?d:[])},b.prototype._fetchMessageFolders=function(a){return this.http.get(this._personUrl+"/berichten/mappen",{},function(b){return function(c,d){var e;return null!=c?(c.statusCode=null!=d?d.statusCode:void 0,a(c)):(b._messageFolders=function(){var a,b,c,f;for(c=JSON.parse(d.content).Items,f=[],a=0,b=c.length;a<b;a++)e=c[a],f.push(s.MessageFolder._convertRaw(this,e));return f}.call(b),a(null))}}(this))},b.prototype.inbox=function(){return this.messageFolders("postvak in")[0]},b.prototype.sentItems=function(){return this.messageFolders("verzonden items")[0]},b.prototype.bin=function(){return this.messageFolders("verwijderde items")[0]},b.prototype.alerts=function(){return this.messageFolders("mededelingen")[0]},b.prototype.courses=function(b){var c;return this._forceReady(),c=this._personUrl+"/aanmeldingen",this.http.get(c,{},function(c){return function(d,e){var f,g;return null!=d?b(d,null):(e=JSON.parse(e.content),g=function(){var a,b,c,d;for(c=e.Items,d=[],a=0,b=c.length;a<b;a++)f=c[a],d.push(s.Course._convertRaw(this,f));return d}.call(c),b(null,a.chain(g).sortBy("_beginDate").sortBy(function(a){return!a._current}).value()))}}(this))},b.prototype.currentCourse=function(b){return this._forceReady(),this.courses(function(c,d){return null!=c?b(c,null):b(null,a.find(d,function(a){return a.current()}))})},b.prototype.getLimitedCurrentCourseInfo=function(b){var c;return this._forceReady(),c=this._personUrl+"/opleidinggegevensprofiel",this.http.get(c,{},function(c,d){var e,f,g,h,i,j;if(null!=c)return b(c,null);try{return g=JSON.parse(d.content),b(null,{group:(f=g.Klas,null!=f?null!=(h=a.find(f.split(" "),function(a){return/\d/.test(a)}))?h:f:void 0),profile:g.Profielen,pupilId:g.StamNr,type:{year:+(null!=(i=/\d+/.exec(g.Studie))?i[0]:void 0),schoolVariant:null!=(j=/[^\d\s]+/.exec(g.Studie))?j[0]:void 0}})}catch(a){return e=a,b(e,null)}})},b._cachedPersons={},b.prototype.getPersons=function(){var b,c,d,e,f,g,h,i,j;return this._forceReady(),g=a.filter(arguments,function(b){return a.isString(b)}),e=g[0],h=g[1],d=a.find(arguments,function(b){return a.isFunction(b)}),e=null!=e?e.trim():"",e.length<3?(d(null,[]),!1):null==h?(b=c=!1,b=this.getPersons(e,"teacher",function(a){return function(b,f){var g;return null!=b?d(b,null):(g=f,c=a.getPersons(e,"pupil",function(a,b){return null!=a?d(a,null):d(null,b.concat(g))}))}}(this)),b||c):(f=function(){switch(h){case"teacher":return"Personeel";case"pupil":return"Leerling";case"project":return"Project";default:return"Overig"}}(),i=this._personUrl+"/contactpersonen?contactPersoonType="+f+"&q="+e.replace(/\ +/g,"+"),null!=(j=s.Magister._cachedPersons[""+this._id+h+e])?(s._helpers.defer(d,null,j),!0):(this.http.get(i,{},function(a){return function(b,c){var f;return null!=b?d(b,null):(c=function(){var a,b,d,e;for(d=JSON.parse(c.content).Items,e=[],a=0,b=d.length;a<b;a++)f=d[a],e.push(s.Person._convertRaw(this,f));return e}.call(a),s.Magister._cachedPersons[""+a._id+h+e]=c,d(null,c))}}(this)),!1))},b.prototype.fillPersons=function(b,c,d){var e,f,g,h,i,j;if(this._forceReady(),a.isArray(b)){if(0===b.length)return void c(null,[]);for(h=s._helpers.asyncResultWaiter(b.length,function(a){return c(null,a)}),e=0,f=b.length;e<f;e++){g=b[e];try{this.getPersons(a.last(g.fullName().split(" ")),null!=(i=g._type)?i:d,function(a,b){var c;return h(null!=(c=b[0])?c:g)})}catch(a){h(g)}}}else{if(!a.isObject(b))throw new Error("Expected persons to be an Array or an Object, got a(n) "+typeof b);try{this.getPersons(a.last(b.fullName().split(" ")),null!=(j=b._type)?j:d,function(a,d){var e;return c(null,null!=(e=d[0])?e:b)})}catch(a){c(null,b)}}},b.prototype.composeAndSendMessage=function(){var b,c,d,e,f,g;return this._forceReady(),f=a.filter(arguments,a.isString),g=f[0],b=f[1],c=a.find(arguments,a.isFunction),e=a.last(a.filter(arguments,function(a){return a!==c})),d=new s.Message(this),d.subject(g),d.body(null!=b?b:""),d.addRecipient(e),
d.send(c)},b.prototype.fileFolders=function(a){return this._forceReady(),this.http.get(this._personUrl+"/bronnen?soort=0",{},function(b){return function(c,d){var e;return null!=c?a(c,null):a(null,function(){var a,b,c,f;for(c=JSON.parse(d.content).Items,f=[],a=0,b=c.length;a<b;a++)e=c[a],f.push(s.FileFolder._convertRaw(this,e));return f}.call(b))}}(this))},b.prototype.studyGuides=function(b){var c,d,e;return this._forceReady(),d=null==(e=a.find(arguments,function(b){return a.isBoolean(b)}))||e,b=a.find(arguments,function(b){return a.isFunction(b)}),c=function(c){return function(d){return c.http.get(c._pupilUrl+"/studiewijzers?peildatum="+s._helpers.urlDateConvert(new Date),{},function(e,f){var g,h,i,j,k;if(null!=e)return b(e,null);for(f=function(){var a,b,c,d;for(c=JSON.parse(f.content).Items,d=[],a=0,b=c.length;a<b;a++)j=c[a],d.push(s.StudyGuide._convertRaw(this,j));return d}.call(c),g=function(b){return null!=d?b._class=a.find(d,function(a){return a.abbreviation()===b._class}):b._class=null},h=0,i=f.length;h<i;h++)k=f[h],g(k);return b(null,f)})}}(this),d?this.courses(function(a,b){return null!=b&&0!==b.length?b[0].classes(function(a,b){return null!=b&&0!==b.length?c(b):c()}):c()}):c()},b.prototype.assignments=function(){var b,c,d,e,f,g,h,i;if(this._forceReady(),g=a.filter(arguments,function(b){return a.isNumber(b)}),b=g[0],i=g[1],h=a.filter(arguments,function(b){return a.isBoolean(b)}),f=h[0],e=h[1],c=a.find(arguments,function(b){return a.isFunction(b)}),null!=c)return null==f&&(f=!1),null==e&&(e=!0),null==b&&(b=50),null==i&&(i=0),d=function(d){return function(e){return d.http.get(d._personUrl+"/opdrachten?skip="+i+"&top="+b+"&status=alle",{},function(b,g){var h,i,j,k,l,m;if(null!=b)return c(b,null);for(g=function(){var a,b,c,d;for(c=JSON.parse(g.content).Items,d=[],a=0,b=c.length;a<b;a++)h=c[a],d.push(h.Id);return d}(),l=s._helpers.asyncResultWaiter(g.length,function(a){return c(null,a)}),m=[],j=0,k=g.length;j<k;j++)i=g[j],m.push(d.http.get(d._personUrl+"/opdrachten/"+i,{},function(b,c){var g,h,i;return g=s.Assignment._convertRaw(d,JSON.parse(c.content)),null!=e?g._class=a.find(e,function(a){return a.abbreviation()===g._class}):g._class=null,f?(i=null!=(h=g.teachers())?h:[],d.fillPersons(i,function(a,b){return g._teachers=b,l(g)},3)):l(g)}));return m})}}(this),e?this.courses(function(a,b){return null!=b&&0!==b.length?b[0].classes(function(a,b){return null!=b&&0!==b.length?d(b):d()}):d()}):d()},b.prototype.digitalSchoolUtilities=function(){var b,c,d,e;if(this._forceReady(),c=null==(d=a.find(arguments,function(b){return a.isBoolean(b)}))||d,b=a.find(arguments,function(b){return a.isFunction(b)}),null!=b)return e=this._personUrl+"/lesmateriaal",this.http.get(e,{},function(c){return function(d,e){var f,g;return null!=d?b(d,null):(f=a.partial(s.DigitalSchoolUtility._convertRaw,c),g=JSON.parse(e.content).Items,b(null,a.map(g,f)))}}(this))},b.prototype.profileInfo=function(){return this._forceReady(),this._profileInfo},b.prototype.children=function(c){return this.http.get(this._personUrl+"/kinderen",{},function(d){return function(e,f){var g,h,i,j,k,l,m,n;if(null!=e)return c(e,null);if(k=JSON.parse(f.content),null!=k.ExceptionId&&1===k.Reason)return void c(a.extend(k,{message:"User is not a parent."}),null);for(n=[],m=k.Items,h=0,i=m.length;h<i;h++)l=m[h],g=s.ProfileInfo._convertRaw(d,l),g._profilePicture=d.magisterSchool.url+"/api/personen/"+l.Id+"/foto",n.push((j=new b({school:d.magisterSchool,username:d.username,password:d.password,login:!1}),j.http=d.http,j._id=l.Id,j._personUrl=d.magisterSchool.url+"/api/personen/"+j._id,j._pupilUrl=d.magisterSchool.url+"/api/leerlingen/"+j._id,j._profileInfo=g,j._ready=!0,j));return c(null,n)}}(this))},b.prototype.ready=function(b){return a.isFunction(b)&&(b=a.bind(b,this),this._ready||null!=this._magisterLoadError?b(this._magisterLoadError):this._readyCallbacks.push(b)),this._ready===!0},b.prototype._forceReady=function(){if(!this._ready)throw new Error("Not done with logging in or errored during logging in! (did you use Magister.ready(callback) to be sure that logging in is done?)")},b.prototype._setReady=function(){var a,b,c,d;for(this._ready=!0,d=this._readyCallbacks,b=0,c=d.length;b<c;b++)(a=d[b])();return this._readyCallbacks=[]},b.prototype._setErrored=function(a,b){var c,d,e,f,g,h;try{g=JSON.parse(a),this._magisterLoadError={};for(e in g)this._magisterLoadError[e.toLowerCase()]=g[e];this._magisterLoadError.toString=function(){var a;return null!=(a=g.message)?a:""}}catch(b){this._magisterLoadError=a}for(null!=b&&(this._magisterLoadError.statusCode=b),h=this._readyCallbacks,d=0,f=h.length;d<f;d++)(c=h[d])(this._magisterLoadError);return this._readyCallbacks=[]},b.prototype._readyCallbacks=[],b.prototype._magisterLoadError=null,b.prototype._reLogin=function(a){var b,c,d,e;return this._ready=!1,this._magisterLoadError=null,this.magisterSchool.url=this.magisterSchool.url.replace(/^https?/,"https"),c=this.magisterSchool.url+"/api/sessies/huidige",d=this.magisterSchool.url+"/api/sessies",e=function(a){return function(b){return a._sessionId=b,a.http._cookie="SESSION_ID="+a._sessionId+"; M6UserName="+a.username}}(this),b=function(a){return function(){var b;try{return a.http.get(a.magisterSchool.url+"/api/account",{},function(b,c){var d;if(null!=b)return void a._setErrored(b,null!=c?c.statusCode:void 0);try{c=JSON.parse(c.content),a._id=c.Persoon.Id,a._personUrl=a.magisterSchool.url+"/api/personen/"+a._id,a._pupilUrl=a.magisterSchool.url+"/api/leerlingen/"+a._id,a._profileInfo=s.ProfileInfo._convertRaw(a,c.Persoon)}catch(b){return d=b,void a._setErrored(d,null!=c?c.statusCode:void 0)}return a._fetchMessageFolders(function(b){return null!=b?a._setErrored(b,b.statusCode):a._setReady()})})}catch(c){return b=c,a._setErrored(b)}}}(this),null!=a?(e(a),b()):this.http.delete(c,{},function(a){return function(c,f){return null!=c?void a._setErrored(c,null!=f?f.statusCode:void 0):(e(/[a-z\d-]+/.exec(f.headers["set-cookie"][0])[0]),a.http.post(d,{Gebruikersnaam:a.username,Wachtwoord:a.password,IngelogdBlijven:a._keepLoggedIn},{headers:{"Content-Type":"application/json;charset=UTF-8"}},function(c,d){return null!=c?a._setErrored(c,null!=d?d.statusCode:void 0):(e(/[a-z\d-]+/.exec(d.headers["set-cookie"][0])[0]),b())}))}}(this))},b}(),s=null!=(p="undefined"!=typeof module&&null!==module?module.exports:void 0)?p:null!=this.Magister?this.Magister:this.Magister={},c=function(a,b){switch(b){case 1:return a.inbox();case 2:return a.sentItems();case 3:return a.bin();case 4:return a.alerts();default:return s.MessageFolder._convertRaw({Id:b})}},s.Message=function(){function b(a){if(this._magisterObj=a,null==this._magisterObj)throw new Error("Magister instance is null!");this._magisterObj._forceReady(),this._canSend=!0,this._sender=this._magisterObj.profileInfo(),this._recipients=[],this._sendDate=new Date,this._isRead=!1,this._type=1,this._subject="",this._body="",this.id=s._getset("_id"),this.body=s._getset("_body",function(a){return function(b){return a._body=(null!=b?b:"").replace("\n","<br>")}}(this),s._helpers.cleanHtmlContent),this.attachments=s._getset("_attachments"),this.messageFolder=s._getset("_folderId",function(a){return function(b){return a.move(b)}}(this),function(a){return function(b){return c(a._magisterObj,b)}}(this)),this.subject=s._getset("_subject",function(a){return function(b){return a._subject=b}}(this)),this.sender=s._getset("_sender"),this.recipients=s._getset("_recipients"),this.sendDate=s._getset("_sendDate"),this.begin=s._getset("_begin"),this.end=s._getset("_end"),this.isRead=s._getset("_isRead",function(a){return function(b){if(a._isRead!==b&&!a._canSend)return a._isRead=b,a._update()}}(this)),this.state=s._getset("_state"),this.isFlagged=s._getset("_isFlagged"),this.type=s._getset("_type")}return b.prototype._tasks=0,b.prototype._sendAfterFinished=!1,b.prototype._finishedCallback=null,b.prototype._isWorking=function(){return 0!==this._tasks},b.prototype._tickDown=function(){if(0===--this._tasks&&this._sendAfterFinished)return this.send(this._finishedCallback)},b.prototype._reset=function(){return this._tasks=0,this._sendAfterFinished=!1},b.prototype.addRecipient=function(b,c){var d,e,f,g;if(a.isString(b))this._tasks++,this._magisterObj.getPersons(b,c,function(a){return function(d,e){if(null!=d)throw a._reset(),d;if(0!==e.length)return a.recipients().push(e[0]),a._tickDown();throw null!=c?(a._reset(),new Error("Couldn't find a person with the type: \""+c+'" and with the query: "'+b+'"')):(a._reset(),new Error("Couldn't find a person with the query: \""+b+'"'))}}(this));else if(a.isArray(b))for(d=0,e=b.length;d<e;d++)f=b[d],this.addRecipient(f,c);else if(a.isObject(b))this.recipients().push(b);else{if(!a.isNumber(b))throw this._reset(),new Error("Expected recipient to be a String, Number, or an Object, got a(n) "+s._helpers.typeof(b));g=new s.Person(this._magisterObj,"",""),g._id=b,g._type=3,this.recipients().push(g)}},b.prototype.createReplyMessage=function(a){var b,c;return c=0!==this.subject().indexOf("RE: ")?"RE: "+this.subject():c(),b=new s.Message(this._magisterObj),b._sender=this._sender,b._folderId=this._folderId,b._isFlagged=this._isFlagged,b._id=this._id,b._body=(null!=a?a+"<br><br>---------------<br>":"")+("<b>Van:</b> "+this.sender().description()+"<br><b>Verzonden:</b> "+this.sendDate().toLocaleString()+"<br><b>Aan:</b> "+this.recipients().map(function(a){return a.fullName()}).join(", ")+"<br><b>Onderwerp:</b> "+this.subject()+'<br><br>"'+this.body()+'"<br><br>'),b._subject=c,b._recipients=[this.sender()],b},b.prototype.createReplyToAllMessage=function(b){var c,d;return d=0!==this.subject().indexOf("RE: ")?"RE: "+this.subject():d(),c=new s.Message(this._magisterObj),c._sender=this._sender,c._folderId=this._folderId,c._isFlagged=this._isFlagged,c._id=this._id,c._body=(null!=b?b+"<br><br>---------------<br>":"")+("<b>Van:</b> "+this.sender().description()+"<br><b>Verzonden:</b> "+this.sendDate().toLocaleString()+"<br><b>Aan:</b> "+this.recipients().map(function(a){return a.fullName()}).join(", ")+"<br><b>Onderwerp:</b> "+this.subject()+'<br><br>"'+this.body()+'"<br><br>'),c._subject=d,c._recipients=a.reject(this.recipients(),function(a){return a.id()===this._magisterObj.profileInfo().id()}).concat([this.sender()]),c},b.prototype.createForwardMessage=function(a){var b,c;return c=0!==this.subject().indexOf("FW: ")?"FW: "+this.subject():c(),b=new s.Message(this._magisterObj),b._sender=this._sender,b._folderId=this._folderId,b._isFlagged=this._isFlagged,b._id=this._id,b._body=(null!=a?a+"<br><br>---------------<br>":"")+("<b>Van:</b> "+this.sender().description()+"<br><b>Verzonden:</b> "+this.sendDate().toLocaleString()+"<br><b>Aan:</b> "+this.recipients().map(function(a){return a.fullName()}).join(", ")+"<br><b>Onderwerp:</b> "+this.subject()+'<br><br>"'+this.body()+'"<br><br>'),b._subject=c,b},b.prototype.send=function(b){var c;return this._isWorking()?(this._sendAfterFinished=!0,this._finishedCallback=b,!1):(c=function(a){return s._helpers.defer(b,new Error(a),null)},this._canSend?null==this.recipients()||null==this.sender()?void c("both sender and recipients must have a value"):a.isEmpty(this.subject())?void c("subject can't be empty"):(this._magisterObj.http.post(this._magisterObj._personUrl+"/berichten",this._toMagisterStyle(),{},function(a){return function(c,d){return null!=c?"function"==typeof b?b(c,null):void 0:"function"==typeof b?b(null,a):void 0}}(this)),!0):void c("this message is marked as unsendable"))},b.prototype.move=function(b){if(a.isObject(b)&&(b=b.id()),!a.isNumber(b))throw new Error("Could not resolve MessageFolder form the given destination.");if(this._folderId!==b)return this._folderId=b,this._update()},b.prototype.remove=function(a){return this._magisterObj.http.delete(this._magisterObj._personUrl+"/berichten/"+this.id(),{},function(b,c){return"function"==typeof a?a(b):void 0})},b.prototype.fillMessage=function(){var b,c,d;return c=null!=(d=a.first(arguments))&&d,b=a.last(arguments),this._filled?s._helpers.defer(b,null,this):null!=b?this._magisterObj.http.get(this._fillUrl,{},function(a){return function(d,e){var f,g,h;return null!=d?"function"==typeof b?b(d,null):void 0:(g=JSON.parse(e.content),a._body=g.Inhoud,a._attachments=function(){var a,b,c,d,e;for(c=null!=(d=g.Bijlagen)?d:[],e=[],a=0,b=c.length;a<b;a++)f=c[a],e.push(s.File._convertRaw(this._magisterObj,void 0,f));return e}.call(a),c?(h=s._helpers.asyncResultWaiter(m.recipients().length+1,function(){return a._filled=!0,"function"==typeof b?b(null,a):void 0}),a._magisterObj.fillPersons(m.recipients(),function(a,b){return m._recipients=b,h(b)}),a._magisterObj.fillPersons(m.sender(),function(a,b){return m._sender=b,h(b)})):(a._filled=!0,"function"==typeof b?b(null,a):void 0))}}(this)):void 0},b.prototype._update=function(){return this._magisterObj.http.put(this._magisterObj._personUrl+"/berichten/"+this.id()+"?berichtSoort="+this.type(),this._toMagisterStyle(),{},function(){})},b.prototype._toMagisterStyle=function(){var a,b;return a={},a.Id=this._id,a.Inhoud=this._body,a.MapId=this._folderId,a.Onderwerp=this._subject,a.Ontvangers=function(){var a,c,d,e;for(d=this._recipients,e=[],a=0,c=d.length;a<c;a++)b=d[a],e.push(b._toMagisterStyle());return e}.call(this),a.VerstuurdOp=this._sendDate,a.Begin=this._begin,a.Einde=this._end,a.IsGelezen=this._isRead,a.Status=this._state,a.HeeftPrioriteit=this._isFlagged,a.Soort=this._type,a},b._convertRaw=function(a,b){var c,d,e;return d=new s.Message(a),d._id=b.Id,d._body=null!=(e=b.Inhoud)?e:"",d._folderId=b.MapId,d._subject=b.Onderwerp,d._sender=s.Person._convertRaw(a,b.Afzender),d._recipients=function(){var d,e,f,g,h;for(f=null!=(g=b.Ontvangers)?g:[],h=[],d=0,e=f.length;d<e;d++)c=f[d],h.push(s.Person._convertRaw(a,c));return h}(),d._sendDate=s._helpers.parseDate(b.VerstuurdOp),d._begin=s._helpers.parseDate(b.Begin),d._end=s._helpers.parseDate(b.Einde),d._isRead=b.IsGelezen,d._state=b.Status,d._isFlagged=b.HeeftPrioriteit,d._type=b.Soort,d._canSend=!1,d._fillUrl=a._personUrl+"/berichten/"+d._id+"?berichtSoort="+d._type,d},b}(),s=null!=(q="undefined"!=typeof module&&null!==module?module.exports:void 0)?q:null!=this.Magister?this.Magister:this.Magister={},s.MessageFolder=function(){function b(a){this._magisterObj=a,this.name=s._getset("_name"),this.unreadMessagesCount=s._getset("_unreadMessagesCount"),this.id=s._getset("_id"),this.parentId=s._getset("_parentId")}return b.prototype.messages=function(){var b,c,d,e,f,g,h,i;if(0!==arguments.length)return 1===arguments.length?(f={},b=arguments[0]):(f=arguments[0],b=arguments[1]),e=f.limit,h=f.skip,g=f.readState,d=f.fillPersons,c=f.fill,null==e&&(e=10),null==h&&(h=0),null==g&&(g="all"),null==c&&(c=!0),null==d&&(d=!1),0===e?void s._helpers.defer(b,null,[]):(i=this._magisterObj._personUrl+"/berichten?mapId="+this.id()+"&top="+e+"&skip="+h,i+=function(){switch(g){case"read":return"&gelezen=true";case"unread":return"&gelezen=false";default:return""}}(),this._magisterObj.http.get(i,{},function(e){return function(f,g){var h,i,j,k,l,m,n,o;if(null!=f)b(f,null);else if(n=function(){var a,b,c,d;for(c=JSON.parse(g.content).Items,d=[],a=0,b=c.length;a<b;a++)m=c[a],d.push(s.Message._convertRaw(this._magisterObj,m));return d}.call(e),o=s._helpers.asyncResultWaiter(n.length,function(c){return b(null,a.sortBy(c,function(a){return a.sendDate()}).reverse())}),c)for(h=function(a){return a.fillMessage(d,function(a,c){return null!=a?b(a,null):o(c)})},i=0,k=n.length;i<k;i++)m=n[i],h(m);else for(j=0,l=n.length;j<l;j++)m=n[j],o(m)}}(this)))},b.prototype.messageFolders=function(b,c){var d;if(c=null!=(d=null!=c?c:b)?d:function(){},null!=c)return this._magisterObj.http.get(this._magisterObj._personUrl+"/berichten/mappen?parentId="+this.id(),{},function(d){return function(e,f){var g,h;return null!=e?c(e,null):(h=function(){var a,b,c,d;for(c=JSON.parse(f.content).Items,d=[],a=0,b=c.length;a<b;a++)g=c[a],d.push(s.MessageFolder._convertRaw(this._magisterObj,g));return d}.call(d),f=a.isString(b)&&""!==b?a.where(h,function(a){return Helpers.contains(a.name(),b,!0)}):h,c(null,f))}}(this))},b.prototype.removeAllMessages=function(){return this._magisterObj.http.delete(this._magisterObj._personUrl+"/berichten/map/"+this.id(),{},function(a,b){if(null!=a)throw a})},b.prototype.createMessageFolder=function(a,b){var c;return null==b&&(b=function(){}),c={naam:a,parentId:this.id(),persoonId:this._magisterObj._id},this._magisterObj.http.post(this._magisterObj._personUrl+"/berichten/mappen",c,{},function(a){return function(c,d){return null!=c?b(c,null):b(null,s.MessageFolder._convertRaw(a._magisterObj,JSON.parse(d.content)))}}(this))},b.prototype.remove=function(){return this._magisterObj.http.put(this._magisterObj._personUrl+"/berichten/mappen",this._toMagisterStyle(),{},function(a,b){if(null!=a)throw a})},b.prototype._toMagisterStyle=function(){var a;return a={},a.Naam=this._name,a.OngelezenBerichten=this._unreadMessagesCount,a.Id=this._id,a.ParentId=this._parentId,a},b._convertRaw=function(a,b){var c;return c=new s.MessageFolder(a),c._name=b.Naam,c._unreadMessagesCount=b.OngelezenBerichten,c._id=b.Id,c._parentId=b.ParentId,c},b}(),s=null!=(r="undefined"!=typeof module&&null!==module?module.exports:void 0)?r:null!=this.Magister?this.Magister:this.Magister={},s.Person=function(){function b(a,c,d){this._magisterObj=a,this._firstName=c,this._lastName=d,this.id=s._getset("_id"),this.type=s._getset("_type",function(a){return function(c){return a._type=b._convertType(c,!0)}}(this),b._convertType),this.firstName=s._getset("_firstName"),this.lastName=s._getset("_lastName"),this.namePrefix=s._getset("_namePrefix"),this.fullName=s._getset("_fullName"),this.description=s._getset("_description"),this.group=s._getset("_group"),this.teacherCode=s._getset("_teacherCode"),this.emailAddress=s._getset("_emailAddress")}return b.prototype._toMagisterStyle=function(){var a;return a={},a.Id=this._id,a.Type=4===this._type?3:this._type,a.Voornaam=this._firstName,a.Achternaam=this._lastName,a.Tussenvoegsel=this._namePrefix,a.Naam=this._fullName,a.Omschrijving=this._description,a.Groep=this._group,a.Docentcode=this._teacherCode,a.Emailadres=this._emailAddress,a},b._convertRaw=function(a,b,c){var d,e,f;return d=new s.Person(a,b.Voornaam,b.Achternaam),d._id=b.Id,d._namePrefix=b.Tussenvoegsel,d._fullName=b.Naam,d._description=null!=(e=null!=(f=b.Omschrijving)?f:b.Naam)?e:b.naam,d._group=b.Groep,d._teacherCode=b.Docentcode,d._emailAddress=b.Emailadres,d._type=null!=c?c:b.Type,d},b._convertType=function(b,c){if(null==c&&(c=!0),c){if(a.isNumber(b)){if(1!==b&&2!==b&&3!==b&&6!==b&&8!==b)throw new Error("Invalid value: '"+b+"'.");return b}switch(b.toLowerCase()){case"group":return 1;case"study":return 2;case"person":case"teacher":case"personnel":case"pupil":return 3;case"location":return 6;case"project":return 8;default:throw new Error('Invalid value: "'+b+'".')}}else switch(b){case 1:return"group";case 2:return"study";case 3:return"person";case 6:return"location";case 8:return"project";default:return"unknown"}},b}(),s=null!=(f="undefined"!=typeof module&&null!==module?module.exports:void 0)?f:null!=this.Magister?this.Magister:this.Magister={},s.ProfileInfo=function(){function a(a,b,c,d){this._magisterObj=a,this._firstName=b,this._lastName=c,this._birthDate=d,this.id=s._getset("_id"),this.officialFirstNames=s._getset("_officialFirstNames"),this.initials=s._getset("_initials"),this.namePrefix=s._getset("_namePrefix"),this.officialSurname=s._getset("_officialSurname"),this.birthSurname=s._getset("_birthSurname"),this.birthNamePrefix=s._getset("_birthNamePrefix"),this.useBirthname=s._getset("_useBirthname"),this.firstName=s._getset("_firstName"),this.lastName=s._getset("_lastName"),this.fullName=function(){return null===this.namePrefix()?this.firstName()+" "+this.lastName():this.firstName()+" "+this.namePrefix()+" "+this.lastName()},this.birthDate=s._getset("_birthDate"),this.isChild=s._getset("_isChild"),this.isVisibleForParent=s._getset("_isVisibleForParent")}return a.prototype.profilePicture=function(a,b,c){return null==a&&(a=640),null==b&&(b=640),null==c&&(c=!1),this._magisterObj._personUrl+"/foto?width="+a+"&height="+b+"&crop="+c},a.prototype.address=function(a){var b;return b=this._magisterObj._personUrl+"/adresprofiel",this._magisterObj.http.get(b,{},function(b,c){var d;return null!=b?a(b,null):(d=JSON.parse(c.content),a(null,s.AddressInfo._convertRaw(this._magisterObj,d)))})},a.prototype.settings=function(a){var b;return b=this._magisterObj._personUrl+"/profiel",this._magisterObj.http.get(b,{},function(b){return function(c,d){var e;return null!=c?a(c,null):(e=JSON.parse(d.content),a(null,s.ProfileSettings._convertRaw(b._magisterObj,e)))}}(this))},a._convertRaw=function(a,b){var c;return c=new s.ProfileInfo(a,b.Roepnaam,b.Achternaam,s._helpers.parseDate(b.Geboortedatum)),c._id=b.Id,c._officialFirstNames=b.OfficieleVoornamen,c._initials=b.Voorletters,c._namePrefix=b.Tussenvoegsel,c._officialSurname=b.OfficieleAchternaam,c._birthSurname=b.GeboorteAchternaam,c._birthNamePrefix=b.GeboortenaamTussenvoegsel,c._useBirthname=b.GebruikGeboortenaam,c._isChild=null!=b.ZichtbaarVoorOuder,c._isVisibleForParent=b.ZichtbaarVoorOuder,c},a}(),s.ProfileSettings=function(){function a(a){this._magisterObj=a,this.redirectMagisterMessages=s._getset("_redirectMagisterMessages",function(a){return function(b){return a._redirectMagisterMessages=b}}(this)),this.emailAddress=s._getset("_emailAddress",function(a){return function(b){return a._emailAddress=b}}(this)),this.mobileNumber=s._getset("_mobileNumber",function(a){return function(b){return a._mobileNumber=b}}(this))}return a.prototype.update=function(a){var b;return b=this._magisterObj._personUrl+"/profiel",this._magisterObj.http.put(b,this._toMagisterStyle(),{},function(b,c){return a(b)})},a.prototype._toMagisterStyle=function(){var a;return a={},a.EloBerichtenDoorsturen=this._redirectMagisterMessages,a.EmailAdres=this._emailAddress,a.Mobiel=this._mobileNumber,a},a._convertRaw=function(a,b){var c;return c=new s.ProfileSettings(a),c._redirectMagisterMessages=b.EloBerichtenDoorsturen,c._emailAddress=b.EmailAdres,c._mobileNumber=b.Mobiel,c},a}(),this.AddressInfo=function(){function a(){this.postalCode=s._getset("_postalCode"),this.street=s._getset("_street"),this.houseNumber=s._getset("_houseNumber"),this.suffix=s._getset("_suffix"),this.city=s._getset("_city")}return a._convertRaw=function(a,b){var c;return c=new s.AddressInfo,c._postalCode=b.Postcode,c._street=b.Straatnaam,c._houseNumber=b.Huisnummer,c._suffix=b.Toevoeging,c._city=b.Woonplaats,c},a}(),s=null!=(g="undefined"!=typeof module&&null!==module?module.exports:void 0)?g:null!=this.Magister?this.Magister:this.Magister={},s.MagisterSchool=function(){function a(a,b,c){this.id=a,this.name=b,this.url=c}return a.prototype.versionInfo=function(a){return(new s.MagisterHttp).get(this.url+"/api/versie",{},function(b,c){var d;return null!=b?a(b,null):(d=JSON.parse(c.content),a(null,{core:d.CoreVersie,api:d.ApiVersie,db:d.DatabaseVersie,product:d.ProductVersie,releasedOn:s._helpers.parseDate(d.ReleaseDatum)}))})},a.getSchools=function(a,b){return null!=a&&a.trim().length>=3?(a=a.replace(/\d/g,"").trim(),(new s.MagisterHttp).get("https://mijn.magister.net/api/schools?filter="+a,{},function(a){return function(c,d){var e;return null!=c?b(c,null):b(null,function(){var a,b,c,f;for(c=JSON.parse(d.content),f=[],a=0,b=c.length;a<b;a++)e=c[a],f.push(this._convertRaw(e));return f}.call(a))}}(this))):void b(null,[])},a._convertRaw=function(a){return new s.MagisterSchool(a.Id,a.Name,a.Url)},a}(),s=null!=(h="undefined"!=typeof module&&null!==module?module.exports:void 0)?h:null!=this.Magister?this.Magister:this.Magister={},s.StudyGuide=function(){function a(a){this._magisterObj=a,this.id=s._getset("_id"),this.from=s._getset("_from"),this.to=s._getset("_to"),this.classCodes=s._getset("_classCodes"),this.name=s._getset("_name"),this.archived=s._getset("_archived"),this.class=s._getset("_class")}return a.prototype.parts=function(a){if(null!=a)return this._magisterObj.http.get(this._magisterObj._pupilUrl+"/studiewijzers/"+this.id(),{},function(b){return function(c,d){var e,f,g,h,i,j,k;if(null!=c)return a(c,null);for(d=JSON.parse(d.content).Onderdelen.Items,i=s._helpers.asyncResultWaiter(d.length,function(b){return a(null,b)}),j=function(){var a,b,c;for(c=[],a=0,b=d.length;a<b;a++)h=d[a],c.push(h.Id);return c}(),k=[],f=0,g=j.length;f<g;f++)e=j[f],k.push(b._magisterObj.http.get(b._magisterObj._pupilUrl+"/studiewijzers/"+b.id()+"/onderdelen/"+e,{},function(c,d){var e,f;return null!=c?a(c,null):(e=JSON.parse(d.content),f=s.StudyGuidePart._convertRaw(b._magisterObj,e),i(f))}));return k}}(this))},a._convertRaw=function(a,b){var c;return c=new s.StudyGuide(a),c._id=b.Id,c._from=s._helpers.parseDate(b.Van),c._to=s._helpers.parseDate(b.TotEnMet),c._classCodes=b.VakCodes,c._class=b.VakCodes[0],c._name=b.Titel,c._archived=b.InLeerlingArchief,c},a}(),s.StudyGuidePart=function(){function a(a){this._magisterObj=a,this.id=s._getset("_id"),this.from=s._getset("_from"),this.to=s._getset("_to"),this.name=s._getset("_name"),this.description=s._getset("_description",null,s._helpers.cleanHtmlContent),this.visible=s._getset("_visible"),this.number=s._getset("_number"),this.files=s._getset("_files")}return a._convertRaw=function(a,b){var c,d,e;return d=new s.StudyGuidePart(a),d._id=b.Id,d._from=s._helpers.parseDate(b.Van),d._to=s._helpers.parseDate(b.TotEnMet),d._name=b.Titel,d._description=null!=(e=b.Omschrijving)?e:"",d._visible=b.IsZichtbaar,d._number=b.Volgnummer,d._files=function(){var d,e,f,g;for(f=b.Bronnen,g=[],d=0,e=f.length;d<e;d++)c=f[d],g.push(s.File._convertRaw(a,void 0,c));return g}(),d},a}(),!function(a){"use strict";if(a.URL=a.URL||a.webkitURL,a.Blob&&a.URL)try{return void new Blob}catch(a){}var b=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array,s=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL=function(a){var b,c=document.createElementNS("http://www.w3.org/1999/xhtml","a");return c.href=a,"origin"in c||("data:"===c.protocol.toLowerCase()?c.origin=null:(b=a.match(s),c.origin=b&&b[1])),c}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},f.close=function(){this.size=0,delete this.data},c}(a);a.Blob=function(a,c){var d=c?c.type||"":"",e=new b;if(a)for(var f=0,g=a.length;g>f;f++)e.append(a[f]);return e.getBlob(d)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),saveAs=void 0;try{saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=b.createElementNS("http://www.w3.org/1999/xhtml","a"),d="download"in c,e=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},f=a.webkitRequestFileSystem,g=a.requestFileSystem||f||a.mozRequestFileSystem,h=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},i=0,j=function(b){var c=function(){"string"==typeof b?(a.URL||a.webkitURL||a).revokeObjectURL(b):b.remove()};a.chrome?c():setTimeout(c,10)},k=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(a){h(a)}}},l=function(b,h){var l,m,n,o=this,p=b.type,q=!1,r=function(){k(o,["writestart","progress","write","writeend"])},s=function(){!q&&l||(l=(a.URL||a.webkitURL||a).createObjectURL(b)),m?m.location.href=l:void 0==a.open(l,"_blank")&&"undefined"!=typeof safari&&(a.location.href=l),o.readyState=o.DONE,r(),j(l)},t=function(a){return function(){if(o.readyState!==o.DONE)return a.apply(this,arguments)}},u={create:!0,exclusive:!1};o.readyState=o.INIT,h||(h="download"),d?(l=(a.URL||a.webkitURL||a).createObjectURL(b),c.href=l,c.download=h,e(c),o.readyState=o.DONE,r(),j(l)):(a.chrome&&p&&"application/octet-stream"!==p&&(n=b.slice||b.webkitSlice,b=n.call(b,0,b.size,"application/octet-stream"),q=!0),f&&"download"!==h&&(h+=".download"),("application/octet-stream"===p||f)&&(m=a),g?(i+=b.size,g(a.TEMPORARY,i,t(function(a){a.root.getDirectory("saved",u,t(function(a){var c=function(){a.getFile(h,u,t(function(a){a.createWriter(t(function(c){c.onwriteend=function(b){m.location.href=a.toURL(),o.readyState=o.DONE,k(o,"writeend",b),j(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&s()},["writestart","progress","write","abort"].forEach(function(a){c["on"+a]=o["on"+a]}),c.write(b),o.abort=function(){c.abort(),o.readyState=o.DONE},o.readyState=o.WRITING}),s)}),s)};a.getFile(h,{create:!1},t(function(a){a.remove(),c()}),t(function(a){a.code===a.NOT_FOUND_ERR?c():s()}))}),s)}),s)):s())},m=l.prototype;return m.abort=function(){this.readyState=this.DONE,k(this,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,function(a,b){return new l(a,b)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content),"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs})}catch(a){}s=null!=(i="undefined"!=typeof module&&null!==module?module.exports:void 0)?i:null!=this.Magister?this.Magister:this.Magister={},s._helpers=function(){function b(){}return b.addZero=function(a){return a<10?"0"+a:a.toString()},b.toUtcString=function(a){return b.addZero(a.getFullYear())+"-"+b.addZero(a.getMonth()+1)+"-"+b.addZero(a.getDate())+"T"+b.addZero(a.getHours())+":"+b.addZero(a.getMinutes())+":"+b.addZero(a.getSeconds())+".0000000Z"},b.contains=function(a,b,c){return null==c&&(c=!1),c?a.toUpperCase().indexOf(b.toUpperCase())>=0:a.indexOf(b)>=0},b.asyncResultWaiter=function(b,c){var d,e;return 0===b&&c([]),e=[],d=b,function(b){if(a.isArray(b)?(e=e.concat(b),d-=b.length):(e.push(b),d--),0===d)return c(e)}},b.urlDateConvert=function(a){return a.getFullYear()+"-"+b.addZero(a.getMonth()+1)+"-"+b.addZero(a.getDate())},b.date=function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},b.cleanHtmlContent=function(b){return null!=b?a.unescape(b).replace(/<br\s*\/?>/g,"\n").replace(/<\/\s*p\s*>/g,"\n").replace(/&nbsp;/g," ").replace(/(<[^>]*>)|(&#x200b;)/g,"").replace(/\r?\n/g,"\n").trim():"";
},b.defer=function(){var b,c;c=arguments[0],b=2<=arguments.length?u.call(arguments,1):[],null!=("undefined"!=typeof Meteor&&null!==Meteor?Meteor.defer:void 0)?Meteor.defer(function(){return c.apply(null,b)}):"undefined"!=typeof setImmediate&&null!==setImmediate?setImmediate(function(){return c.apply(null,b)}):a.defer.apply(a,[c].concat(u.call(b)))},b.parseDate=function(a){var b;if(b=Date.parse(a),!isNaN(b))return a=new Date(b)},b.typeof=function(b){return a.isNull(b)?"null":typeof b},b}(),s._getset=function(b,c,d){return function(e){if(null!=e){if(!a.isFunction(c))throw new Error("Changes on this property aren't allowed");c(e,!0)}return a.isFunction(d)?d(this[b],!1):this[b]}},null==Array.isArray&&(Array.isArray=function(a){return Object.prototype.toString.call("[object Array]"===a)}),null==(b=String.prototype).trim&&(b.trim=function(){return this.length>0?this.replace(/^\s+|\s+$/g,""):""})}).call(this);