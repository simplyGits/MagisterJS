/* Magister.js (browser version) by simplyApps. Built on: 11-11-2014 */
(function(){var a,b;this.Appointment=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.begin=_getset("_begin"),this.end=_getset("_end"),this.beginBySchoolHour=_getset("_beginBySchoolHour"),this.endBySchoolHour=_getset("_endBySchoolHour"),this.fullDay=_getset("_fullDay"),this.description=_getset("_description"),this.location=_getset("_location"),this.status=_getset("_status"),this.type=_getset("_type"),this.displayType=_getset("_displayType"),this.content=_getset("_content",null,function(a){return null!=a?a.replace(/<br ?\/?>/g,"\n").replace(/(<[^>]*>)|(&nbsp;)/g,""):""}),this.infoType=_getset("_infoType"),this.notes=_getset("_notes"),this.isDone=_getset("_isDone",function(a){return function(b){return a._isDone!==b?(a._isDone=b,a._magisterObj.http.put(a.url(),a._toMagisterStyle(),{},function(){})):void 0}}(this)),this.classes=_getset("_classes"),this.teachers=_getset("_teachers"),this.classRooms=_getset("_classRooms"),this.groups=_getset("_groups"),this.appointmentId=_getset("_appointmentId"),this.attachments=_getset("_attachments"),this.url=_getset("_url"),this.scrapped=_getset("_scrapped"),this.absenceInfo=_getset("_absenceInfo")}return a.prototype._toMagisterStyle=function(){var a,b,c,d;return b={},b.Id=this._id,b.Start=_helpers.toUtcString(this._begin),b.Einde=_helpers.toUtcString(this._end),b.LesuurVan=this._beginBySchoolHour,b.LesuurTotMet=this._endBySchoolHour,b.DuurtHeleDag=this._fullDay,b.Omschrijving=this._description,b.Lokatie=this._location,b.Status=this._status,b.Type=this._type,b.WeergaveType=this._displayType,b.Inhoud=this._content,b.InfoType=this._infoType,b.Aantekening=this._notes,b.Afgerond=this._isDone,b.Lokalen=function(){var b,c,d,e;for(d=this._classRooms,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push({Naam:a});return e}.call(this),b.Docenten=function(){var a,b,d,e;for(d=this._teachers,e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(c._toMagisterStyle());return e}.call(this),b.Vakken=function(){var b,c,d,e;for(d=this._classes,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push({Naam:a});return e}.call(this),b.Groepen=this._groups,b.OpdrachtId=this._appointmentId,b.Bijlagen=null!=(d=this._attachments)?d:[],b},a.prototype._makeStorable=function(){return _.omit(this,"_magisterObj")},a._convertRaw=function(b,c){var d,e,f;return e=new a(b),e._id=c.Id,e._begin=new Date(Date.parse(c.Start)),e._end=new Date(Date.parse(c.Einde)),e._beginBySchoolHour=c.LesuurVan,e._endBySchoolHour=c.LesuurTotMet,e._fullDay=c.DuurtHeleDag,e._description=c.Omschrijving,e._location=c.Lokatie,e._status=c.Status,e._type=c.Type,e._displayType=c.WeergaveType,e._content=c.Inhoud,e._infoType=c.InfoType,e._notes=c.Aantekening,e._isDone=c.Afgerond,e._classes=null!=c.Vakken?function(){var a,b,e,f;for(e=c.Vakken,f=[],a=0,b=e.length;b>a;a++)d=e[a],f.push(d.Naam);return f}():[],e._teachers=null!=c.Docenten?function(){var a,d,e,g;for(e=c.Docenten,g=[],a=0,d=e.length;d>a;a++)f=e[a],g.push(Person._convertRaw(b,f));return g}():[],e._classRooms=null!=c.Lokalen?function(){var a,b,e,f;for(e=c.Lokalen,f=[],a=0,b=e.length;b>a;a++)d=e[a],f.push(d.Naam);return f}():[],e._groups=c.Groepen,e._appointmentId=c.OpdrachtId,e._attachments=c.Bijlagen,e._url=""+b._personUrl+"/afspraken/"+e._id,e._scrapped=0===c.Status,e},a._convertStored=function(b,c){var d;return d=_.extend(c,new a(b)),d._magisterObj=b,d._begin=new Date(Date.parse(c._begin)),d._end=new Date(Date.parse(c._end)),d},a}(),this.Assignment=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.name=_getset("_name"),this.description=_getset("_description"),this["class"]=_getset("_class"),this.deadline=_getset("_deadline"),this.handedInOn=_getset("_handedInOn"),this.files=_getset("_files"),this.teachers=_getset("_teachers"),this.grade=_getset("_grade"),this.markedOn=_getset("_markedOn"),this.handInAgain=_getset("_handInAgain"),this.finished=_getset("_finished"),this.canHandIn=_getset("_canHandIn")}return a.prototype.versions=function(a){var b,c,d,e,f,g;for(c=_helpers.asyncResultWaiter(this._versionIds.length,function(b){return a(null,b)}),f=this._versionIds,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(this._magisterObj.http.get(""+this._magisterObj._personUrl+"/opdrachten/versie/"+b,{},function(b){return function(d,e){return null!=d?a(d,null):c(AssignmentVersion._convertRaw(b._magisterObj,b,EJSON.parse(e.content)))}}(this)));return g},a._convertRaw=function(b,c){var d,e,f,g;return e=new a(b),e._id=c.Id,e._name=c.Titel,e._description=c.Omschrijving,e._class=c.Vak,e._deadline=new Date(Date.parse(c.InleverenVoor)),e._handedInOn=new Date(Date.parse(c.IngeleverdOp)),e._files=function(){var a,e,f,g;for(f=c.Bijlagen,g=[],a=0,e=f.length;e>a;a++)d=f[a],g.push(File._convertRaw(b,void 0,d));return g}(),e._teachers=null!=c.Docenten?function(){var a,d,e,g;for(e=c.Docenten,g=[],a=0,d=e.length;d>a;a++)f=e[a],g.push(Person._convertRaw(b,f));return g}():void 0,e._versionIds=function(){var a,b,d,e;for(d=c.VersieNavigatieItems,e=[],a=0,b=d.length;b>a;a++)g=d[a],e.push(g.Id);return e}(),e._grade=c.Beoordeling,e._markedOn=new Date(Date.parse(c.BeoordeeldOp)),e._handInAgain=c.OpnieuwInleveren,e._finished=c.Afgesloten,e._canHandIn=c.MagInleveren,e},a}(),this.AssignmentVersion=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this["class"]=_getset("_class"),this.state=_getset("_state"),this.pupilMessage=_getset("_pupilMessage"),this.teacherNotice=_getset("_teacherNotice"),this.handedInFiles=_getset("_handedInFiles"),this.feedbackFiles=_getset("_feedbackFiles"),this.deadline=_getset("_deadline"),this.handedInOn=_getset("_handedInOn"),this.grade=_getset("_grade"),this.markedOn=_getset("_markedOn"),this.version=_getset("_version"),this.tooLate=_getset("_tooLate")}return a._convertRaw=function(b,c,d){var e,f;return f=new a(b),f._id=d.Id,f._class=c._class,f._state=d.Status,f._pupilMessage=d.LeerlingOpmerking,f._teacherNotice=d.DocentOpmerking,f._handedInFiles=function(){var a,c,f,g;for(f=d.LeerlingBijlagen,g=[],a=0,c=f.length;c>a;a++)e=f[a],g.push(File._convertRaw(b,void 0,e));return g}(),f._feedbackFiles=function(){var a,c,f,g;for(f=d.FeedbackBijlagen,g=[],a=0,c=f.length;c>a;a++)e=f[a],g.push(File._convertRaw(b,void 0,e));return g}(),f._deadline=new Date(Date.parse(d.InleverenVoor)),f._handedInOn=new Date(Date.parse(d.IngeleverdOp)),f._grade=d.Beoordeling,f._markedOn=new Date(Date.parse(d.BeoordeeldOp)),f._version=d.VersieNummer,f._tooLate=d.IsTeLaat,f},a}(),this.Class=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.beginDate=_getset("_beginDate"),this.endDate=_getset("_endDate"),this.licenseUrl=_getset("_licenseUrl"),this.abbreviation=_getset("_abbreviation"),this.description=_getset("_description"),this.number=_getset("_number")}return a._convertRaw=function(b,c){var d;return d=new a(b),d._id=c.Id,d._beginDate=new Date(Date.parse(c.Begindatum)),d._endDate=new Date(Date.parse(c.Einddatum)),d._licenseUrl=c.LicentieUrl,d._abbreviation=c.Afkorting,d._description=c.Omschrijving,d._number=c.Volgnr,d},a}(),this.Course=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.begin=_getset("_begin"),this.end=_getset("_end"),this.schoolPeriod=_getset("_schoolPeriod"),this.type=_getset("_type"),this.group=_getset("_group"),this.profile=_getset("_profile"),this.alternativeProfile=_getset("_alternativeProfile")}return a.prototype.classes=function(a){return this._magisterObj.http.get(this._classesUrl,{},function(b){return function(c,d){var e;return null!=c?a(c,null):a(null,function(){var a,b,c,f;for(c=EJSON.parse(d.content).Items,f=[],a=0,b=c.length;b>a;a++)e=c[a],f.push(Class._convertRaw(this._magisterObj,e));return f}.call(b))}}(this))},a.prototype.grades=function(){var a,b,c;if(b=null!=(c=_.find(arguments,function(a){return _.isBoolean(a)}))?c:!0,a=_.find(arguments,function(a){return _.isFunction(a)}),null==a)throw new Error("Callback can't be null");return this._magisterObj.http.get(this._gradesUrl,{},function(c){return function(d,e){var f,g,h,i,j;if(null!=d)return a(d,null);for(e=EJSON.parse(e.content).Items,g=_helpers.asyncResultWaiter(e.length,function(b){return a(null,b)}),j=[],h=0,i=e.length;i>h;h++)f=e[h],j.push(function(a){return a.teacher=Person._convertRaw(c._magisterObj,{Docentcode:a.Docent}),a.teacher._type=3,b?c._magisterObj.getPersons(a.Docent,3,function(b,c){var d;return null==b&&null!=c[0]&&(d=c[0]),g(Grade._convertRaw(a))}):g(Grade._convertRaw(a))}(f));return j}}(this))},a._convertRaw=function(b,c){var d;return d=new a(b),d._classesUrl=b.magisterSchool.url+_.find(c.Links,{Rel:"Vakken"}).Href,d._gradesUrl=b._personUrl+("/aanmeldingen/"+c.Id+"/cijfers/cijferoverzichtvooraanmelding?actievePerioden=true&alleenBerekendeKolommen=false&alleenPTAKolommen=false"),d._id=c.Id,d._begin=new Date(Date.parse(c.Start)),d._end=new Date(Date.parse(c.Einde)),d._schoolPeriod=c.Lesperiode,d._type={id:c.Studie.Id,description:c.Studie.Omschrijving},d._group={id:c.Groep.Id,description:c.Groep.Omschrijving,locationId:c.Groep.LocatieId},d._profile=c.Profiel,d._alternativeProfile=c.Profiel2,d},a}(),this.DigitalSchoolUtility=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.type=_getset("_type"),this.name=_getset("_name"),this.publisher=_getset("_publisher"),this.state=_getset("_state"),this.begin=_getset("_begin"),this.end=_getset("_end"),this.EAN=_getset("_EAN"),this.url=_getset("_url"),this["class"]=_getset("_class")}return a._convertRaw=function(b,c){var d;return d=new a(b),d._id=c.Id,d._type=c.MateriaalType,d._name=c.Titel,d._publisher=c.Uitgeverij,d._state=c.Status,d._begin=new Date(Date.parse(c.Start)),d._end=new Date(Date.parse(c.Eind)),d._EAN=Number(c.EAN),d._url=c.Url,d._class=c.Vak,d},a}(),this.FileFolder=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.name=_getset("_name"),this.rights=_getset("_rights"),this.parentId=_getset("_parentId")}return a.prototype.files=function(a){return this._magisterObj.http.get(""+this._magisterObj._personUrl+"/bronnen?parentId="+this.id(),{},function(b){return function(c,d){var e,f,g,h,i,j;if(null!=c)return a(c,null);for(f=function(){var a,b,c,f;for(c=EJSON.parse(d.content).Items,f=[],a=0,b=c.length;b>a;a++)e=c[a],f.push(File._convertRaw(this._magisterObj,this,e));return f}.call(b),g=_helpers.asyncResultWaiter(f.length,function(){return a(null,f)}),j=[],h=0,i=f.length;i>h;h++)e=f[h],j.push(function(a){return b._magisterObj.getPersons(a.GeplaatstDoor,function(b,c){return null==b&&0!==c.length&&(a._addedBy=c[0]),g()})}(e));return j}}(this))},a._convertRaw=function(b,c){var d;return d=new a(b),d._id=c.Id,d._name=c.Naam,d._rights=c.Privilege,d._parentId=c.ParentId,d},a}(),this.File=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.type=_getset("_type"),this.name=_getset("_name",function(a){return function(b){return a._name=b,a._update()}}(this)),this.uri=_getset("_uri"),this.size=_getset("_size"),this.rights=_getset("_rights"),this.mime=_getset("_mime"),this.changedDate=_getset("_changedDate"),this.creationDate=_getset("_creationDate"),this.addedBy=_getset("_addedBy"),this.fileBlobId=_getset("_fileBlobId"),this.fileFolder=_getset("_fileFolder",this.move),this.uniqueId=_getset("_uniqueId")}return a.prototype.download=function(){var a,b,c;return a=_.find(arguments,function(a){return _.isFunction(a)}),b=null!=(c=_.find(arguments,function(a){return _.isBoolean(a)}))?c:!0,this._magisterObj.http.get(this._downloadUrl,{},function(c){return function(d,e){var f;return null!=d?a(d,null):(f=e.content,b&&_helpers.saveFile(f,c.mime(),c.name()),"function"==typeof a?a(null,f):void 0)}}(this))},a.prototype.move=function(a){return this._magisterObj.fileFolders(function(b){return function(c,d){if(null!=c)throw c;return _.isObject(a)||(a=_.find(d,function(b){return _helpers.contains(b.name(),a,!0)||b.id()===a})),b._fileFolder=a,b._update()}}(this))},a.prototype.remove=function(){return this._magisterObj.http["delete"](""+this._magisterObj._personUrl+"/bronnen/"+this.id(),{},function(a){if(null!=a)throw a})},a.prototype._update=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/bronnen/"+this.id(),this._toMagisterStyle(),{},function(){})},a.prototype._toMagisterStyle=function(){var a;return a={},a.Id=this._id,a.BronSoort=this._type,a.Naam=this._name,a.Uri=this._uri,a.Grootte=this._size,a.Privilege=this._rights,a.ContentType=this._mime,a.FileBlobId=this._fileBlobId,a.ParentId=this._fileFolder.id(),a.UniqueId=this._uniqueId,a},a._convertRaw=function(b,c,d){var e,f,g,h;return null!=d._addedBy?e=d._addedBy:(e=new Person(b,null,"",""),e._fullName=d.GeplaatstDoor),g=new a(b),g._id=d.Id,g._type=d.BronSoort,g._name=d.Naam,g._uri=d.Uri,g._size=d.Grootte,g._rights=d.Privilege,g._mime=d.ContentType,g._changedDate=new Date(Date.parse(d.GewijzigdOp)),g._creationDate=new Date(Date.parse(null!=(h=d.GemaaktOp)?h:d.Datum)),g._addedBy=e,g._fileBlobId=d.FileBlobId,g._fileFolder=c,g._uniqueId=d.UniqueId,f=_.find(d.Links,{Rel:"Contents"}),null==f&&(f=_.find(d.Links,{Rel:"Self"})),g._downloadUrl=b.magisterSchool.url+f.Href,g},a}(),this.Grade=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.grade=_getset("_grade"),this.passed=_getset("_passed"),this.dateFilledIn=_getset("_dateFilledIn"),this.gradePeriod=_getset("_gradePeriod"),this["class"]=_getset("_class"),this.atLaterDate=_getset("_atLaterDate"),this.exemption=_getset("_exemption"),this.counts=_getset("_counts"),this.type=_getset("_type"),this.teacher=_getset("_teacher"),this.classExemption=_getset("_classExemption")}return a._convertRaw=function(b,c){var d;return d=new a(b),d._id=c.CijferId,d._grade=c.CijferStr,d._passed=c.IsVoldoende,d._dateFilledIn=new Date(Date.parse(c.DatumIngevoerd)),d._gradePeriod={id:function(){return c.CijferPeriode.Id},abbreviation:function(){return c.CijferPeriode.Afkorting}},d._class={id:function(){return c.Vak.Id},abbreviation:function(){return c.Vak.Afkorting},description:function(){return c.Vak.Omschrijving}},d._atLaterDate=c.Inhalen,d._exemption=c.Vrijstelling,d._counts=c.TeltMee,d._type=GradeType._convertRaw(c.CijferKolom),d._assignmentId=c.CijferKolomIdEloOpdracht,d._teacher=c.teacher,d._classExemption=c.VakDispensatie||c.VakVrijstelling,d},a}(),this.GradeType=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.name=_getset("_name"),this.number=_getset("_number"),this.header=_getset("_header"),this.description=_getset("_description"),this.type=_getset("_type"),this.isAtLaterDate=_getset("_isAtLaterDate"),this.isTeacher=_getset("_isTeacher"),this.hasNestedTypes=_getset("_hasNestedTypes"),this.isPTA=_getset("_isPTA")}return a._convertRaw=function(b,c){var d;return d=new a(b),d._id=c.Id,d._name=c.KolomNaam,d._number=c.KolomNummer,d._header=c.KolomKop,d._description=c.KolomOmschrijving,d._type=c.KolomSoort,d._isAtLaterDate=c.IsHerkansingKolom,d._isTeacher=c.IsDocentKolom,d._hasNestedTypes=c.HeeftOndeliggendeKolommen,d._isPTA=c.IsPTAKolom,d},a}(),this.Magister=function(){function a(a,b,c,d){if(this.magisterSchool=a,this.username=b,this.password=c,this._keepLoggedIn=null!=d?d:!0,3!==arguments.length&&4!==arguments.length)throw new Error("Expected 3 or 4 arguments, got "+arguments.length);this._readyCallbacks=[],this.http=new MagisterHttp,_.isString(this.magisterSchool)?MagisterSchool.getSchools(this.magisterSchool,function(a){return function(b,c){if(null!=b)throw b;if(0===c.length)throw new Error("No school with the query "+a.magisterSchool+" found.");return a.magisterSchool=c[0],a.reLogin()}}(this)):this.reLogin()}return a.prototype.appointments=function(){var a,b,c,d,e,f,g,h;return a=_.find(arguments,function(a){return _.isFunction(a)}),c=null!=(g=_.find(arguments,function(a){return _.isBoolean(a)}))?g:!0,h=_.where(arguments,function(a){return _.isDate(a)}),d=h[0],e=h[1],_.isDate(e)||(e=d),this._forceReady(),b=_helpers.urlDateConvert,f=""+this._personUrl+"/afspraken?tot="+b(e)+"&van="+b(d),this.http.get(f,{},function(f){return function(g,h){var i,j,k,l,m,n,o,p;if(null!=g)return a(g,null);if(h=EJSON.parse(h.content),k=function(){var a,b,c,d;for(c=h.Items,d=[],a=0,b=c.length;b>a;a++)i=c[a],d.push(Appointment._convertRaw(this,i));return d}.call(f),j=[],l=_helpers.asyncResultWaiter(3,function(){var b,c,f;for(b=function(a){return a._absenceInfo=_.find(j,function(b){return b.appointmentId===a.id()})},c=0,f=k.length;f>c;c++)i=k[c],b(i);return _.remove(k,function(a){return _helpers.date(a.begin())<_helpers.date(d)||_helpers.date(a.end())>_helpers.date(e)}),a(null,_.sortBy(k,function(a){return a.begin()}))}),f.http.get(""+f._personUrl+"/roosterwijzigingen?tot="+b(e)+"&van="+b(d),{},function(a,b){var c;return k=_helpers.pushMore(k,function(){var a,d,e,f;for(e=EJSON.parse(b.content).Items,f=[],a=0,d=e.length;d>a;a++)c=e[a],f.push(Appointment._convertRaw(this,c));return f}.call(f)),l()}),f.http.get(""+f._personUrl+"/absenties?tot="+b(e)+"&van="+b(d),{},function(a,b){var c,d,e;for(b=EJSON.parse(b.content).Items,c=function(a){return j.push({id:a.Id,begin:new Date(Date.parse(a.Start)),end:new Date(Date.parse(a.Eind)),schoolHour:a.Lesuur,permitted:a.Geoorloofd,appointmentId:a.AfspraakId,description:_helpers.trim(a.Omschrijving),type:a.VerantwoordingType,code:a.Code})},d=0,e=b.length;e>d;d++)i=b[d],c(i);return l()}),c){for(m=_helpers.asyncResultWaiter(k.length,function(){return l()}),p=[],n=0,o=k.length;o>n;n++)i=k[n],p.push(function(a){var b,c;return b=null!=(c=a.teachers())?c:[],f.fillPersons(b,function(b,c){return a._teachers=c,m()},3)}(i));return p}return l()}}(this))},a.prototype.messageFolders=function(a,b){var c;return this._forceReady(),null==b&&(b=function(){}),c=_.isString(a)&&""!==a?_.where(this._messageFolders,function(b){return _helpers.contains(b.name(),a,!0)}):this._messageFolders,b(null,c),c},a.prototype.inbox=function(a){return null==a&&(a=function(){}),this.messageFolders("postvak in",function(b,c){return null!=b?a(b,null):a(null,c[0])})[0]},a.prototype.sentItems=function(a){return null==a&&(a=function(){}),this.messageFolders("verzonden items",function(b,c){return null!=b?a(b,null):a(null,c[0])})[0]},a.prototype.bin=function(a){return null==a&&(a=function(){}),this.messageFolders("verwijderde items",function(b,c){return null!=b?a(b,null):a(null,c[0])})[0]},a.prototype.alerts=function(a){return null==a&&(a=function(){}),this.messageFolders("mededelingen",function(b,c){return null!=b?a(b,null):a(null,c[0])})[0]},a.prototype.courses=function(a){var b;return this._forceReady(),b=""+this._personUrl+"/aanmeldingen",this.http.get(b,{},function(b){return function(c,d){var e;return null!=c?a(c,null):(d=EJSON.parse(d.content),a(null,_.sortBy(function(){var a,b,c,f;for(c=d.Items,f=[],a=0,b=c.length;b>a;a++)e=c[a],f.push(Course._convertRaw(this,e));return f}.call(b),function(a){return a.begin()})))}}(this))},a._cachedPersons={},a.prototype.getPersons=function(){var b,c,d,e,f;return this._forceReady(),c=_helpers.trim(arguments[0]),b=2===arguments.length?arguments[1]:arguments[2],3===arguments.length&&(d=arguments[1]),null!=c&&null!=b&&c.length>=3?null==d?void this.getPersons(c,3,function(a){return function(d,e){var f;return null!=d?b(d,null):(f=e,a.getPersons(c,4,function(a,c){return null!=a?b(a,null):b(null,_helpers.pushMore(c,f))}))}}(this)):(d=function(){switch(Person._convertType(d)){case 1:return"Groep";case 3:return"Docent";case 4:return"Leerling";case 8:return"Project";default:return"Overig"}}(),e=""+this._personUrl+"/contactpersonen?contactPersoonType="+d+"&q="+c,null!=(f=a._cachedPersons[""+this._id+d+c])?b(null,f):this.http.get(e,{},function(e){return function(f,g){var h;return null!=f?b(f,null):(g=function(){var a,b,c,d;for(c=EJSON.parse(g.content).Items,d=[],a=0,b=c.length;b>a;a++)h=c[a],d.push(Person._convertRaw(this,h));return d}.call(e),a._cachedPersons[""+e._id+d+c]=g,b(null,g))}}(this))):void b(null,[])},a.prototype.fillPersons=function(a,b,c){var d,e,f,g,h,i;if(_.isArray(a)){if(0===a.length)return void b(null,[]);for(e=_helpers.asyncResultWaiter(a.length,function(a){return b(null,a)}),f=0,g=a.length;g>f;f++){d=a[f];try{this.getPersons(_.last(d.fullName().split(" ")),null!=(h=d._type)?h:c,function(a,b){var c;if(null!=a||null==b)throw a;return e(null!=(c=b[0])?c:d)})}catch(j){e(d)}}}else{if(!_.isObject(a))throw new Error("Expected persons to be an Array or an Object, got a(n) "+typeof a);try{this.getPersons(_.last(a.fullName().split(" ")),null!=(i=a._type)?i:c,function(c,d){var e;if(null!=c||null==d)throw c;return b(null,null!=(e=d[0])?e:a)})}catch(j){b(a)}}return void 0},a.prototype.composeAndSendMessage=function(){var a,b,c,d,e;return e=_.filter(arguments,function(a){return _.isString(a)}),d=e[0],a=e[1],c=_.last(arguments),2===arguments.length&&(a=""),b=new Message(this),b.subject(d),b.body(null!=a?a:""),b.addRecipient(c),b.send()},a.prototype.fileFolders=function(a){return this.http.get(""+this._personUrl+"/bronnen?soort=0",{},function(b){return function(c,d){var e;return null!=c?a(c,null):a(null,function(){var a,b,c,f;for(c=EJSON.parse(d.content).Items,f=[],a=0,b=c.length;b>a;a++)e=c[a],f.push(FileFolder._convertRaw(this,e));return f}.call(b))}}(this))},a.prototype.studyGuides=function(a){return this.http.get(""+this._pupilUrl+"/studiewijzers?peildatum="+_helpers.urlDateConvert(new Date),{},function(b){return function(c,d){var e;return null!=c?a(c,null):a(null,function(){var a,b,c,f;for(c=EJSON.parse(d.content).Items,f=[],a=0,b=c.length;b>a;a++)e=c[a],f.push(StudyGuide._convertRaw(this,e));return f}.call(b))}}(this))},a.prototype.assignments=function(){var a,b,c,d,e,f;return f=_.filter(arguments,function(a){return _.isNumber(a)}),a=f[0],e=f[1],d=_.find(arguments,function(a){return _.isBoolean(a)}),b=_.find(arguments,function(a){return _.isFunction(a)}),null!=b?(null==d&&(d=!0),null==a&&(a=25),null==e&&(e=0),c=null,this.courses(function(a){return function(e,f){return null!=f&&0!==f.length&&_.last(f).classes(function(a,b){return null!=b&&0!==b.length?c=b:void 0}),a.http.get(""+a._personUrl+"/opdrachten?skip=0&top=25&startdatum="+_helpers.urlDateConvert(new Date)+"&status=alle",{},function(f,g){var h,i,j,k,l;if(null!=f)return b(f,null);for(g=function(){var a,b,c,d;for(c=EJSON.parse(g.content).Items,d=[],a=0,b=c.length;b>a;a++)e=c[a],d.push(e.Id);return d}(),i=_helpers.asyncResultWaiter(g.length,function(a){return b(null,a)}),l=[],j=0,k=g.length;k>j;j++)h=g[j],l.push(a.http.get(""+a._personUrl+"/opdrachten/"+h,{},function(b,e){var f,g,h;return f=Assignment._convertRaw(a,EJSON.parse(e.content)),null!=c&&(f._class=_.find(c,function(a){return a.abbreviation()===f._class})),d?(g=null!=(h=f.teachers())?h:[],a.fillPersons(g,function(a,b){return f._teachers=b,i(f)},3)):i(f)}));return l})}}(this))):void 0},a.prototype.digitalSchoolUtilities=function(){var a,b,c,d;return a=_.find(arguments,function(a){return _.isFunction(a)}),null!=a?(_.isObject(d)&&(d=d.id()),c=null!=d?""+this._personUrl+"/lesmateriaal?vakken="+d:""+this._personUrl+"/lesmateriaal",b=null,this.courses(function(d){return function(e,f){return null!=f&&0!==f.length&&_.last(f).classes(function(a,c){return null!=c&&0!==c.length?b=c:void 0}),d.http.get(c,{},function(c,e){var f,g,h,i,j;if(null!=c)return a(c,null);if(g=function(){var a,b,c,d;for(c=EJSON.parse(e.content).Items,d=[],a=0,b=c.length;b>a;a++)f=c[a],d.push(DigitalSchoolUtility._convertRaw(this,f));return d}.call(d),null!=b)for(h=function(a){return a._class=_.find(b,function(b){return b.abbreviation()===a._class.Afkorting&&b.description()===a._class.Omschrijving})},i=0,j=g.length;j>i;i++)f=g[i],h(f);return a(null,g)})}}(this))):void 0},a.prototype.profileInfo=function(a){return this._forceReady(),"function"==typeof a&&a(null,this._profileInfo),this._profileInfo},a.prototype.ready=function(a){return _.isFunction(a)&&(this._ready?a(this):this._readyCallbacks.push(a)),this._ready===!0},a.prototype._forceReady=function(){if(!this._ready)throw new Error("Not done with logging in! (use Magister.ready(callback) to be sure that logging in is done)")},a.prototype._setReady=function(){var a,b,c,d;for(this._ready=!0,d=this._readyCallbacks,b=0,c=d.length;c>b;b++)(a=d[b])(this);return this._readyCallbacks=[]},a.prototype._readyCallbacks=[],a.prototype.reLogin=function(){var a;return this._ready=!1,a=""+this.magisterSchool.url+"/api/sessie",this.http.post(a,{Gebruikersnaam:this.username,Wachtwoord:this.password,GebruikersnaamOnthouden:!0,IngelogdBlijven:this._keepLoggedIn},{headers:{"Content-Type":"application/json;charset=UTF-8"}},function(a){return function(b,c){if(null!=b)throw new Error(b.message);return a._sessionId=/[a-z\d-]+/.exec(c.headers["set-cookie"][0])[0],a.http._cookie="SESSION_ID="+a._sessionId+"; M6UserName="+a.username,a.http.get(""+a.magisterSchool.url+"/api/account",{},function(b,c){return c=EJSON.parse(c.content),a._group=c.Groep[0],a._id=c.Persoon.Id,a._personUrl=""+a.magisterSchool.url+"/api/personen/"+a._id,a._pupilUrl=""+a.magisterSchool.url+"/api/leerlingen/"+a._id,a._profileInfo=ProfileInfo._convertRaw(a,c),a.http.get(""+a._personUrl+"/berichten/mappen",{},function(b,c){var d;return a._messageFolders=function(){var a,b,e,f;for(e=EJSON.parse(c.content).Items,f=[],a=0,b=e.length;b>a;a++)d=e[a],f.push(MessageFolder._convertRaw(this,d));return f}.call(a),a._setReady()})})}}(this))},a}(),b=function(a,b){switch(b){case 1:return a.inbox();case 2:return a.sentItems();case 3:return a.bin();case 4:return a.alerts();default:return MessageFolder._convertRaw({Id:b})}},this.Message=function(){function a(a){if(this._magisterObj=a,null==this._magisterObj)throw new Error("Magister instance is null!");this._canSend=!0,this._sender=this._magisterObj.profileInfo(),this._recipients=[],this._sendDate=new Date,this._isRead=!1,this._type=1,this._subject="",this._body="",this.id=_getset("_id"),this.body=_getset("_body",function(a){return function(b){return a._body=b}}(this),function(a){return null!=a?a.replace(/<br ?\/?>/g,"\n").replace(/(<[^>]*>)|(&nbsp;)/g,""):a}),this.attachments=_getset("_attachments"),this.messageFolder=_getset("_folderId",function(a){return function(b){return a.move(b)}}(this),function(a){return function(c){return b(a._magisterObj,c)}}(this)),this.subject=_getset("_subject",function(a){return function(b){return a._subject=b}}(this)),this.sender=_getset("_sender"),this.recipients=_getset("_recipients"),this.sendDate=_getset("_sendDate"),this.begin=_getset("_begin"),this.end=_getset("_end"),this.isRead=_getset("_isRead",function(a){return function(b){return a._isRead===b||a._canSend?void 0:(a._isRead=b,a._update())}}(this)),this.state=_getset("_state"),this.isFlagged=_getset("_isFlagged"),this.type=_getset("_type")}return a.prototype._tasks=0,a.prototype._sendAfterFinished=!1,a.prototype._working=function(){return 0!==this._tasks},a.prototype._tickDown=function(){return 0===--this._tasks&&this._sendAfterFinished?this.send():void 0},a.prototype._reset=function(){return this._tasks=0,this._sendAfterFinished=!1},a.prototype.addRecipient=function(a,b){var c,d,e;if(_.isString(a))this._tasks++,this._magisterObj.getPersons(a,b,function(c){return function(d,e){if(0!==e.length)return c.recipients().push(e[0]),c._tickDown();throw null!=b?(c._reset(),new Error("Couldn't find a person with the type: \""+b+'" and with the query: "'+a+'"')):(c._reset(),new Error("Couldn't find a person with the query: \""+a+'"'))}}(this));else if(_.isArray(a))for(d=0,e=a.length;e>d;d++)c=a[d],this.addRecipient(c,b);else{if(!_.isObject(a))throw this._reset(),new Error("Expected recipient to be a String or an Object, got a(n) "+typeof a);this.recipients().push(a)}return void 0},a.prototype.send=function(){if(this._working())return this._sendAfterFinished=!0,!1;if(!this._canSend)throw new Error("This message is marked as unsendable");if(null==this.recipients()||null==this.sender())throw new Error("Sender and/or recipients cannot be null");if(_.isEmpty(this.subject()))throw new Error("Subject cannot be null or empty");return null==this.body()&&this.body(""),this._magisterObj.http.post(""+this._magisterObj._personUrl+"/berichten",this._toMagisterStyle(),{},function(a){if(null!=a)throw a}),!0},a.prototype.move=function(a){if(_.isObject(a)&&(a=a.id()),!_.isNumber(a))throw new Error("Could not resolve MessageFolder form the given destination.");return this._folderId!==a?(this._folderId=a,this._update()):void 0},a.prototype.remove=function(){return this._magisterObj.http["delete"](""+this._magisterObj._personUrl+"/berichten/"+this.id(),{},function(a){if(null!=a)throw a})},a.prototype._update=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/berichten/"+this.id()+"?berichtSoort="+this.type(),this._toMagisterStyle(),{},function(){})},a.prototype._toMagisterStyle=function(){var a,b;return a={},a.Id=this._id,a.Inhoud=this._body,a.MapId=this._folderId,a.Onderwerp=this._subject,a.Ontvangers=function(){var a,c,d,e;for(d=this._recipients,e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(b._toMagisterStyle());return e}.call(this),a.VerstuurdOp=this._sendDate,a.Begin=this._begin,a.Einde=this._end,a.IsGelezen=this._isRead,a.Status=this._state,a.HeeftPrioriteit=this._isFlagged,a.Soort=this._type,a},a._convertRaw=function(b,c){var d,e,f;return e=new a(b),e._id=c.Id,e._body=null!=(f=c.Inhoud)?f:"",e._folderId=c.MapId,e._subject=c.Onderwerp,e._sender=Person._convertRaw(b,c.Afzender),e._recipients=function(){var a,e,f,g;for(f=c.Ontvangers,g=[],a=0,e=f.length;e>a;a++)d=f[a],g.push(Person._convertRaw(b,d));return g}(),e._sendDate=new Date(Date.parse(c.VerstuurdOp)),e._begin=new Date(Date.parse(c.Begin)),e._end=new Date(Date.parse(c.Einde)),e._isRead=c.IsGelezen,e._state=c.Status,e._isFlagged=c.HeeftPrioriteit,e._type=c.Soort,e._canSend=!1,e},a}(),a=function(a){var b,c,d;return b="",_.any(["unread","ongelezen"],function(b){return _helpers.contains(a,b,!0)})?b+="&gelezen=false":_.any(["read","gelezen"],function(b){return _helpers.contains(a,b,!0)})&&(b+="&gelezen=true"),null!=(d=/(skip \d+)|(sla \d+ over)/gi.exec(a))&&(c=/\d+/.exec(d[0])[0],b+="&skip="+c),b},this.MessageFolder=function(){function b(a){this._magisterObj=a,this.name=_getset("_name"),this.unreadMessagesCount=_getset("_unreadMessagesCount"),this.id=_getset("_id"),this.parentId=_getset("_parentId")}return b.prototype.messages=function(){var b,c,d,e,f,g,h,i;if(d=null!=(g=_.find(arguments,function(a){return _.isNumber(a)}))?g:10,e=null!=(h=_.find(arguments,function(a){return _.isString(a)}))?h:"",c=null!=(i=_.find(arguments,function(a){return _.isBoolean(a)}))?i:!0,b=_.find(arguments,function(a){return _.isFunction(a)}),null==b)throw new Error("Callback is null");return 0===d?void b(null,[]):(f=""+this._magisterObj._personUrl+"/berichten?mapId="+this.id()+"&top="+d+a(e),this._magisterObj.http.get(f,{},function(a){return function(d,e){var g,h,i,j,k,l;if(null!=d)return b(d,null);for(h=function(){var a,b,c,d;for(c=EJSON.parse(e.content).Items,d=[],a=0,b=c.length;b>a;a++)g=c[a],d.push(Message._convertRaw(this._magisterObj,g));return d}.call(a),i=_helpers.asyncResultWaiter(h.length,function(a){return b(null,_.sortBy(a,function(a){return a.sendDate()}).reverse())}),l=[],j=0,k=h.length;k>j;j++)g=h[j],l.push(function(b){return f=""+a._magisterObj._personUrl+"/berichten/"+b.id()+"?berichtSoort="+b.type(),a._magisterObj.http.get(f,{},function(d,e){var f,g,h;return g=EJSON.parse(e.content),b._body=g.Inhoud,b._attachments=function(){var a,b,c,d,e;for(d=null!=(c=g.Bijlagen)?c:[],e=[],a=0,b=d.length;b>a;a++)f=d[a],e.push(File._convertRaw(this._magisterObj,void 0,f));return e}.call(a),c?(h=_helpers.asyncResultWaiter(b.recipients().length+1,function(){return i(b)}),a._magisterObj.fillPersons(b.recipients(),function(a,c){return b._recipients=c,h(c)}),a._magisterObj.fillPersons(b.sender(),function(a,c){return b._sender=c,h(c)})):i(b)})}(g));return l}}(this)))},b.prototype.messageFolders=function(a,c){var d;return c=null!=(d=null!=c?c:a)?d:function(){},null!=c?this._magisterObj.http.get(""+this._magisterObj._personUrl+"/berichten/mappen?parentId="+this.id(),{},function(d){return function(e,f){var g,h;return null!=e?c(e,null):(h=function(){var a,c,d,e;for(d=EJSON.parse(f.content).Items,e=[],a=0,c=d.length;c>a;a++)g=d[a],e.push(b._convertRaw(this._magisterObj,g));
return e}.call(d),f=_.isString(a)&&""!==a?_.where(h,function(b){return Helpers.contains(b.name(),a,!0)}):h,c(null,f))}}(this)):void 0},b.prototype.removeAllMessages=function(){return this._magisterObj.http["delete"](""+this._magisterObj._personUrl+"/berichten/map/"+this.id(),{},function(a){if(null!=a)throw a})},b.prototype.createMessageFolder=function(a,c){var d;return null==c&&(c=function(){}),d={naam:a,parentId:this.id(),persoonId:this._magisterObj._id},this._magisterObj.http.post(""+this._magisterObj._personUrl+"/berichten/mappen",d,{},function(a){return function(d,e){return null!=d?c(d,null):c(null,b._convertRaw(a._magisterObj,EJSON.parse(e.content)))}}(this))},b.prototype.remove=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/berichten/mappen",this._toMagisterStyle(),{},function(a){if(null!=a)throw a})},b.prototype._toMagisterStyle=function(){var a;return a={},a.Naam=this._name,a.OngelezenBerichten=this._unreadMessagesCount,a.Id=this._id,a.ParentId=this._parentId,a},b._convertRaw=function(a,c){var d;return d=new b(a),d._name=c.Naam,d._unreadMessagesCount=c.OngelezenBerichten,d._id=c.Id,d._parentId=c.ParentId,d},b}(),this.Person=function(){function a(b,c,d,e){if(this._magisterObj=b,this._type=c,this._firstName=d,this._lastName=e,null!=this._firstName&&null!=this._lastName&&_.any(_.toArray(arguments).slice(2),function(a){return null!=a&&!_.isString(a)}))throw new Error("One or more arguments is not a string.");this.id=_getset("_id"),this.type=_getset("_type",function(b){return function(c){return b._type=a._convertType(c,!0)}}(this),a._convertType),this.firstName=_getset("_firstName"),this.lastName=_getset("_lastName"),this.namePrefix=_getset("_namePrefix"),this.fullName=_getset("_fullName"),this.description=_getset("_description"),this.group=_getset("_group"),this.teacherCode=_getset("_teacherCode"),this.emailAddress=_getset("_emailAddress")}return a.prototype._toMagisterStyle=function(){var a;return a={},a.Id=this._id,a.Type=this._type,a.Voornaam=this._firstName,a.Achternaam=this._lastName,a.Tussenvoegsel=this._namePrefix,a.Naam=this._fullName,a.Omschrijving=this._description,a.Groep=this._group,a.Docentcode=this._teacherCode,a.Emailadres=this._emailAddress,a},a._convertRaw=function(b,c){var d,e;return d=new a(b,c.Type,c.Voornaam,c.Achternaam),d._id=c.Id,d._namePrefix=c.Tussenvoegsel,d._fullName=c.Naam,d._description=null!=(e=c.Omschrijving)?e:c.Naam,d._group=c.Groep,d._teacherCode=c.Docentcode,d._emailAddress=c.Emailadres,d},a._convertType=function(a,b){if(null==b&&(b=!0),b){if(_.isNumber(a)){if(!_.contains([1,3,4,8],a))throw new Error('Invalid value: "'+a+'".');return a}switch(a.toLowerCase()){case"group":return 1;case"teacher":return 3;case"pupil":return 4;case"project":return 8;default:throw new Error('Invalid value: "'+a+'".')}}else switch(a){case 1:return"group";case 3:return"teacher";case 4:return"pupil";case 8:return"project";default:return void 0}},a}(),this.ProfileInfo=function(){function a(a,b,c,d){this._magisterObj=a,this._firstName=b,this._lastName=c,this._birthDate=d,this.id=_getset("_id"),this.officialFirstNames=_getset("_officialFirstNames"),this.initials=_getset("_initials"),this.namePrefix=_getset("_namePrefix"),this.officialSurname=_getset("_officialSurname"),this.birthSurname=_getset("_birthSurname"),this.birthNamePrefix=_getset("_birthNamePrefix"),this.useBirthname=_getset("_useBirthname"),this.firstName=_getset("_firstName"),this.lastName=_getset("_lastName")}return a.prototype.profilePicture=function(a,b,c){return null==a&&(a=640),null==b&&(b=640),null==c&&(c=!1),""+this._profilePicture+"?width="+a+"&height="+b+"&crop="+c},a._convertRaw=function(b,c){var d,e;return d=b.magisterSchool.url+_.find(c.Links,{Rel:"Foto"}).Href,c=c.Persoon,e=new a(b,c.Roepnaam,c.Achternaam,new Date(Date.parse(c.Geboortedatum))),e._id=c.Id,e._officialFirstNames=c.OfficieleVoornamen,e._initials=c.Voorletters,e._namePrefix=c.Tussenvoegsel,e._officialSurname=c.OfficieleAchternaam,e._birthSurname=c.GeboorteAchternaam,e._birthNamePrefix=c.GeboortenaamTussenvoegsel,e._useBirthname=c.GebruikGeboortenaam,e._profilePicture=d,e},a}(),this.MagisterSchool=function(){function a(a,b,c){this.id=a,this.name=b,this.url=c}return a.getSchools=function(a,b){return null==a||_helpers.trim(a).length<3?[]:(new MagisterHttp).get("https://mijn.magister.net/api/schools?filter="+a,{},function(a){return function(c,d){var e;return null!=c?b(c,null):b(null,function(){var a,b,c,f;for(c=EJSON.parse(d.content),f=[],a=0,b=c.length;b>a;a++)e=c[a],f.push(this._convertRaw(e));return f}.call(a))}}(this))},a._convertRaw=function(b){return new a(b.Id,b.Name,b.Url)},a}(),this.StudyGuide=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.from=_getset("_from"),this.to=_getset("_to"),this.classCodes=_getset("_classCodes"),this.name=_getset("_name"),this.archived=_getset("_archived")}return a.prototype.parts=function(a){return null!=a?this._magisterObj.http.get(""+this._magisterObj._pupilUrl+"/studiewijzers/"+this.id(),{},function(b){return function(c,d){var e,f,g,h,i,j,k;if(null!=c)return a(c,null);for(d=EJSON.parse(d.content).Onderdelen.Items,g=_helpers.asyncResultWaiter(d.length,function(b){return a(null,b)}),j=function(){var a,b,c;for(c=[],a=0,b=d.length;b>a;a++)f=d[a],c.push(f.Id);return c}(),k=[],h=0,i=j.length;i>h;h++)e=j[h],k.push(b._magisterObj.http.get(""+b._magisterObj._pupilUrl+"/studiewijzers/"+b.id()+"/onderdelen/"+e,{},function(a,c){return g(StudyGuidePart._convertRaw(b._magisterObj,EJSON.parse(c.content)))}));return k}}(this)):void 0},a._convertRaw=function(b,c){var d;return d=new a(b),d._id=c.Id,d._from=new Date(Date.parse(c.Van)),d._to=new Date(Date.parse(c.TotEnMet)),d._classCodes=c.VakCodes,d._name=c.Titel,d._archived=c.InLeerlingArchief,d},a}(),this.StudyGuidePart=function(){function a(a){this._magisterObj=a,this.id=_getset("_id"),this.from=_getset("_from"),this.to=_getset("_to"),this.name=_getset("_name"),this.description=_getset("_description",null,function(a){return null!=a?a.replace(/<br ?\/?>/g,"\n").replace(/(<[^>]*>)|(&nbsp;)/g,""):a}),this.visible=_getset("_visible"),this.number=_getset("_number"),this.files=_getset("_files")}return a._convertRaw=function(b,c){var d,e;return e=new a(b),e._id=c.Id,e._from=new Date(Date.parse(c.Van)),e._to=new Date(Date.parse(c.TotEnMet)),e._name=c.Titel,e._description=c.Omschrijving,e._visible=c.IsZichtbaar,e._number=c.Volgnummer,e._files=function(){var a,e,f,g;for(f=c.Bronnen,g=[],a=0,e=f.length;e>a;a++)d=f[a],g.push(File._convertRaw(b,void 0,d));return g}(),e},a}(),this._helpers=function(){function a(){}return a.addZero=function(a){return 10>a?"0"+a:a.toString()},a.toUtcString=function(b){return""+a.addZero(b.getUTCFullYear())+"-"+a.addZero(b.getMonth()+1)+"-"+a.addZero(b.getDate())+"T"+a.addZero(b.getHours())+":"+a.addZero(b.getMinutes())+":"+a.addZero(b.getSeconds())+".0000000Z"},a.pushMore=function(a,b){return[].push.apply(a,b),a},a.contains=function(a,b,c){return null==c&&(c=!1),c?a.toUpperCase().indexOf(b.toUpperCase())>=0:a.indexOf(b)>=0},a.asyncResultWaiter=function(b,c){var d,e;return 0===b&&c([]),e=[],d=b,function(b){return _.isArray(b)?(a.pushMore(e,b),d-=b.length):(e.push(b),d--),0===d?c(e):void 0}},a.trim=function(a){return null==a||0===a.length?"":_.isFunction(String.prototype.trim)?a.trim():a.replace(/^\s+|\s+$/g,"")},a.saveFile=function(a,b,c){try{return saveAs(new Blob([a],{type:b}),c)}catch(d){}},a.urlDateConvert=function(b){return""+b.getUTCFullYear()+"-"+a.addZero(b.getMonth()+1)+"-"+a.addZero(b.getDate())},a.date=function(a){return new Date(a.getUTCFullYear(),a.getMonth(),a.getDate())},a}(),this._getset=function(a,b,c){return function(d){if(null!=d){if(!_.isFunction(b))throw new Error("Changes on this property aren't allowed");b(d,!0)}return _.isFunction(c)?c(this[a],!1):this[a]}},null==Array.isArray&&(_.isArray=jQuery.isArray=Array.isArray=function(a){return Object.prototype.toString.call("[object Array]"===a)}),function(){function a(a,b,c){c=(c||0)-1;for(var d=a?a.length:0;++c<d;)if(a[c]===b)return c;return-1}function b(b,c){var d=typeof c;if(b=b.l,"boolean"==d||null==c)return b[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:r+c;return b=(b=b[d])&&b[e],"object"==d?b&&-1<a(b,c)?0:-1:b?0:-1}function c(a){var b=this.l,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:r+a,b=b[c]||(b[c]={});"object"==c?(b[d]||(b[d]=[])).push(a):b[d]=!0}}function d(a){return a.charCodeAt(0)}function e(a,b){for(var c=a.m,d=b.m,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.n-b.n}function f(a){var b=-1,d=a.length,e=a[0],f=a[d/2|0],g=a[d-1];if(e&&"object"==typeof e&&f&&"object"==typeof f&&g&&"object"==typeof g)return!1;for(e=i(),e["false"]=e["null"]=e["true"]=e.undefined=!1,f=i(),f.k=a,f.l=e,f.push=c;++b<d;)f.push(a[b]);return f}function g(a){return"\\"+U[a]}function h(){return o.pop()||[]}function i(){return p.pop()||{k:null,l:null,m:null,"false":!1,n:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,o:null}}function j(a){a.length=0,o.length<t&&o.push(a)}function k(a){var b=a.l;b&&k(b),a.k=a.l=a.m=a.object=a.number=a.string=a.o=null,p.length<t&&p.push(a)}function l(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);var d=-1;c=c-b||0;for(var e=Array(0>c?0:c);++d<c;)e[d]=a[b+d];return e}function m(c){function o(a,b,c){if(!a||!T[typeof a])return a;b=b&&"undefined"==typeof c?b:bb(b,c,3);for(var d=-1,e=T[typeof a]&&Kc(a),f=e?e.length:0;++d<f&&(c=e[d],!1!==b(a[c],c,a)););return a}function p(a,b,c){var d;if(!a||!T[typeof a])return a;b=b&&"undefined"==typeof c?b:bb(b,c,3);for(d in a)if(!1===b(a[d],d,a))break;return a}function t(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if((e=g[h])&&T[typeof e])for(var j=-1,k=T[typeof e]&&Kc(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f}function U(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=bb(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if((e=g[h])&&T[typeof e])for(var k=-1,l=T[typeof e]&&Kc(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f}function W(a){var b,c=[];if(!a||!T[typeof a])return c;for(b in a)rc.call(a,b)&&c.push(b);return c}function X(a){return a&&"object"==typeof a&&!Jc(a)&&rc.call(a,"__wrapped__")?a:new Y(a)}function Y(a,b){this.__chain__=!!b,this.__wrapped__=a}function Z(a){function b(){if(d){var a=l(d);sc.apply(a,arguments)}if(this instanceof b){var f=ab(c.prototype),a=c.apply(f,a||arguments);return vb(a)?a:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Ic(b,a),b}function _(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}if(!vb(a))return a;var g=kc.call(a);if(!Q[g])return a;var i=Gc[g];switch(g){case J:case K:return new i(+a);case M:case P:return new i(a);case O:return f=i(a.source,z.exec(a)),f.lastIndex=a.lastIndex,f}if(g=Jc(a),b){var k=!d;d||(d=h()),e||(e=h());for(var m=d.length;m--;)if(d[m]==a)return e[m];f=g?i(a.length):{}}else f=g?l(a):U({},a);return g&&(rc.call(a,"index")&&(f.index=a.index),rc.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(g?Db:o)(a,function(a,g){f[g]=_(a,b,c,d,e)}),k&&(j(d),j(e)),f):f}function ab(a){return vb(a)?xc(a):{}}function bb(a,b,c){if("function"!=typeof a)return Ub;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Hc.funcNames&&(d=!a.name),d=d||!Hc.funcDecomp,!d)){var e=pc.call(a);Hc.funcNames||(d=!A.test(e)),d||(d=E.test(e),Ic(a,d))}if(!1===d||!0!==d&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Sb(a,b)}function cb(a){function b(){var a=i?g:this;if(e){var o=l(e);sc.apply(o,arguments)}return(f||k)&&(o||(o=l(arguments)),f&&sc.apply(o,f),k&&o.length<h)?(d|=16,cb([c,m?d:-4&d,o,null,g,h])):(o||(o=arguments),j&&(c=a[n]),this instanceof b?(a=ab(c.prototype),o=c.apply(a,o),vb(o)?o:a):c.apply(a,o))}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,m=8&d,n=c;return Ic(b,a),b}function db(c,d){var e=-1,g=mb(),h=c?c.length:0,i=h>=s&&g===a,j=[];if(i){var l=f(d);l?(g=b,d=l):i=!1}for(;++e<h;)l=c[e],0>g(d,l)&&j.push(l);return i&&k(d),j}function eb(a,b,c,d){d=(d||0)-1;for(var e=a?a.length:0,f=[];++d<e;){var g=a[d];if(g&&"object"==typeof g&&"number"==typeof g.length&&(Jc(g)||qb(g))){b||(g=eb(g,b,c));var h=-1,i=g.length,j=f.length;for(f.length+=i;++h<i;)f[j++]=g[h]}else c||f.push(g)}return f}function fb(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;if(a===a&&!(a&&T[typeof a]||b&&T[typeof b]))return!1;if(null==a||null==b)return a===b;var i=kc.call(a),k=kc.call(b);if(i==H&&(i=N),k==H&&(k=N),i!=k)return!1;switch(i){case J:case K:return+a==+b;case M:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case O:case P:return a==fc(b)}if(k=i==I,!k){var l=rc.call(a,"__wrapped__"),m=rc.call(b,"__wrapped__");if(l||m)return fb(l?a.__wrapped__:a,m?b.__wrapped__:b,c,d,e,f);if(i!=N)return!1;if(i=a.constructor,l=b.constructor,i!=l&&!(ub(i)&&i instanceof i&&ub(l)&&l instanceof l)&&"constructor"in a&&"constructor"in b)return!1}for(i=!e,e||(e=h()),f||(f=h()),l=e.length;l--;)if(e[l]==a)return f[l]==b;var n=0,g=!0;if(e.push(a),f.push(b),k){if(l=a.length,n=b.length,(g=n==l)||d)for(;n--;)if(k=l,m=b[n],d)for(;k--&&!(g=fb(a[k],m,c,d,e,f)););else if(!(g=fb(a[n],m,c,d,e,f)))break}else p(b,function(b,h,i){return rc.call(i,h)?(n++,g=rc.call(a,h)&&fb(a[h],b,c,d,e,f)):void 0}),g&&!d&&p(a,function(a,b,c){return rc.call(c,b)?g=-1<--n:void 0});return e.pop(),f.pop(),i&&(j(e),j(f)),g}function gb(a,b,c,d,e){(Jc(b)?Db:o)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Jc(b))||Pc(b))){for(i=d.length;i--;)if(g=d[i]==b){j=e[i];break}if(!g){var k;c&&(i=c(j,b),k="undefined"!=typeof i)&&(j=i),k||(j=h?Jc(j)?j:[]:Pc(j)?j:{}),d.push(b),e.push(j),k||gb(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function hb(a,b){return a+oc(Fc()*(b-a+1))}function ib(c,d,e){var g=-1,i=mb(),l=c?c.length:0,m=[],n=!d&&l>=s&&i===a,o=e||n?h():m;for(n&&(o=f(o),i=b);++g<l;){var p=c[g],q=e?e(p,g,c):p;(d?!g||o[o.length-1]!==q:0>i(o,q))&&((e||n)&&o.push(q),m.push(p))}return n?(j(o.k),k(o)):e&&j(o),m}function jb(a){return function(b,c,d){var e={};c=X.createCallback(c,d,3),d=-1;var f=b?b.length:0;if("number"==typeof f)for(;++d<f;){var g=b[d];a(e,g,c(g,d,b),b)}else o(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function kb(a,b,c,d,e,f){var g=1&b,h=4&b,i=16&b,j=32&b;if(!(2&b||ub(a)))throw new gc;i&&!c.length&&(b&=-17,i=c=!1),j&&!d.length&&(b&=-33,j=d=!1);var k=a&&a.__bindData__;return k&&!0!==k?(k=l(k),k[2]&&(k[2]=l(k[2])),k[3]&&(k[3]=l(k[3])),!g||1&k[1]||(k[4]=e),!g&&1&k[1]&&(b|=8),!h||4&k[1]||(k[5]=f),i&&sc.apply(k[2]||(k[2]=[]),c),j&&vc.apply(k[3]||(k[3]=[]),d),k[1]|=b,kb.apply(null,k)):(1==b||17===b?Z:cb)([a,b,c,d,e,f])}function lb(a){return Lc[a]}function mb(){var b=(b=X.indexOf)===Mb?a:b;return b}function nb(a){return"function"==typeof a&&lc.test(a)}function ob(a){var b,c;return a&&kc.call(a)==N&&(b=a.constructor,!ub(b)||b instanceof b)?(p(a,function(a,b){c=b}),"undefined"==typeof c||rc.call(a,c)):!1}function pb(a){return Mc[a]}function qb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&kc.call(a)==H||!1}function rb(a,b,c){var d=Kc(a),e=d.length;for(b=bb(b,c,3);e--&&(c=d[e],!1!==b(a[c],c,a)););return a}function sb(a){var b=[];return p(a,function(a,c){ub(a)&&b.push(c)}),b.sort()}function tb(a){for(var b=-1,c=Kc(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function ub(a){return"function"==typeof a}function vb(a){return!(!a||!T[typeof a])}function wb(a){return"number"==typeof a||a&&"object"==typeof a&&kc.call(a)==M||!1}function xb(a){return"string"==typeof a||a&&"object"==typeof a&&kc.call(a)==P||!1}function yb(a){for(var b=-1,c=Kc(a),d=c.length,e=Zb(d);++b<d;)e[b]=a[c[b]];return e}function zb(a,b,c){var d=-1,e=mb(),f=a?a.length:0,g=!1;return c=(0>c?Cc(0,f+c):c)||0,Jc(a)?g=-1<e(a,b,c):"number"==typeof f?g=-1<(xb(a)?a.indexOf(b,c):e(a,b,c)):o(a,function(a){return++d<c?void 0:!(g=a===b)}),g}function Ab(a,b,c){var d=!0;b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e&&(d=!!b(a[c],c,a)););else o(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Bb(a,b,c){var d=[];b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e;){var f=a[c];b(f,c,a)&&d.push(f)}else o(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Cb(a,b,c){b=X.createCallback(b,c,3),c=-1;var d=a?a.length:0;if("number"!=typeof d){var e;return o(a,function(a,c,d){return b(a,c,d)?(e=a,!1):void 0}),e}for(;++c<d;){var f=a[c];if(b(f,c,a))return f}}function Db(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:bb(b,c,3),"number"==typeof e)for(;++d<e&&!1!==b(a[d],d,a););else o(a,b);return a}function Eb(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:bb(b,c,3),"number"==typeof d)for(;d--&&!1!==b(a[d],d,a););else{var e=Kc(a),d=e.length;o(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function Fb(a,b,c){var d=-1,e=a?a.length:0;if(b=X.createCallback(b,c,3),"number"==typeof e)for(var f=Zb(e);++d<e;)f[d]=b(a[d],d,a);else f=[],o(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function Gb(a,b,c){var e=-1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Jc(a)){c=-1;for(var g=a.length;++c<g;){var h=a[c];h>f&&(f=h)}}else b=null==b&&xb(a)?d:X.createCallback(b,c,3),Db(a,function(a,c,d){c=b(a,c,d),c>e&&(e=c,f=a)});return f}function Hb(a,b,c,d){if(!a)return c;var e=3>arguments.length;b=X.createCallback(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else o(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function Ib(a,b,c,d){var e=3>arguments.length;return b=X.createCallback(b,d,4),Eb(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function Jb(a){var b=-1,c=a?a.length:0,d=Zb("number"==typeof c?c:0);return Db(a,function(a){var c=hb(0,++b);d[b]=d[c],d[c]=a}),d}function Kb(a,b,c){var d;b=X.createCallback(b,c,3),c=-1;var e=a?a.length:0;if("number"==typeof e)for(;++c<e&&!(d=b(a[c],c,a)););else o(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function Lb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=-1;for(b=X.createCallback(b,c,3);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[0]:n;return l(a,0,Dc(Cc(0,d),e))}function Mb(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Cc(0,e+d):d||0}else if(d)return d=Ob(b,c),b[d]===c?d:-1;return a(b,c,d)}function Nb(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=X.createCallback(b,c,3);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Cc(0,b);return l(a,d)}function Ob(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?X.createCallback(c,d,1):Ub,b=c(b);f>e;)d=e+f>>>1,c(a[d])<b?e=d+1:f=d;return e}function Pb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(c=X.createCallback(c,d,3)),ib(a,b,c)}function Qb(){for(var a=1<arguments.length?arguments:arguments[0],b=-1,c=a?Gb(Tc(a,"length")):0,d=Zb(0>c?0:c);++b<c;)d[b]=Tc(a,b);return d}function Rb(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Jc(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Sb(a,b){return 2<arguments.length?kb(a,17,l(arguments,2),null,b):kb(a,1,null,null,b)}function Tb(a,b,c){function d(){k&&nc(k),g=k=l=n,(p||o!==b)&&(m=Uc(),h=a.apply(j,f),k||g||(f=j=null))}function e(){var c=b-(Uc()-i);c>0?k=tc(e,c):(g&&nc(g),c=l,g=k=l=n,c&&(m=Uc(),h=a.apply(j,f),k||g||(f=j=null)))}var f,g,h,i,j,k,l,m=0,o=!1,p=!0;if(!ub(a))throw new gc;if(b=Cc(0,b)||0,!0===c)var q=!0,p=!1;else vb(c)&&(q=c.leading,o="maxWait"in c&&(Cc(b,c.maxWait)||0),p="trailing"in c?c.trailing:p);return function(){if(f=arguments,i=Uc(),j=this,l=p&&(k||!q),!1===o)var c=q&&!k;else{g||q||(m=i);var n=o-(i-m),r=0>=n;r?(g&&(g=nc(g)),m=i,h=a.apply(j,f)):g||(g=tc(d,n))}return r&&k?k=nc(k):k||b===o||(k=tc(e,b)),c&&(r=!0,h=a.apply(j,f)),!r||k||g||(f=j=null),h}}function Ub(a){return a}function Vb(a,b,c){var d=!0,e=b&&sb(b);b&&(c||e.length)||(null==c&&(c=b),f=Y,b=a,a=X,e=sb(b)),!1===c?d=!1:vb(c)&&"chain"in c&&(d=c.chain);var f=a,g=ub(f);Db(e,function(c){var e=a[c]=b[c];g&&(f.prototype[c]=function(){var b=this.__chain__,c=this.__wrapped__,g=[c];if(sc.apply(g,arguments),g=e.apply(a,g),d||b){if(c===g&&vb(g))return this;g=new f(g),g.__chain__=b}return g})})}function Wb(){}function Xb(a){return function(b){return b[a]}}function Yb(){return this.__wrapped__}c=c?$.defaults(V.Object(),c,$.pick(V,G)):V;var Zb=c.Array,$b=c.Boolean,_b=c.Date,ac=c.Function,bc=c.Math,cc=c.Number,dc=c.Object,ec=c.RegExp,fc=c.String,gc=c.TypeError,hc=[],ic=dc.prototype,jc=c._,kc=ic.toString,lc=ec("^"+fc(kc).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),mc=bc.ceil,nc=c.clearTimeout,oc=bc.floor,pc=ac.prototype.toString,qc=nb(qc=dc.getPrototypeOf)&&qc,rc=ic.hasOwnProperty,sc=hc.push,tc=c.setTimeout,uc=hc.splice,vc=hc.unshift,wc=function(){try{var a={},b=nb(b=dc.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),xc=nb(xc=dc.create)&&xc,yc=nb(yc=Zb.isArray)&&yc,zc=c.isFinite,Ac=c.isNaN,Bc=nb(Bc=dc.keys)&&Bc,Cc=bc.max,Dc=bc.min,Ec=c.parseInt,Fc=bc.random,Gc={};Gc[I]=Zb,Gc[J]=$b,Gc[K]=_b,Gc[L]=ac,Gc[N]=dc,Gc[M]=cc,Gc[O]=ec,Gc[P]=fc,Y.prototype=X.prototype;var Hc=X.support={};Hc.funcDecomp=!nb(c.a)&&E.test(m),Hc.funcNames="string"==typeof ac.name,X.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:B,variable:"",imports:{_:X}},xc||(ab=function(){function a(){}return function(b){if(vb(b)){a.prototype=b;var d=new a;a.prototype=null}return d||c.Object()}}());var Ic=wc?function(a,b){S.value=b,wc(a,"__bindData__",S)}:Wb,Jc=yc||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&kc.call(a)==I||!1},Kc=Bc?function(a){return vb(a)?Bc(a):[]}:W,Lc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Mc=tb(Lc),Nc=ec("("+Kc(Mc).join("|")+")","g"),Oc=ec("["+Kc(Lc).join("")+"]","g"),Pc=qc?function(a){if(!a||kc.call(a)!=N)return!1;var b=a.valueOf,c=nb(b)&&(c=qc(b))&&qc(c);return c?a==c||qc(a)==c:ob(a)}:ob,Qc=jb(function(a,b,c){rc.call(a,c)?a[c]++:a[c]=1}),Rc=jb(function(a,b,c){(rc.call(a,c)?a[c]:a[c]=[]).push(b)}),Sc=jb(function(a,b,c){a[c]=b}),Tc=Fb,Uc=nb(Uc=_b.now)&&Uc||function(){return(new _b).getTime()},Vc=8==Ec(u+"08")?Ec:function(a,b){return Ec(xb(a)?a.replace(C,""):a,b||0)};return X.after=function(a,b){if(!ub(b))throw new gc;return function(){return 1>--a?b.apply(this,arguments):void 0}},X.assign=U,X.at=function(a){for(var b=arguments,c=-1,d=eb(b,!0,!1,1),b=b[2]&&b[2][b[1]]===a?1:d.length,e=Zb(b);++c<b;)e[c]=a[d[c]];return e},X.bind=Sb,X.bindAll=function(a){for(var b=1<arguments.length?eb(arguments,!0,!1,1):sb(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=kb(a[e],1,null,null,a)}return a},X.bindKey=function(a,b){return 2<arguments.length?kb(b,19,l(arguments,2),null,a):kb(b,3,null,null,a)},X.chain=function(a){return a=new Y(a),a.__chain__=!0,a},X.compact=function(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d},X.compose=function(){for(var a=arguments,b=a.length;b--;)if(!ub(a[b]))throw new gc;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}},X.constant=function(a){return function(){return a}},X.countBy=Qc,X.create=function(a,b){var c=ab(a);return b?U(c,b):c},X.createCallback=function(a,b,c){var d=typeof a;if(null==a||"function"==d)return bb(a,b,c);if("object"!=d)return Xb(a);var e=Kc(a),f=e[0],g=a[f];return 1!=e.length||g!==g||vb(g)?function(b){for(var c=e.length,d=!1;c--&&(d=fb(b[e[c]],a[e[c]],null,!0)););return d}:function(a){return a=a[f],g===a&&(0!==g||1/g==1/a)}},X.curry=function(a,b){return b="number"==typeof b?b:+b||a.length,kb(a,4,null,null,null,b)},X.debounce=Tb,X.defaults=t,X.defer=function(a){if(!ub(a))throw new gc;var b=l(arguments,1);return tc(function(){a.apply(n,b)},1)},X.delay=function(a,b){if(!ub(a))throw new gc;var c=l(arguments,2);return tc(function(){a.apply(n,c)},b)},X.difference=function(a){return db(a,eb(arguments,!0,!0,1))},X.filter=Bb,X.flatten=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=Fb(a,c,d)),eb(a,b)},X.forEach=Db,X.forEachRight=Eb,X.forIn=p,X.forInRight=function(a,b,c){var d=[];p(a,function(a,b){d.push(b,a)});var e=d.length;for(b=bb(b,c,3);e--&&!1!==b(d[e--],d[e],a););return a},X.forOwn=o,X.forOwnRight=rb,X.functions=sb,X.groupBy=Rc,X.indexBy=Sc,X.initial=function(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=X.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return l(a,0,Dc(Cc(0,e-d),e))},X.intersection=function(){for(var c=[],d=-1,e=arguments.length,g=h(),i=mb(),l=i===a,m=h();++d<e;){var n=arguments[d];(Jc(n)||qb(n))&&(c.push(n),g.push(l&&n.length>=s&&f(d?c[d]:m)))}var l=c[0],o=-1,p=l?l.length:0,q=[];a:for(;++o<p;){var r=g[0],n=l[o];if(0>(r?b(r,n):i(m,n))){for(d=e,(r||m).push(n);--d;)if(r=g[d],0>(r?b(r,n):i(c[d],n)))continue a;q.push(n)}}for(;e--;)(r=g[e])&&k(r);return j(g),j(m),q},X.invert=tb,X.invoke=function(a,b){var c=l(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=Zb("number"==typeof f?f:0);return Db(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g},X.keys=Kc,X.map=Fb,X.mapValues=function(a,b,c){var d={};return b=X.createCallback(b,c,3),o(a,function(a,c,e){d[c]=b(a,c,e)}),d},X.max=Gb,X.memoize=function(a,b){function c(){var d=c.cache,e=b?b.apply(this,arguments):r+arguments[0];return rc.call(d,e)?d[e]:d[e]=a.apply(this,arguments)}if(!ub(a))throw new gc;return c.cache={},c},X.merge=function(a){var b=arguments,c=2;if(!vb(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=bb(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var b=l(arguments,1,c),e=-1,f=h(),g=h();++e<c;)gb(a,b[e],d,f,g);return j(f),j(g),a},X.min=function(a,b,c){var e=1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Jc(a)){c=-1;for(var g=a.length;++c<g;){var h=a[c];f>h&&(f=h)}}else b=null==b&&xb(a)?d:X.createCallback(b,c,3),Db(a,function(a,c,d){c=b(a,c,d),e>c&&(e=c,f=a)});return f},X.omit=function(a,b,c){var d={};if("function"!=typeof b){var e=[];p(a,function(a,b){e.push(b)});for(var e=db(e,eb(arguments,!0,!1,1)),f=-1,g=e.length;++f<g;){var h=e[f];d[h]=a[h]}}else b=X.createCallback(b,c,3),p(a,function(a,c,e){b(a,c,e)||(d[c]=a)});return d},X.once=function(a){var b,c;if(!ub(a))throw new gc;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},X.pairs=function(a){for(var b=-1,c=Kc(a),d=c.length,e=Zb(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e},X.partial=function(a){return kb(a,16,l(arguments,1))},X.partialRight=function(a){return kb(a,32,null,l(arguments,1))},X.pick=function(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=eb(arguments,!0,!1,1),g=vb(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=X.createCallback(b,c,3),p(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d},X.pluck=Tc,X.property=Xb,X.pull=function(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(uc.call(a,f--,1),e--);return a},X.range=function(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);var d=-1;b=Cc(0,mc((b-a)/(c||1)));for(var e=Zb(b);++d<b;)e[d]=a,a+=c;return e},X.reject=function(a,b,c){return b=X.createCallback(b,c,3),Bb(a,function(a,c,d){return!b(a,c,d)})},X.remove=function(a,b,c){var d=-1,e=a?a.length:0,f=[];for(b=X.createCallback(b,c,3);++d<e;)c=a[d],b(c,d,a)&&(f.push(c),uc.call(a,d--,1),e--);return f},X.rest=Nb,X.shuffle=Jb,X.sortBy=function(a,b,c){var d=-1,f=Jc(b),g=a?a.length:0,l=Zb("number"==typeof g?g:0);for(f||(b=X.createCallback(b,c,3)),Db(a,function(a,c,e){var g=l[++d]=i();f?g.m=Fb(b,function(b){return a[b]}):(g.m=h())[0]=b(a,c,e),g.n=d,g.o=a}),g=l.length,l.sort(e);g--;)a=l[g],l[g]=a.o,f||j(a.m),k(a);return l},X.tap=function(a,b){return b(a),a},X.throttle=function(a,b,c){var d=!0,e=!0;if(!ub(a))throw new gc;return!1===c?d=!1:vb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),R.leading=d,R.maxWait=b,R.trailing=e,Tb(a,b,R)},X.times=function(a,b,c){a=-1<(a=+a)?a:0;var d=-1,e=Zb(a);for(b=bb(b,c,1);++d<a;)e[d]=b(d);return e},X.toArray=function(a){return a&&"number"==typeof a.length?l(a):yb(a)},X.transform=function(a,b,c,d){var e=Jc(a);if(null==c)if(e)c=[];else{var f=a&&a.constructor;c=ab(f&&f.prototype)}return b&&(b=X.createCallback(b,d,4),(e?Db:o)(a,function(a,d,e){return b(c,a,d,e)})),c},X.union=function(){return ib(eb(arguments,!0,!0))},X.uniq=Pb,X.values=yb,X.where=Bb,X.without=function(a){return db(a,l(arguments,1))},X.wrap=function(a,b){return kb(b,16,[a])},X.xor=function(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Jc(c)||qb(c))var d=d?ib(db(d,c).concat(db(c,d))):c}return d||[]},X.zip=Qb,X.zipObject=Rb,X.collect=Fb,X.drop=Nb,X.each=Db,X.eachRight=Eb,X.extend=U,X.methods=sb,X.object=Rb,X.select=Bb,X.tail=Nb,X.unique=Pb,X.unzip=Qb,Vb(X),X.clone=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),_(a,b,"function"==typeof c&&bb(c,d,1))},X.cloneDeep=function(a,b,c){return _(a,!0,"function"==typeof b&&bb(b,c,1))},X.contains=zb,X.escape=function(a){return null==a?"":fc(a).replace(Oc,lb)},X.every=Ab,X.find=Cb,X.findIndex=function(a,b,c){var d=-1,e=a?a.length:0;for(b=X.createCallback(b,c,3);++d<e;)if(b(a[d],d,a))return d;return-1},X.findKey=function(a,b,c){var d;return b=X.createCallback(b,c,3),o(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d},X.findLast=function(a,b,c){var d;return b=X.createCallback(b,c,3),Eb(a,function(a,c,e){return b(a,c,e)?(d=a,!1):void 0}),d},X.findLastIndex=function(a,b,c){var d=a?a.length:0;for(b=X.createCallback(b,c,3);d--;)if(b(a[d],d,a))return d;return-1},X.findLastKey=function(a,b,c){var d;return b=X.createCallback(b,c,3),rb(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d},X.has=function(a,b){return a?rc.call(a,b):!1},X.identity=Ub,X.indexOf=Mb,X.isArguments=qb,X.isArray=Jc,X.isBoolean=function(a){return!0===a||!1===a||a&&"object"==typeof a&&kc.call(a)==J||!1},X.isDate=function(a){return a&&"object"==typeof a&&kc.call(a)==K||!1},X.isElement=function(a){return a&&1===a.nodeType||!1},X.isEmpty=function(a){var b=!0;if(!a)return b;var c=kc.call(a),d=a.length;return c==I||c==P||c==H||c==N&&"number"==typeof d&&ub(a.splice)?!d:(o(a,function(){return b=!1}),b)},X.isEqual=function(a,b,c,d){return fb(a,b,"function"==typeof c&&bb(c,d,2))},X.isFinite=function(a){return zc(a)&&!Ac(parseFloat(a))},X.isFunction=ub,X.isNaN=function(a){return wb(a)&&a!=+a},X.isNull=function(a){return null===a},X.isNumber=wb,X.isObject=vb,X.isPlainObject=Pc,X.isRegExp=function(a){return a&&"object"==typeof a&&kc.call(a)==O||!1},X.isString=xb,X.isUndefined=function(a){return"undefined"==typeof a},X.lastIndexOf=function(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Cc(0,d+c):Dc(c,d-1))+1);d--;)if(a[d]===b)return d;return-1},X.mixin=Vb,X.noConflict=function(){return c._=jc,this},X.noop=Wb,X.now=Uc,X.parseInt=Vc,X.random=function(a,b,c){var d=null==a,e=null==b;return null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1?(c=Fc(),Dc(a+c*(b-a+parseFloat("1e-"+((c+"").length-1))),b)):hb(a,b)},X.reduce=Hb,X.reduceRight=Ib,X.result=function(a,b){if(a){var c=a[b];return ub(c)?a[b]():c}},X.runInContext=m,X.size=function(a){var b=a?a.length:0;return"number"==typeof b?b:Kc(a).length},X.some=Kb,X.sortedIndex=Ob,X.template=function(a,b,c){var d=X.templateSettings;a=fc(a||""),c=t({},c,d);var e,f=t({},c.imports,d.imports),d=Kc(f),f=yb(f),h=0,i=c.interpolate||D,j="__p+='",i=ec((c.escape||D).source+"|"+i.source+"|"+(i===B?y:D).source+"|"+(c.evaluate||D).source+"|$","g");
a.replace(i,function(b,c,d,f,i,k){return d||(d=f),j+=a.slice(h,k).replace(F,g),c&&(j+="'+__e("+c+")+'"),i&&(e=!0,j+="';"+i+";\n__p+='"),d&&(j+="'+((__t=("+d+"))==null?'':__t)+'"),h=k+b.length,b}),j+="';",i=c=c.variable,i||(c="obj",j="with("+c+"){"+j+"}"),j=(e?j.replace(v,""):j).replace(w,"$1").replace(x,"$1;"),j="function("+c+"){"+(i?"":c+"||("+c+"={});")+"var __t,__p='',__e=_.escape"+(e?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+j+"return __p}";try{var k=ac(d,"return "+j).apply(n,f)}catch(l){throw l.source=j,l}return b?k(b):(k.source=j,k)},X.unescape=function(a){return null==a?"":fc(a).replace(Nc,pb)},X.uniqueId=function(a){var b=++q;return fc(null==a?"":a)+b},X.all=Ab,X.any=Kb,X.detect=Cb,X.findWhere=Cb,X.foldl=Hb,X.foldr=Ib,X.include=zb,X.inject=Hb,Vb(function(){var a={};return o(X,function(b,c){X.prototype[c]||(a[c]=b)}),a}(),!1),X.first=Lb,X.last=function(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=X.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[e-1]:n;return l(a,Cc(0,e-d))},X.sample=function(a,b,c){return a&&"number"!=typeof a.length&&(a=yb(a)),null==b||c?a?a[hb(0,a.length-1)]:n:(a=Jb(a),a.length=Dc(Cc(0,b),a.length),a)},X.take=Lb,X.head=Lb,o(X,function(a,b){var c="sample"!==b;X.prototype[b]||(X.prototype[b]=function(b,d){var e=this.__chain__,f=a(this.__wrapped__,b,d);return e||null!=b&&(!d||c&&"function"==typeof b)?new Y(f,e):f})}),X.VERSION="2.4.1",X.prototype.chain=function(){return this.__chain__=!0,this},X.prototype.toString=function(){return fc(this.__wrapped__)},X.prototype.value=Yb,X.prototype.valueOf=Yb,Db(["join","pop","shift"],function(a){var b=hc[a];X.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new Y(c,a):c}}),Db(["push","reverse","sort","unshift"],function(a){var b=hc[a];X.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Db(["concat","slice","splice"],function(a){var b=hc[a];X.prototype[a]=function(){return new Y(b.apply(this.__wrapped__,arguments),this.__chain__)}}),X}var n,o=[],p=[],q=0,r=+new Date+"",s=75,t=40,u=" 	\f\n\r\u2028\u2029",v=/\b__p\+='';/g,w=/\b(__p\+=)''\+/g,x=/(__e\(.*?\)|\b__t\))\+'';/g,y=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,z=/\w*$/,A=/^\s*function[ \n\r\t]+\w/,B=/<%=([\s\S]+?)%>/g,C=RegExp("^["+u+"]*0+(?=.$)"),D=/($^)/,E=/\bthis\b/,F=/['\n\r\t\u2028\u2029\\]/g,G="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),H="[object Arguments]",I="[object Array]",J="[object Boolean]",K="[object Date]",L="[object Function]",M="[object Number]",N="[object Object]",O="[object RegExp]",P="[object String]",Q={};Q[L]=!1,Q[H]=Q[I]=Q[J]=Q[K]=Q[M]=Q[N]=Q[O]=Q[P]=!0;var R={leading:!1,maxWait:0,trailing:!1},S={configurable:!1,enumerable:!1,value:null,writable:!1},T={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},U={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},V=T[typeof window]&&window||this,W=T[typeof exports]&&exports&&!exports.nodeType&&exports,X=T[typeof module]&&module&&!module.nodeType&&module,Y=X&&X.exports===W&&W,Z=T[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(V=Z);var $=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(V._=$,define(function(){return $})):W&&X?Y?(X.exports=$)._=$:W._=$:V._=$}.call(this);for(var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d={},e=0;e<c.length;e++)d[c.charAt(e)]=e;Base64={},Base64.encode=function(a){if("string"==typeof a){var b=a;a=Base64.newBinary(b.length);for(var c=0;c<b.length;c++){var d=b.charCodeAt(c);if(d>255)throw new Error("Not ascii. Base64.encode can only take ascii strings.");a[c]=d}}for(var e=[],g=null,h=null,i=null,j=null,c=0;c<a.length;c++)switch(c%3){case 0:g=63&a[c]>>2,h=(3&a[c])<<4;break;case 1:h|=15&a[c]>>4,i=(15&a[c])<<2;break;case 2:i|=3&a[c]>>6,j=63&a[c],e.push(f(g)),e.push(f(h)),e.push(f(i)),e.push(f(j)),g=null,h=null,i=null,j=null}return null!=g&&(e.push(f(g)),e.push(f(h)),e.push(null==i?"=":f(i)),null==j&&e.push("=")),e.join("")};var f=function(a){return c.charAt(a)},g=function(a){return"="===a?-1:d[a]};Base64.newBinary=function(a){if("undefined"==typeof Uint8Array||"undefined"==typeof ArrayBuffer){for(var b=[],c=0;a>c;c++)b.push(0);return b.$Uint8ArrayPolyfill=!0,b}return new Uint8Array(new ArrayBuffer(a))},Base64.decode=function(a){var b=Math.floor(3*a.length/4);"="==a.charAt(a.length-1)&&(b--,"="==a.charAt(a.length-2)&&b--);for(var c=Base64.newBinary(b),d=null,e=null,f=null,h=0,i=0;i<a.length;i++){var j=a.charAt(i),k=g(j);switch(i%4){case 0:if(0>k)throw new Error("invalid base64 string");d=k<<2;break;case 1:if(0>k)throw new Error("invalid base64 string");d|=k>>4,c[h++]=d,e=(15&k)<<4;break;case 2:k>=0&&(e|=k>>2,c[h++]=e,f=(3&k)<<6);break;case 3:k>=0&&(c[h++]=f|k)}}return c},EJSON={},EJSONTest={};var h={};EJSON.addType=function(a,b){if(_.has(h,a))throw new Error("Type "+a+" already present");h[a]=b};var i=function(a){return _.isNaN(a)||1/0===a||a===-1/0},j=[{matchJSONValue:function(a){return _.has(a,"$date")&&1===_.size(a)},matchObject:function(a){return a instanceof Date},toJSONValue:function(a){return{$date:a.getTime()}},fromJSONValue:function(a){return new Date(a.$date)}},{matchJSONValue:function(a){return _.has(a,"$InfNaN")&&1===_.size(a)},matchObject:i,toJSONValue:function(a){var b;return b=_.isNaN(a)?0:1/0===a?1:-1,{$InfNaN:b}},fromJSONValue:function(a){return a.$InfNaN/0}},{matchJSONValue:function(a){return _.has(a,"$binary")&&1===_.size(a)},matchObject:function(a){return"undefined"!=typeof Uint8Array&&a instanceof Uint8Array||a&&_.has(a,"$Uint8ArrayPolyfill")},toJSONValue:function(a){return{$binary:Base64.encode(a)}},fromJSONValue:function(a){return Base64.decode(a.$binary)}},{matchJSONValue:function(a){return _.has(a,"$escape")&&1===_.size(a)},matchObject:function(a){return _.isEmpty(a)||_.size(a)>2?!1:_.any(j,function(b){return b.matchJSONValue(a)})},toJSONValue:function(a){var b={};return _.each(a,function(a,c){b[c]=EJSON.toJSONValue(a)}),{$escape:b}},fromJSONValue:function(a){var b={};return _.each(a.$escape,function(a,c){b[c]=EJSON.fromJSONValue(a)}),b}},{matchJSONValue:function(a){return _.has(a,"$type")&&_.has(a,"$value")&&2===_.size(a)},matchObject:function(a){return EJSON._isCustomType(a)},toJSONValue:function(a){var b=Meteor._noYieldsAllowed(function(){return a.toJSONValue()});return{$type:a.typeName(),$value:b}},fromJSONValue:function(a){var b=a.$type;if(!_.has(h,b))throw new Error("Custom EJSON type "+b+" is not defined");var c=h[b];return Meteor._noYieldsAllowed(function(){return c(a.$value)})}}];EJSON._isCustomType=function(a){return a&&"function"==typeof a.toJSONValue&&"function"==typeof a.typeName&&_.has(h,a.typeName())};var k=EJSON._adjustTypesToJSONValue=function(a){if(null===a)return null;var b=l(a);return void 0!==b?b:"object"!=typeof a?a:(_.each(a,function(b,c){if("object"==typeof b||void 0===b||i(b)){var d=l(b);return d?void(a[c]=d):void k(b)}}),a)},l=function(a){for(var b=0;b<j.length;b++){var c=j[b];if(c.matchObject(a))return c.toJSONValue(a)}return void 0};EJSON.toJSONValue=function(a){var b=l(a);return void 0!==b?b:("object"==typeof a&&(a=EJSON.clone(a),k(a)),a)};var m=EJSON._adjustTypesFromJSONValue=function(a){if(null===a)return null;var b=n(a);return b!==a?b:"object"!=typeof a?a:(_.each(a,function(b,c){if("object"==typeof b){var d=n(b);if(b!==d)return void(a[c]=d);m(b)}}),a)},n=function(a){if("object"==typeof a&&null!==a&&_.size(a)<=2&&_.all(a,function(a,b){return"string"==typeof b&&"$"===b.substr(0,1)}))for(var b=0;b<j.length;b++){var c=j[b];if(c.matchJSONValue(a))return c.fromJSONValue(a)}return a};EJSON.fromJSONValue=function(a){var b=n(a);return b===a&&"object"==typeof a?(a=EJSON.clone(a),m(a),a):b},EJSON.stringify=function(a,b){var c=EJSON.toJSONValue(a);return b&&(b.canonical||b.indent)?EJSON._canonicalStringify(c,b):JSON.stringify(c)},EJSON.parse=function(a){if("string"!=typeof a)throw new Error("EJSON.parse argument should be a string");return EJSON.fromJSONValue(JSON.parse(a))},EJSON.isBinary=function(a){return!!("undefined"!=typeof Uint8Array&&a instanceof Uint8Array||a&&a.$Uint8ArrayPolyfill)},EJSON.equals=function(a,b,c){var d,e=!(!c||!c.keyOrderSensitive);if(a===b)return!0;if(_.isNaN(a)&&_.isNaN(b))return!0;if(!a||!b)return!1;if("object"!=typeof a||"object"!=typeof b)return!1;if(a instanceof Date&&b instanceof Date)return a.valueOf()===b.valueOf();if(EJSON.isBinary(a)&&EJSON.isBinary(b)){if(a.length!==b.length)return!1;for(d=0;d<a.length;d++)if(a[d]!==b[d])return!1;return!0}if("function"==typeof a.equals)return a.equals(b,c);if("function"==typeof b.equals)return b.equals(a,c);if(a instanceof Array){if(!(b instanceof Array))return!1;if(a.length!==b.length)return!1;for(d=0;d<a.length;d++)if(!EJSON.equals(a[d],b[d],c))return!1;return!0}switch(EJSON._isCustomType(a)+EJSON._isCustomType(b)){case 1:return!1;case 2:return EJSON.equals(EJSON.toJSONValue(a),EJSON.toJSONValue(b))}var f;if(e){var g=[];return _.each(b,function(a,b){g.push(b)}),d=0,f=_.all(a,function(a,e){return d>=g.length?!1:e!==g[d]?!1:EJSON.equals(a,b[g[d]],c)?(d++,!0):!1}),f&&d===g.length}return d=0,f=_.all(a,function(a,e){return _.has(b,e)&&EJSON.equals(a,b[e],c)?(d++,!0):!1}),f&&_.size(b)===d},EJSON.clone=function(a){var b;if("object"!=typeof a)return a;if(null===a)return null;if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return a;if(EJSON.isBinary(a)){b=EJSON.newBinary(a.length);for(var c=0;c<a.length;c++)b[c]=a[c];return b}if(_.isArray(a)||_.isArguments(a)){for(b=[],c=0;c<a.length;c++)b[c]=EJSON.clone(a[c]);return b}return"function"==typeof a.clone?a.clone():EJSON._isCustomType(a)?EJSON.fromJSONValue(EJSON.clone(EJSON.toJSONValue(a)),!0):(b={},_.each(a,function(a,c){b[c]=EJSON.clone(a)}),b)},EJSON.newBinary=Base64.newBinary,!function(a){"use strict";if(a.URL=a.URL||a.webkitURL,a.Blob&&a.URL)try{return void new Blob}catch(b){}var c=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array,s=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL=function(a){var b,c=document.createElementNS("http://www.w3.org/1999/xhtml","a");return c.href=a,"origin"in c||("data:"===c.protocol.toLowerCase()?c.origin=null:(b=a.match(s),c.origin=b&&b[1])),c}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},f.close=function(){this.size=0,delete this.data},c}(a);a.Blob=function(a,b){var d=b?b.type||"":"",e=new c;if(a)for(var f=0,g=a.length;g>f;f++)e.append(a[f]);return e.getBlob(d)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),saveAs=void 0;try{saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=b.createElementNS("http://www.w3.org/1999/xhtml","a"),d="download"in c,e=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},f=a.webkitRequestFileSystem,g=a.requestFileSystem||f||a.mozRequestFileSystem,h=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},i=0,j=function(b){var c=function(){"string"==typeof b?(a.URL||a.webkitURL||a).revokeObjectURL(b):b.remove()};a.chrome?c():setTimeout(c,10)},k=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){h(f)}}},l=function(b,h){var l,m,n,o=this,p=b.type,q=!1,r=function(){k(o,["writestart","progress","write","writeend"])},s=function(){(q||!l)&&(l=(a.URL||a.webkitURL||a).createObjectURL(b)),m?m.location.href=l:void 0==a.open(l,"_blank")&&"undefined"!=typeof safari&&(a.location.href=l),o.readyState=o.DONE,r(),j(l)},t=function(a){return function(){return o.readyState!==o.DONE?a.apply(this,arguments):void 0}},u={create:!0,exclusive:!1};o.readyState=o.INIT,h||(h="download"),d?(l=(a.URL||a.webkitURL||a).createObjectURL(b),c.href=l,c.download=h,e(c),o.readyState=o.DONE,r(),j(l)):(a.chrome&&p&&"application/octet-stream"!==p&&(n=b.slice||b.webkitSlice,b=n.call(b,0,b.size,"application/octet-stream"),q=!0),f&&"download"!==h&&(h+=".download"),("application/octet-stream"===p||f)&&(m=a),g?(i+=b.size,g(a.TEMPORARY,i,t(function(a){a.root.getDirectory("saved",u,t(function(a){var c=function(){a.getFile(h,u,t(function(a){a.createWriter(t(function(c){c.onwriteend=function(b){m.location.href=a.toURL(),o.readyState=o.DONE,k(o,"writeend",b),j(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&s()},["writestart","progress","write","abort"].forEach(function(a){c["on"+a]=o["on"+a]}),c.write(b),o.abort=function(){c.abort(),o.readyState=o.DONE},o.readyState=o.WRITING}),s)}),s)};a.getFile(h,{create:!1},t(function(a){a.remove(),c()}),t(function(a){a.code===a.NOT_FOUND_ERR?c():s()}))}),s)}),s)):s())},m=l.prototype;return m.abort=function(){this.readyState=this.DONE,k(this,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,function(a,b){return new l(a,b)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content),"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs})}catch(o){}}).call(this);